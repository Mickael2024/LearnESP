<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ArduinoLearn - Tutoriels Complets</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #00979c;
      --secondary-color: #00696b;
      --accent-color: #ff9800;
      --light-color: #f8f9fa;
      --dark-color: #333;
      --gray-color: #6c757d;
      --code-bg: #f4f4f4;
      --success-color: #28a745;
      --danger-color: #dc3545;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #f5f5f5;
      color: var(--dark-color);
      line-height: 1.6;
      width: 100%;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
      padding-top: 70px; /* ESPACE POUR LE HEADER FIXE */
    }

    .container {
      width: 100%;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    header {
      background-color: var(--primary-color);
      color: white;
      padding: 1rem 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      position: fixed; /* CHANG√â de sticky √† fixed */
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000; /* Augment√© pour √™tre au-dessus de tout */
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      display: flex;
      align-items: center;
    }

    .logo i {
      margin-right: 10px;
      color: var(--accent-color);
    }

    .logo span {
      color: var(--accent-color);
    }

    nav ul {
      display: flex;
      list-style: none;
    }

    nav ul li {
      margin-left: 1.5rem;
    }

    nav ul li a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
      padding: 5px 10px;
      border-radius: 4px;
    }

    nav ul li a:hover {
      color: var(--accent-color);
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* Hero Section */
    .hero {
      color: white;
      padding: 3rem 0;
      text-align: center;
      margin-bottom: 2rem;
      width: 100%;
      margin-top: 0; /* Supprime tout margin-top */
      background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        transition: background-image 1s ease-out;
    }

    .hero h1 {
      font-size: 2.8rem;
      margin-bottom: 1rem;
    }

    .hero p {
      font-size: 1.2rem;
      max-width: 800px;
      margin: 0 auto 2rem;
      opacity: 0.9;
    }

    .cta-button {
      display: inline-block;
      background-color: var(--accent-color);
      color: white;
      padding: 0.8rem 2rem;
      text-decoration: none;
      border-radius: 50px;
      font-weight: 600;
      font-size: 1.1rem;
      transition: transform 0.3s, box-shadow 0.3s;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .cta-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
      color: white;
    }

    /* Main Content */
    .main-content {
      display: flex;
      margin-bottom: 3rem;
      gap: 2rem;
    }

    /* Sidebar */
    .sidebar {
      flex: 0 0 300px;
      background-color: white;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      align-self: flex-start;
      position: sticky;
      top: 100px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .sidebar h3 {
      color: var(--primary-color);
      margin-bottom: 1.2rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #eee;
    }

    .sidebar ul {
      list-style: none;
    }

    .sidebar ul li {
      margin-bottom: 0.5rem;
    }

    .sidebar ul li a {
      color: var(--dark-color);
      text-decoration: none;
      display: block;
      padding: 0.5rem 0.8rem;
      border-radius: 4px;
      transition: all 0.3s;
      font-size: 0.95rem;
    }

    .sidebar ul li a:hover,
    .sidebar ul li a.active {
      background-color: #e9f7f7;
      color: var(--primary-color);
      padding-left: 1.2rem;
    }

    .sidebar ul li a i {
      margin-right: 8px;
      width: 20px;
      text-align: center;
    }

    /* Sub-menu */
    .sub-menu {
      margin-left: 1.5rem;
      border-left: 2px solid #eee;
      padding-left: 0.5rem;
      margin-top: 0.3rem;
      margin-bottom: 0.8rem;
    }

    .sub-menu li {
      margin-bottom: 0.3rem !important;
    }

    .sub-menu a {
      font-size: 0.9rem !important;
      padding: 0.3rem 0.8rem !important;
    }

    /* Content */
    .content {
      flex: 1;
      background-color: white;
      border-radius: 8px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .content h2 {
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      padding-bottom: 0.8rem;
      border-bottom: 2px solid #eee;
    }

    .content h3 {
      color: var(--secondary-color);
      margin: 2rem 0 1rem;
      padding-top: 1rem;
    }

    .content h4 {
      color: var(--primary-color);
      margin: 1.5rem 0 0.8rem;
    }

    .content p {
      margin-bottom: 1.2rem;
    }

    .content ul,
    .content ol {
      margin-left: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .content li {
      margin-bottom: 0.5rem;
    }

    /* Code examples */
    .code-example {
      background-color: var(--code-bg);
      border-left: 4px solid var(--primary-color);
      padding: 1.5rem;
      margin: 1.5rem 0;
      border-radius: 0 8px 8px 0;
      overflow-x: auto;
    }

    .code-example h4 {
      color: var(--secondary-color);
      margin-bottom: 0.8rem;
      font-size: 1.1rem;
    }

    pre {
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.95rem;
      line-height: 1.5;
      white-space: pre-wrap;
      tab-size: 2;
    }

    .code-comment {
      color: #6a9955;
    }

    .code-keyword {
      color: #569cd6;
      font-weight: bold;
    }

    .code-function {
      color: #ff0000;
    }

    .code-value {
      color: #ce9178;
    }

    .code-type {
      color: #4ec9b0;
    }

    .code-string {
      color: #ce9178;
    }

    .code-number {
      color: #b5cea8;
    }

    .code-define {
      color: #c586c0;
    }

    /* Cards */
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .card {
      background-color: white;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s, box-shadow 0.3s;
      border-top: 4px solid var(--primary-color);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .card i {
      font-size: 2.5rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
    }

    .card h3 {
      color: var(--primary-color);
      margin-bottom: 0.8rem;
    }

    /* Tables */
    .table-container {
      overflow-x: auto;
      margin: 1.5rem 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }

    th {
      background-color: var(--primary-color);
      color: white;
      padding: 0.8rem;
      text-align: left;
    }

    td {
      padding: 0.8rem;
      border-bottom: 1px solid #eee;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    tr:hover {
      background-color: #e9f7f7;
    }

    /* Info boxes */
    .info-box {
      background-color: #e9f7f7;
      border-left: 4px solid var(--primary-color);
      padding: 1.2rem;
      margin: 1.5rem 0;
      border-radius: 0 8px 8px 0;
    }

    .warning-box {
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 1.2rem;
      margin: 1.5rem 0;
      border-radius: 0 8px 8px 0;
    }

    .success-box {
      background-color: #d4edda;
      border-left: 4px solid var(--success-color);
      padding: 1.2rem;
      margin: 1.5rem 0;
      border-radius: 0 8px 8px 0;
    }

    /* Footer */
    footer {
      background-color: var(--dark-color);
      color: white;
      padding: 3rem 0 1.5rem;
    }

    .footer-content {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }

    .footer-section {
      flex: 1;
      min-width: 250px;
      margin-bottom: 1.5rem;
    }

    .footer-section h3 {
      color: var(--accent-color);
      margin-bottom: 1.2rem;
      font-size: 1.3rem;
    }

    .footer-section ul {
      list-style: none;
    }

    .footer-section ul li {
      margin-bottom: 0.6rem;
    }

    .footer-section ul li a {
      color: #ddd;
      text-decoration: none;
      transition: color 0.3s;
    }

    .footer-section ul li a:hover {
      color: var(--accent-color);
    }

    .copyright {
      text-align: center;
      padding-top: 1.5rem;
      border-top: 1px solid #444;
      color: #aaa;
      font-size: 0.9rem;
    }

    /* Responsive */
    @media (max-width: 992px) {
      .sidebar {
        flex: 0 0 250px;
      }
    }

    @media (max-width: 768px) {
      .header-content {
        text-align: center;
      }

      nav ul {
        margin-top: 1rem;
        justify-content: flex-start;
        flex-wrap: wrap;
        flex-direction: column;
        align-content: flex-start;
        line-height: 4;
        font-size: unset;
      }

      nav ul li {
        margin: 0.3rem 0.5rem;
      }

      .main-content {
        flex-direction: column;
      }

      .sidebar {
        flex: none;
        width: 100%;
        position: static;
        max-height: none;
      }

      .hero h1 {
        font-size: 2.2rem;
      }
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .tab {
      padding: 0.8rem 1.5rem;
      background-color: #f1f1f1;
      border: none;
      cursor: pointer;
      font-weight: 500;
      color: var(--gray-color);
      transition: all 0.3s;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
    }

    .tab:hover {
      background-color: #e9e9e9;
    }

    .tab.active {
      background-color: white;
      color: var(--primary-color);
      border-bottom: 3px solid var(--primary-color);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Breadcrumb */
    .breadcrumb {
      background-color: #e9f7f7;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
    }

    .breadcrumb a {
      color: var(--primary-color);
      text-decoration: none;
    }

    .breadcrumb span {
      color: var(--gray-color);
    }

    .breadcrumb i {
      margin: 0 8px;
      color: var(--gray-color);
    }

    /* Exercise section */
    .exercise {
      background-color: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1.5rem;
      margin: 2rem 0;
    }

    .exercise h4 {
      color: var(--primary-color);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
    }

    .exercise h4 i {
      margin-right: 10px;
    }

    /* Next/Prev buttons */
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 1px solid #eee;
    }

    .nav-button {
      padding: 0.8rem 1.5rem;
      background-color: var(--primary-color);
      color: white;
      text-decoration: none;
      border-radius: 4px;
      display: flex;
      align-items: center;
      transition: background-color 0.3s;
    }

    .nav-button:hover {
      background-color: var(--secondary-color);
      color: white;
    }

    .nav-button.prev i {
      margin-right: 8px;
    }

    .nav-button.next i {
      margin-left: 8px;
    }

    /* Project gallery */
    .project-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .project-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .project-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .project-image {
      height: 180px;
      background-color: #e9f7f7;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-color);
      font-size: 3rem;
    }

    .project-content {
      padding: 1.5rem;
    }

    .project-content h4 {
      color: var(--primary-color);
      margin-bottom: 0.8rem;
    }

    .difficulty {
      display: inline-block;
      padding: 0.3rem 0.8rem;
      border-radius: 50px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 0.8rem;
    }

    .difficulty.beginner {
      background-color: #d4edda;
      color: #155724;
    }

    .difficulty.intermediate {
      background-color: #fff3cd;
      color: #856404;
    }

    .difficulty.advanced {
      background-color: #f8d7da;
      color: #721c24;
    }
    .active{
      color:#ffbf00 ;
    }
    /* =========================================== */
/* BOUTON UNIQUE TOGGLE HAUT/BAS */
/* =========================================== */
.scroll-toggle-btn {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  color: white;
  border: none;
  cursor: pointer;
  z-index: 999;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  opacity: 0;
  transform: translateY(20px) scale(0.9);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  outline: none;
}

.scroll-toggle-btn.visible {
  opacity: 1;
  transform: translateY(0) scale(1);
}

.scroll-toggle-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
  background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
}

.scroll-toggle-btn:active {
  transform: scale(0.95);
}

.scroll-toggle-btn.scroll-to-top .fa-arrow-down {
  display: none;
}

.scroll-toggle-btn.scroll-to-top .fa-arrow-up {
  display: block;
}

.scroll-toggle-btn .fa-arrow-up {
  display: none;
}

/* Animation de pulsation */
@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(0, 151, 156, 0.7);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(0, 151, 156, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(0, 151, 156, 0);
  }
}

.scroll-toggle-btn.pulse {
  animation: pulse 2s infinite;
}

/* Responsive */
@media (max-width: 768px) {
  .scroll-toggle-btn {
    bottom: 20px;
    right: 20px;
    width: 55px;
    height: 55px;
    font-size: 1.3rem;
  }
}

@media (max-width: 480px) {
  .scroll-toggle-btn {
    bottom: 15px;
    right: 15px;
    width: 50px;
    height: 50px;
    font-size: 1.2rem;
  }
}
/* =========================================== */
/* BOUTON HAMBURGER POUR MOBILE */
/* =========================================== */
.hamburger-btn {
  display: none;
  background: none;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0.5rem;
  z-index: 1001;
}

.hamburger-btn:focus {
  outline: 2px solid var(--accent-color);
  border-radius: 4px;
}

/* Menu mobile */
.nav-menu {
  display: flex;
  list-style: none;
  transition: all 0.3s ease;
}

/* Overlay pour mobile */
.mobile-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 998;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.mobile-overlay.active {
  display: block;
  opacity: 1;
}

/* =========================================== */
/* RESPONSIVE HEADER */
/* =========================================== */
@media (max-width: 768px) {
  /* Bouton hamburger visible seulement sur mobile */
  .hamburger-btn {
    display: block;
  }

  /* Navigation originale cach√©e sur mobile */
  nav {
    position: fixed;
    top: 70px; /* Hauteur du header */
    left: -100%;
    width: 280px;
    height: calc(100vh - 70px);
    background-color: var(--primary-color);
    box-shadow: 4px 0 15px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    transition: left 0.3s ease;
    overflow-y: auto;
  }

  nav.active {
    left: 0;
  }

  /* Menu en colonne pour mobile */
  .nav-menu {
    flex-direction: column;
    padding: 1rem 0;
    width: 100%;
  }

  .nav-menu li {
    margin: 0;
    width: 100%;
  }

  .nav-menu li a {
    display: flex;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    width: 100%;
    
    font-size: 1rem;
  }

  .nav-menu li a i {
    width: 24px;
    margin-right: 12px;
    font-size: 1.1rem;
  }

  .nav-menu li a:hover,
  .nav-menu li a.active {
    background-color: rgba(255, 255, 255, 0.15);
    padding-left: 2rem;
  }

  /* Ajustement du header-content */
  .header-content {
    justify-content: space-between;
  }
}

@media (max-width: 480px) {
  nav {
    width: 50%;
    left: -100%;
  }

  .nav-menu li a {
    padding: 1.2rem 1.5rem;
  }
}

/* Animation du bouton hamburger vers croix */
.hamburger-btn .fa-times {
  display: none;
}

.hamburger-btn.active .fa-bars {
  display: none;
}

.hamburger-btn.active .fa-times {
  display: inline-block;
}
/* =========================================== */
/* BADGES ESP/ARDUINO */
/* =========================================== */
.chip {
  display: inline-block;
  padding: 0.2rem 0.6rem;
  border-radius: 12px;
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-left: 8px;
  vertical-align: middle;
}

/* Style pour ESP/ARDUINO */
.chip {
  background-color: #00979c;
  color: white;
}

/* Style sp√©cifique ESP */
.chip-esp {
  background-color: #cc0000; /* Rouge pour ESP */
  color: white;
}

/* Badges pour sous-menu */
.sub-menu .chip-sub {
  font-size: 0.65rem;
  padding: 0.15rem 0.5rem;
  margin-left: 5px;
}

/* Badges dans les liens de navigation */
.sidebar ul li a .chip {
 
  margin-top: 2px;
}

.sidebar .sub-menu li a .chip-sub {
  float: right;
  margin-top: 1px;
}

/* Responsive pour badges */
@media (max-width: 768px) {
  .chip {
    font-size: 0.6rem;
    padding: 0.15rem 0.4rem;
    margin-left: 5px;
  }
  
  .sub-menu .chip-sub {
    font-size: 0.55rem;
    padding: 0.1rem 0.3rem;
  }
}
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <div class="container header-content">
      <div class="logo">
        <i class="fas fa-microchip"></i>
        <div><span></span> Arduino/ESP </div>
      </div>
      <button class="hamburger-btn" aria-label="Menu">
        <i class="fas fa-bars"></i>
      </button>
      
      <nav>
        <ul>
          <li><a href="index.html" class="active"><i class="fas fa-home"></i> Accueil</a></li>
          <!-- <li><a href="./pratique.html"><i class="fas fa-graduation-cap"></i> pratique</a></li> -->
          <li><a href="./exemple.html"><i class="fas fa-code"></i> Exemples</a></li>
          <li><a href="./reference.html"><i class="fas fa-book"></i> R√©f√©rence</a></li>
          <li><a href="./exercice.html"><i class="fas fa-pencil-alt"></i> Exercices</a></li>
          <li>
            <a href="./ide.html">
              <i class="fas fa-lightbulb"></i> Id√©e
            </a>
          </li>
          
        </ul>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <h1>ArduinoLearn - Tutoriels Complets</h1>
      <p>Apprenez la programmation Arduino et ESP de A √† Z avec des exemples pratiques et des projets concrets</p>
      <a href="#structure" class="cta-button">Commencer l'apprentissage <i class="fas fa-arrow-right"></i></a>
    </div>
  </section>
<!-- Bouton unique de navigation haut/bas -->
<button class="scroll-toggle-btn" title="Aller en bas">
  <i class="fas fa-arrow-down"></i>
</button>
  <!-- Main Content -->
  <div class="container main-content">
    <!-- Sidebar avec navigation compl√®te -->
    <aside class="sidebar">
      <h3><i class="fas fa-list"></i> Navigation</h3>
      <ul>
        <li><a href="#introduction"><i class="fas fa-play"></i> Introduction <span class="chip">ESP/ARDUINO</span></a></li>
        <li><a href="#premier-programme"><i class="fas fa-code"></i> Premier programme <span class="chip">ESP/ARDUINO</span></a></li>
    
        <li><a href="#structure" class="active"><i class="fas fa-sitemap"></i> Structure avanc√©e <span class="chip">ESP/ARDUINO</span></a></li>
    
        <li>
          <a href="#variables"><i class="fas fa-memory"></i> Variables et types <span class="chip">ESP/ARDUINO</span></a>
          <ul class="sub-menu">
            <li><a href="#types-donnees">Types de donn√©es <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#declaration">D√©claration <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#portee">Port√©e des variables <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#constantes">Constantes <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#tableaux">Tableaux <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#structures">Structures <span class="chip-sub">ESP/ARDUINO</span></a></li>
          </ul>
        </li>
    
        <li>
          <a href="#fonctions"><i class="fas fa-cogs"></i> Fonctions de base <span class="chip">ESP/ARDUINO</span></a>
          <ul class="sub-menu">
            <li><a href="#fonctions-arduino">Fonctions Arduino <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#fonctions-personnalisees">Fonctions personnalis√©es <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#parametres-retour">Param√®tres et retour <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#recursivite">R√©cursivit√© <span class="chip-sub">ESP/ARDUINO</span></a></li>
          </ul>
        </li>
    
        <li>
          <a href="#entrees-sorties"><i class="fas fa-exchange-alt"></i> Entr√©es/Sorties <span class="chip">ESP/ARDUINO</span></a>
          <ul class="sub-menu">
            <li><a href="#digital">Digital I/O <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#analog">Analog I/O <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#pwm">PWM <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#interruptions">Interruptions <span class="chip-sub">ESP/ARDUINO</span></a></li>
          </ul>
        </li>
    
        <li>
          <a href="#allumer-led"><i class="fas fa-lightbulb"></i> Allumer une LED <span class="chip">ESP/ARDUINO</span></a>
          <ul class="sub-menu">
            <li><a href="#led-simple">LED simple <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#led-clignotante">LED clignotante <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#led-pwm">LED PWM <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#led-rvb">LED RVB <span class="chip-sub">ESP/ARDUINO</span></a></li>
          </ul>
        </li>
    
        <li>
          <a href="#bibliotheques"><i class="fas fa-book"></i> Biblioth√®ques (.h) <span class="chip">ESP/ARDUINO</span></a>
          <ul class="sub-menu">
            <li><a href="#utilisation-biblio">Utilisation <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#creation-biblio">Cr√©ation <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#biblio-standard">Biblioth√®ques standard <span class="chip-sub">ESP/ARDUINO</span></a></li>
          </ul>
        </li>
    
        <li>
          <a href="#structures-controle"><i class="fas fa-project-diagram"></i> Structures de contr√¥le <span class="chip">ESP/ARDUINO</span></a>
          <ul class="sub-menu">
            <li><a href="#conditions">Conditions <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#boucles">Boucles <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#switch-case">Switch Case <span class="chip-sub">ESP/ARDUINO</span></a></li>
          </ul>
        </li>
    
        <li>
          <a href="#communication"><i class="fas fa-wifi"></i> Communication ESP <span class="chip chip-esp">ESP</span></a>
          <ul class="sub-menu">
            <li><a href="#wifi">WiFi <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#bluetooth">Bluetooth <span class="chip-sub chip-esp">ESP32</span></a></li>
            <li><a href="#mqtt">MQTT <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#web-server">Serveur Web <span class="chip-sub chip-esp">ESP</span></a></li>
          </ul>
        </li>
    
        <li>
          <a href="#systeme-fichiers"><i class="fas fa-folder"></i> Syst√®me de fichiers <span class="chip chip-esp">ESP</span></a>
          <ul class="sub-menu">
            <li><a href="#littlefs-spiffs">LittleFS/SPIFFS <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#gestion-fichiers">Gestion fichiers <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#sd-card">Carte SD <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#partitionnement">Partitionnement <span class="chip-sub chip-esp">ESP32</span></a></li>
          </ul>
        </li>
        
        <li>
          <a href="#communication-avancee"><i class="fas fa-satellite-dish"></i> Communication avanc√©e <span class="chip chip-esp">ESP</span></a>
          <ul class="sub-menu">
            <li><a href="#websocket">WebSocket <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#webserial">WebSerial <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#ota">OTA (Mise √† jour OTA) <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#ble-midi">BLE MIDI/Audio <span class="chip-sub chip-esp">ESP32</span></a></li>
          </ul>
        </li>
        
        <li>
          <a href="#optimisation"><i class="fas fa-tachometer-alt"></i> Optimisation <span class="chip chip-esp">ESP</span></a>
          <ul class="sub-menu">
            <li><a href="#gestion-memoire">Gestion m√©moire <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#low-power">Mode basse consommation <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#debogage">Techniques de d√©bogage <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#multitache">Multit√¢che (FreeRTOS) <span class="chip-sub chip-esp">ESP32</span></a></li>
          </ul>
        </li>
        
        <li>
          <a href="#securite"><i class="fas fa-shield-alt"></i> S√©curit√© <span class="chip chip-esp">ESP</span></a>
          <ul class="sub-menu">
            <li><a href="#ssl-tls">SSL/TLS <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#authentification">Authentification <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#chiffrement">Chiffrement <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#best-practices">Bonnes pratiques <span class="chip-sub">ESP/ARDUINO</span></a></li>
          </ul>
        </li>
        
        <li>
          <a href="#integration-avancee"><i class="fas fa-cloud"></i> Int√©gration avanc√©e <span class="chip chip-esp">ESP</span></a>
          <ul class="sub-menu">
            <li><a href="#home-assistant">Home Assistant <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#node-red">Node-RED <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#aws-iot">AWS IoT / Azure <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#api-rest">API REST avanc√©e <span class="chip-sub chip-esp">ESP</span></a></li>
          </ul>
        </li>
    
        <li>
          <a href="#projets"><i class="fas fa-rocket"></i> Projets pratiques <span class="chip">ESP/ARDUINO</span></a>
          <ul class="sub-menu">
            <li><a href="#projet1">Station m√©t√©o <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#projet2">Contr√¥le domotique <span class="chip-sub chip-esp">ESP</span></a></li>
            <li><a href="#projet3">Robot suiveur <span class="chip-sub">ESP/ARDUINO</span></a></li>
            <li><a href="#projet4">Syst√®me d'arrosage <span class="chip-sub chip-esp">ESP</span></a></li>
          </ul>
        </li>
      </ul>
    </aside>

    <!-- Content -->
    <main class="content">
      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <a href="index.html">Accueil</a> <i class="fas fa-chevron-right"></i>
        <a href="#tutoriels">Tutoriels</a> <i class="fas fa-chevron-right"></i>
        <span>Structure avanc√©e</span>
      </div>

      <!-- Introduction -->
      <section id="introduction">
        <h2>Introduction √† Arduino et ESP</h2>
      
        <p>
          Arduino et ESP sont des plateformes de d√©veloppement utilis√©es pour cr√©er des projets √©lectroniques
          interactifs et intelligents. Elles permettent de contr√¥ler des composants (LED, moteurs, capteurs)
          et de communiquer avec le monde ext√©rieur (WiFi, Bluetooth, Internet).
        </p>
      
        <p>
          Ce site a pour objectif de vous accompagner <strong>pas √† pas</strong>, depuis les bases,
          jusqu‚Äô√† des projets concrets en Arduino et ESP, m√™me si vous √™tes d√©butant.
        </p>
      
        <h3>Pourquoi apprendre Arduino et ESP ?</h3>
        <ul>
          <li><strong>Facile √† apprendre</strong> : id√©al pour d√©buter en √©lectronique et en programmation</li>
          <li><strong>Tr√®s utilis√©</strong> : enseignement, industrie, domotique, IoT</li>
          <li><strong>Grande communaut√©</strong> : aide, exemples et biblioth√®ques</li>
          <li><strong>Peu co√ªteux</strong> : cartes et composants abordables</li>
          <li><strong>Connectivit√©</strong> : WiFi et Bluetooth avec ESP</li>
        </ul>
      
        <h3>Diff√©rences entre Arduino et ESP</h3>
        <ul>
          <li><strong>Arduino Uno / Nano</strong> : parfait pour apprendre les bases (LED, boutons, capteurs)</li>
          <li><strong>ESP8266</strong> : microcontr√¥leur avec WiFi int√©gr√©</li>
          <li><strong>ESP32</strong> : plus puissant, WiFi + Bluetooth, multi-c≈ìur</li>
          <li><strong>Tension logique</strong> : Arduino = 5V / ESP = 3.3V ‚ö†Ô∏è</li>
        </ul>
      
        <div class="info-box">
          <p>
            <strong>Important :</strong> Une mauvaise tension peut endommager votre ESP.
            V√©rifiez toujours les niveaux logiques avant de connecter un composant.
          </p>
        </div>
      
        <h3>Mat√©riel n√©cessaire pour d√©buter</h3>
        <div class="cards">
          <div class="card">
            <i class="fas fa-microchip"></i>
            <h4>Carte Arduino</h4>
            <p>Uno, Nano ou Mega</p>
          </div>
          <div class="card">
            <i class="fas fa-wifi"></i>
            <h4>Module ESP</h4>
            <p>ESP8266 ou ESP32</p>
          </div>
          <div class="card">
            <i class="fas fa-usb"></i>
            <h4>C√¢ble USB</h4>
            <p>Pour programmer et alimenter la carte</p>
          </div>
          <div class="card">
            <i class="fas fa-lightbulb"></i>
            <h4>Composants</h4>
            <p>LED, r√©sistances, boutons, capteurs</p>
          </div>
        </div>
      
        <h3>√âditeurs de code recommand√©s</h3>
        <p>
          Pour programmer Arduino et ESP, vous aurez besoin d‚Äôun √©diteur de code adapt√©.
          Deux solutions sont principalement utilis√©es.
        </p>
      
        <ul>
          <li>
            <strong>Arduino IDE</strong> : simple et id√©al pour les d√©butants
          </li>
          <li>
            <strong>Visual Studio Code (VS Code)</strong> : plus puissant et professionnel
          </li>
        </ul>
      
        <h3>T√©l√©chargements utiles</h3>
        <ul>
          <li>
            üîó VS Code :
            <a href="https://code.visualstudio.com/" target="_blank">
              https://code.visualstudio.com/
            </a>
          </li>
          <li>
            üîó Arduino IDE :
            <a href="https://www.arduino.cc/en/software" target="_blank">
              https://www.arduino.cc/en/software
            </a>
          </li>
        </ul>
      
        <h3>PlatformIO (recommand√©)</h3>
        <p>
          PlatformIO est un environnement de d√©veloppement moderne int√©gr√© √† VS Code.
          Il simplifie la gestion des cartes, des biblioth√®ques et des projets Arduino/ESP.
        </p>
      
        <ul>
          <li>Installation automatique des biblioth√®ques</li>
          <li>Support Arduino, ESP32, ESP8266 et bien plus</li>
          <li>Compilation rapide et fiable</li>
          <li>Moniteur s√©rie int√©gr√©</li>
        </ul>
      
        <h3>Liens utiles PlatformIO</h3>
        <ul>
          <li>
            üîó Site officiel :
            <a href="https://platformio.org/" target="_blank">
              https://platformio.org/
            </a>
          </li>
          <li>
            üîó Documentation :
            <a href="https://docs.platformio.org/" target="_blank">
              https://docs.platformio.org/
            </a>
          </li>
          <li>
            üîó Installation VS Code :
            <a href="https://platformio.org/install/ide?install=vscode" target="_blank">
              https://platformio.org/install/ide?install=vscode
            </a>
          </li>
        </ul>
      
        <div class="info-box">
          <p>
            <strong>Conseil :</strong> Si vous d√©butez totalement, commencez avec Arduino IDE.
            Si vous voulez travailler comme un d√©veloppeur professionnel, utilisez VS Code + PlatformIO.
          </p>
        </div>
      
        <h3>Choses √† comprendre avant de coder</h3>
        <ul>
          <li>Le r√¥le de <code>setup()</code> et <code>loop()</code></li>
          <li>Les broches GPIO (entr√©e / sortie)</li>
          <li>Le port s√©rie (Serial Monitor)</li>
          <li>La diff√©rence entre alimentation et donn√©es</li>
          <li>La lecture d‚Äôun sch√©ma simple</li>
        </ul>
      
        <h3>Avant de passer √† la pratique</h3>
        <p>
          Prenez le temps de comprendre le fonctionnement de la carte et de l‚Äôenvironnement de d√©veloppement.
          Une bonne base √©vite les erreurs, les bugs et les composants endommag√©s.
        </p>
      
        <div class="info-box">
          <p>
            <strong>Objectif du site :</strong> Apprendre Arduino et ESP de fa√ßon simple,
            progressive et pratique, avec des exemples clairs et des exercices guid√©s.
          </p>
        </div>
      </section>
      
      
      <!-- Installation IDE -->
      <section id="installation">
        <h2>Installation de l'IDE Arduino</h2>
        <p>L'IDE (Integrated Development Environment) Arduino est le logiciel utilis√© pour programmer les cartes Arduino
          et ESP.</p>

        <h3>√âtapes d'installation</h3>
        <ol>
          <li><strong>T√©l√©chargement</strong> : Rendez-vous sur <a href="https://www.arduino.cc"
              target="_blank">arduino.cc</a> et t√©l√©chargez la version correspondant √† votre syst√®me d'exploitation</li>
          <li><strong>Installation</strong> : Ex√©cutez le fichier d'installation et suivez les instructions</li>
          <li><strong>Drivers</strong> : L'installation inclut g√©n√©ralement les drivers USB n√©cessaires</li>
          <li><strong>Configuration ESP</strong> : Pour ESP32/ESP8266, ajoutez les URLs des cartes dans Fichier ‚Üí
            Pr√©f√©rences</li>
        </ol>

        <h3>Configuration pour ESP</h3>
        <div class="code-example">
          <h4>URLs √† ajouter pour ESP</h4>
          <pre><code><span class="code-comment">// Pour ESP32 :</span>
https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json

<span class="code-comment">// Pour ESP8266 :</span>
http://arduino.esp8266.com/stable/package_esp8266com_index.json</code></pre>
        </div>

        <div class="info-box">
          <p><strong>Astuce :</strong> Apr√®s avoir ajout√© les URLs, allez dans Outils ‚Üí Type de carte ‚Üí Gestionnaire de
            cartes pour installer les plateformes ESP.</p>
        </div>
      </section>
      <!-- Premier programme -->
      <section id="premier-programme">
        <h2>Votre premier programme Arduino</h2>
        <p>Le programme "Blink" (clignotement) est traditionnellement le premier programme qu'on √©crit en Arduino. Il
          fait clignoter la LED int√©gr√©e √† la carte.</p>

        <h3>Structure de base</h3>
        <div class="code-example">
          <h4>Structure minimale d'un sketch Arduino</h4>
          <pre><code><span class="code-comment">// La fonction setup() s'ex√©cute une fois au d√©marrage</span>
<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  <span class="code-comment">// Code d'initialisation ici</span>
}

<span class="code-comment">// La fonction loop() s'ex√©cute en boucle ind√©finiment</span>
<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Code principal ici</span>
}</code></pre>
        </div>

        <h3>Premier exemple : LED clignotante</h3>
        <div class="code-example">
          <h4>Programme Blink complet</h4>
          <pre><code><span class="code-comment">/*
  Premier programme Arduino - Blink
  Fait clignoter la LED int√©gr√©e (broche 13)
*/</span>

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  <span class="code-comment">// Initialise la broche 13 comme sortie</span>
  <span class="code-function">pinMode</span>(LED_BUILTIN, OUTPUT);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Allume la LED</span>
  <span class="code-function">digitalWrite</span>(LED_BUILTIN, HIGH);
  <span class="code-function">delay</span>(1000);  <span class="code-comment">// Attend 1 seconde</span>
  
  <span class="code-comment">// √âteint la LED</span>
  <span class="code-function">digitalWrite</span>(LED_BUILTIN, LOW);
  <span class="code-function">delay</span>(1000);  <span class="code-comment">// Attend 1 seconde</span>
}</code></pre>
        </div>

        <h3>Explications d√©taill√©es</h3>
        <ol>
          <li><code>pinMode(LED_BUILTIN, OUTPUT)</code> : Configure la broche de la LED comme sortie</li>
          <li><code>digitalWrite(LED_BUILTIN, HIGH)</code> : Applique 5V pour allumer la LED</li>
          <li><code>delay(1000)</code> : Met le programme en pause pendant 1000ms (1 seconde)</li>
          <li><code>digitalWrite(LED_BUILTIN, LOW)</code> : Coupe le courant pour √©teindre la LED</li>
          <li>La fonction <code>loop()</code> r√©p√®te ces instructions ind√©finiment</li>
        </ol>

        <div class="warning-box">
          <p><strong>Important :</strong> Les fonctions <code>setup()</code> et <code>loop()</code> sont obligatoires
            dans tout programme Arduino, m√™me si elles sont vides.</p>
        </div>

        <h3>Installation de l'IDE Arduino</h3>
        <div class="cards">
          <div class="card">
            <i class="fas fa-download"></i>
            <h4>√âtape 1 : T√©l√©chargement</h4>
            <p>T√©l√©chargez l'IDE Arduino sur <a href="https://www.arduino.cc" target="_blank">arduino.cc</a></p>
          </div>
          <div class="card">
            <i class="fas fa-plug"></i>
            <h4>√âtape 2 : Installation</h4>
            <p>Installez l'IDE et les drivers USB n√©cessaires</p>
          </div>
          <div class="card">
            <i class="fas fa-cog"></i>
            <h4>√âtape 3 : Configuration</h4>
            <p>S√©lectionnez votre carte dans Outils ‚Üí Type de carte</p>
          </div>
          <div class="card">
            <i class="fas fa-upload"></i>
            <h4>√âtape 4 : Upload</h4>
            <p>Compilez et transf√©rez votre programme sur la carte</p>
          </div>
        </div>
      </section>

      <!-- Navigation buttons pour ces sections -->
      <div class="nav-buttons">
        <a href="#installation" class="nav-button prev"><i class="fas fa-arrow-left"></i> Installation IDE</a>
        <a href="#structure" class="nav-button next">Structure avanc√©e <i class="fas fa-arrow-right"></i></a>
      </div>

      <!-- =========================================== -->
      <!-- SECTION STRUCTURE AVANC√âE -->
      <!-- =========================================== -->
      <section id="structure">
        <h2>Structure avanc√©e d'un programme Arduino</h2>
        <p>Un programme Arduino bien structur√© est plus lisible, maintenable et r√©utilisable. Voyons les √©l√©ments
          avanc√©s de structure.</p>

        <h3>Organisation d'un programme complet</h3>
        <div class="code-example">
          <h4>Structure compl√®te d'un programme Arduino</h4>
          <pre><code><span class="code-comment">/* 
  Nom du programme : Contr√¥le de LED avec capteur
  Auteur : Votre Nom
  Date : 2023
  Description : Programme qui contr√¥le une LED en fonction d'un capteur
*/</span>

<span class="code-comment">// ===========================================
// SECTION 1 : INCLUSIONS DE BIBLIOTH√àQUES
// ===========================================</span>
<span class="code-keyword">#include</span> &lt;Wire.h&gt;      <span class="code-comment">// Pour la communication I2C</span>
<span class="code-keyword">#include</span> &lt;SPI.h&gt;       <span class="code-comment">// Pour la communication SPI</span>

<span class="code-comment">// ===========================================
// SECTION 2 : D√âFINITIONS ET CONSTANTES
// ===========================================</span>
<span class="code-keyword">#define</span> LED_PIN 13      <span class="code-comment">// Broche de la LED</span>
<span class="code-keyword">#define</span> SENSOR_PIN A0   <span class="code-comment">// Broche du capteur analogique</span>
<span class="code-keyword">#define</span> SEUIL 500       <span class="code-comment">// Seuil d'activation</span>

<span class="code-keyword">const</span> <span class="code-keyword">int</span> DELAI_ATTENTE = 100;  <span class="code-comment">// D√©lai en ms</span>
<span class="code-keyword">const</span> <span class="code-keyword">float</span> VERSION = 1.2;      <span class="code-comment">// Version du programme</span>

<span class="code-comment">// ===========================================
// SECTION 3 : D√âCLARATION DE VARIABLES GLOBALES
// ===========================================</span>
<span class="code-keyword">int</span> valeurCapteur = 0;      <span class="code-comment">// Valeur lue du capteur</span>
<span class="code-keyword">bool</span> ledAllumee = <span class="code-keyword">false</span>;      <span class="code-comment">// √âtat de la LED</span>
<span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierTemps = 0;  <span class="code-comment">// Pour le timing</span>

<span class="code-comment">// ===========================================
// SECTION 4 : D√âCLARATION DE FONCTIONS
// ===========================================</span>
<span class="code-keyword">void</span> lireCapteur();
<span class="code-keyword">void</span> controlerLED(<span class="code-keyword">int</span> valeur);
<span class="code-keyword">void</span> afficherInfos();

<span class="code-comment">// ===========================================
// SECTION 5 : FONCTION SETUP (INITIALISATION)
// ===========================================</span>
<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  <span class="code-comment">// Initialisation de la communication s√©rie</span>
  Serial.<span class="code-function">begin</span>(9600);
  
  <span class="code-comment">// Configuration des broches</span>
  <span class="code-function">pinMode</span>(LED_PIN, OUTPUT);
  <span class="code-function">pinMode</span>(SENSOR_PIN, INPUT);
  
  <span class="code-comment">// Message de d√©marrage</span>
  Serial.<span class="code-function">println</span>(<span class="code-string">"=== Programme de controle LED ==="</span>);
  Serial.<span class="code-function">print</span>(<span class="code-string">"Version: "</span>);
  Serial.<span class="code-function">println</span>(VERSION);
}

<span class="code-comment">// ===========================================
// SECTION 6 : FONCTION LOOP (BOUCLE PRINCIPALE)
// ===========================================</span>
<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Lecture du capteur</span>
  lireCapteur();
  
  <span class="code-comment">// Contr√¥le de la LED</span>
  controlerLED(valeurCapteur);
  
  <span class="code-comment">// Affichage p√©riodique des informations</span>
  <span class="code-keyword">if</span> (<span class="code-function">millis</span>() - dernierTemps > 5000) {
    afficherInfos();
    dernierTemps = <span class="code-function">millis</span>();
  }
  
  <span class="code-function">delay</span>(DELAI_ATTENTE);
}

<span class="code-comment">// ===========================================
// SECTION 7 : D√âFINITION DES FONCTIONS
// ===========================================</span>

<span class="code-comment">// Fonction pour lire la valeur du capteur</span>
<span class="code-keyword">void</span> <span class="code-function">lireCapteur</span>() {
  valeurCapteur = <span class="code-function">analogRead</span>(SENSOR_PIN);
}

<span class="code-comment">// Fonction pour contr√¥ler la LED</span>
<span class="code-keyword">void</span> <span class="code-function">controlerLED</span>(<span class="code-keyword">int</span> valeur) {
  <span class="code-keyword">if</span> (valeur > SEUIL) {
    <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
    ledAllumee = <span class="code-keyword">true</span>;
  } <span class="code-keyword">else</span> {
    <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
    ledAllumee = <span class="code-keyword">false</span>;
  }
}

<span class="code-comment">// Fonction pour afficher les informations</span>
<span class="code-keyword">void</span> <span class="code-function">afficherInfos</span>() {
  Serial.<span class="code-function">print</span>(<span class="code-string">"Valeur capteur: "</span>);
  Serial.<span class="code-function">println</span>(valeurCapteur);
  Serial.<span class="code-function">print</span>(<span class="code-string">"LED: "</span>);
  Serial.<span class="code-function">println</span>(ledAllumee ? <span class="code-string">"ALLUMEE"</span> : <span class="code-string">"ETEINTE"</span>);
  Serial.<span class="code-function">println</span>(<span class="code-string">"-------------------"</span>);
}</code></pre>
        </div>

        <div class="info-box">
          <p><strong>Conseil :</strong> Cette structure modulaire facilite la maintenance et le d√©bogage. Chaque section
            a un r√¥le sp√©cifique et les fonctions sont courtes et cibl√©es.</p>
        </div>
      </section>

      <!-- =========================================== -->
      <!-- SECTION VARIABLES ET TYPES -->
      <!-- =========================================== -->
      <section id="variables">
        <h2>Variables et types de donn√©es en C++/Arduino</h2>
        <p>Les variables sont des emplacements m√©moire pour stocker des donn√©es. Leur type d√©termine la taille de la
          m√©moire et les op√©rations possibles.</p>

        <h3 id="types-donnees">Types de donn√©es fondamentaux</h3>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Type</th>
                <th>Taille (bits)</th>
                <th>Plage de valeurs</th>
                <th>Description</th>
                <th>Exemple</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>boolean</code></td>
                <td>8</td>
                <td>0 (false) ou 1 (true)</td>
                <td>Valeur bool√©enne</td>
                <td><code>boolean ledOn = true;</code></td>
              </tr>
              <tr>
                <td><code>char</code></td>
                <td>8</td>
                <td>-128 √† 127</td>
                <td>Caract√®re ASCII</td>
                <td><code>char lettre = 'A';</code></td>
              </tr>
              <tr>
                <td><code>byte</code></td>
                <td>8</td>
                <td>0 √† 255</td>
                <td>Nombre non sign√©</td>
                <td><code>byte valeur = 200;</code></td>
              </tr>
              <tr>
                <td><code>int</code></td>
                <td>16</td>
                <td>-32,768 √† 32,767</td>
                <td>Entier sign√©</td>
                <td><code>int temperature = -5;</code></td>
              </tr>
              <tr>
                <td><code>unsigned int</code></td>
                <td>16</td>
                <td>0 √† 65,535</td>
                <td>Entier non sign√©</td>
                <td><code>unsigned int distance = 5000;</code></td>
              </tr>
              <tr>
                <td><code>long</code></td>
                <td>32</td>
                <td>-2,147,483,648 √† 2,147,483,647</td>
                <td>Entier long sign√©</td>
                <td><code>long population = 7000000L;</code></td>
              </tr>
              <tr>
                <td><code>unsigned long</code></td>
                <td>32</td>
                <td>0 √† 4,294,967,295</td>
                <td>Entier long non sign√©</td>
                <td><code>unsigned long temps = 4294967295UL;</code></td>
              </tr>
              <tr>
                <td><code>float</code></td>
                <td>32</td>
                <td>-3.4√ó10¬≥‚Å∏ √† 3.4√ó10¬≥‚Å∏</td>
                <td>Nombre √† virgule flottante</td>
                <td><code>float pi = 3.14159;</code></td>
              </tr>
              <tr>
                <td><code>double</code></td>
                <td>32*</td>
                <td>-3.4√ó10¬≥‚Å∏ √† 3.4√ó10¬≥‚Å∏</td>
                <td>Double pr√©cision*</td>
                <td><code>double precis = 3.1415926535;</code></td>
              </tr>
              <tr>
                <td><code>String</code></td>
                <td>Variable</td>
                <td>Cha√Æne de caract√®res</td>
                <td>Objet cha√Æne de caract√®res</td>
                <td><code>String message = "Hello";</code></td>
              </tr>
            </tbody>
          </table>
          <p class="code-comment" style="margin-top: 0.5rem;">* Sur Arduino, double a la m√™me taille que float (32 bits)
          </p>
        </div>

        <h3 id="declaration">D√©claration et initialisation des variables</h3>
        <div class="code-example">
          <h4>Exemples complets de d√©claration</h4>
          <pre><code><span class="code-comment">// D√©claration simple</span>
<span class="code-keyword">int</span> age;
<span class="code-keyword">float</span> temperature;
<span class="code-type">String</span> nom;

<span class="code-comment">// D√©claration avec initialisation</span>
<span class="code-keyword">int</span> compteur = 0;
<span class="code-keyword">float</span> prix = 19.99;
<span class="code-type">String</span> message = <span class="code-string">"Bienvenue"</span>;
<span class="code-keyword">bool</span> estActif = <span class="code-keyword">true</span>;

<span class="code-comment">// D√©claration multiple</span>
<span class="code-keyword">int</span> x = 0, y = 0, z = 0;
<span class="code-keyword">float</span> tempMin = -10.5, tempMax = 40.0;

<span class="code-comment">// Constantes (ne peuvent pas √™tre modifi√©es)</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 13;
<span class="code-keyword">const</span> <span class="code-keyword">float</span> PI = 3.14159;
<span class="code-keyword">const</span> <span class="code-type">String</span> NOM_PROGRAMME = <span class="code-string">"Controle LED"</span>;

<span class="code-comment">// D√©finition avec #define (pr√©processeur)</span>
<span class="code-keyword">#define</span> DELAI_MAX 1000
<span class="code-keyword">#define</span> MESSAGE_ERREUR <span class="code-string">"Erreur de connexion"</span></code></pre>
        </div>

        <h3 id="portee">Port√©e des variables</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">// Variable globale - accessible partout</span>
<span class="code-keyword">int</span> compteurGlobal = 0;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  <span class="code-comment">// Variable locale √† setup() - accessible seulement dans setup</span>
  <span class="code-keyword">int</span> compteurSetup = 10;
  compteurGlobal = 5;  <span class="code-comment">// OK - variable globale</span>
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Variable locale √† loop() - accessible seulement dans loop</span>
  <span class="code-keyword">int</span> compteurLoop = 20;
  
  <span class="code-comment">// compteurSetup = 15; // ERREUR! Variable non accessible</span>
  compteurGlobal = 30;  <span class="code-comment">// OK - variable globale</span>
  
  <span class="code-comment">// Variable statique - conserve sa valeur entre les appels</span>
  <span class="code-keyword">static</span> <span class="code-keyword">int</span> compteurStatique = 0;
  compteurStatique++;
  
  <span class="code-comment">// Variable avec mot-cl√© volatile (pour les interruptions)</span>
  <span class="code-keyword">volatile</span> <span class="code-keyword">int</span> compteurInterruption = 0;
}

<span class="code-comment">// Variable accessible seulement dans ce fichier</span>
<span class="code-keyword">static</span> <span class="code-keyword">int</span> variableFichier = 100;</code></pre>
        </div>

       
       
       <!-- Constantes -->
       <section id="constantes">
        <h3>Constantes en Arduino/C++</h3>
        <p>Les constantes sont des valeurs qui ne peuvent pas √™tre modifi√©es pendant l'ex√©cution du programme.</p>

        <div class="code-example">
          <h4>Diff√©rentes fa√ßons de d√©finir des constantes</h4>
          <pre><code><span class="code-comment">// 1. Avec le mot-cl√© const (recommand√©)</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 13;
<span class="code-keyword">const</span> <span class="code-keyword">float</span> PI = 3.14159;
<span class="code-keyword">const</span> <span class="code-type">String</span> NOM_PROGRAMME = <span class="code-string">"Controle LED"</span>;

<span class="code-comment">// 2. Avec #define (pr√©processeur)</span>
<span class="code-keyword">#define</span> DELAI_MAX 1000
<span class="code-keyword">#define</span> MESSAGE_ERREUR <span class="code-string">"Erreur de connexion"</span>
<span class="code-keyword">#define</span> SEUIL_TEMPERATURE 30.5

<span class="code-comment">// 3. Constantes pr√©d√©finies d'Arduino</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> led = LED_BUILTIN;  <span class="code-comment">// LED int√©gr√©e</span>
<span class="code-keyword">const</span> <span class="code-keyword">bool</span> etat = <span class="code-keyword">true</span>;        <span class="code-comment">// true et false sont des constantes</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> haut = HIGH;        <span class="code-comment">// HIGH et LOW sont des constantes</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> entree = INPUT;     <span class="code-comment">// INPUT, OUTPUT, INPUT_PULLUP</span>

<span class="code-comment">// 4. Enum√©rations (groupes de constantes)</span>
<span class="code-keyword">enum</span> Etats {
ATTENTE,
DEMARRAGE,
FONCTIONNEMENT,
ERREUR
};

<span class="code-keyword">enum</span> Couleurs {
ROUGE = 0xFF0000,
VERT = 0x00FF00,
BLEU = 0x0000FF,
JAUNE = 0xFFFF00
};</code></pre>
        </div>

        <div class="info-box">
          <p><strong>const vs #define :</strong> Utilisez <code>const</code> pour les constantes typ√©es (le
            compilateur v√©rifie le type). Utilisez <code>#define</code> pour les macros et valeurs simples.</p>
        </div>

        <h4>Exemple d'utilisation des constantes</h4>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
Programme d√©montrant l'utilisation des constantes
*/</span>

<span class="code-comment">// Constantes de configuration</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_LED_ROUGE = 9;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_LED_VERTE = 10;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_BOUTON = 2;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> DELAI_CLIGNOTEMENT = 500;
<span class="code-keyword">const</span> <span class="code-keyword">float</span> TEMPERATURE_MAX = 85.5;

<span class="code-comment">// D√©finition avec #define</span>
<span class="code-keyword">#define</span> NOMBRE_CYCLES 10
<span class="code-keyword">#define</span> VERSION <span class="code-string">"1.0.2"</span>

<span class="code-comment">// √ânum√©ration pour les √©tats</span>
<span class="code-keyword">enum</span> ModeFonctionnement {
MODE_NORMAL,
MODE_RAPIDE,
MODE_TEST
};

ModeFonctionnement modeActuel = MODE_NORMAL;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
Serial.<span class="code-function">begin</span>(9600);

<span class="code-comment">// Configuration des broches avec constantes</span>
<span class="code-function">pinMode</span>(PIN_LED_ROUGE, OUTPUT);
<span class="code-function">pinMode</span>(PIN_LED_VERTE, OUTPUT);
<span class="code-function">pinMode</span>(PIN_BOUTON, INPUT_PULLUP);

<span class="code-comment">// Affichage des informations de configuration</span>
Serial.<span class="code-function">print</span>(<span class="code-string">"Version: "</span>);
Serial.<span class="code-function">println</span>(VERSION);
Serial.<span class="code-function">print</span>(<span class="code-string">"Temperature max: "</span>);
Serial.<span class="code-function">println</span>(TEMPERATURE_MAX);
Serial.<span class="code-function">print</span>(<span class="code-string">"Delai: "</span>);
Serial.<span class="code-function">println</span>(DELAI_CLIGNOTEMENT);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
<span class="code-comment">// Utilisation des constantes dans le code</span>
<span class="code-keyword">static</span> <span class="code-keyword">int</span> compteur = 0;

<span class="code-keyword">switch</span> (modeActuel) {
  <span class="code-keyword">case</span> MODE_NORMAL:
    <span class="code-function">clignoterLED</span>(PIN_LED_VERTE, DELAI_CLIGNOTEMENT);
    <span class="code-keyword">break</span>;
    
  <span class="code-keyword">case</span> MODE_RAPIDE:
    <span class="code-function">clignoterLED</span>(PIN_LED_VERTE, DELAI_CLIGNOTEMENT / 2);
    <span class="code-keyword">break</span>;
    
  <span class="code-keyword">case</span> MODE_TEST:
    <span class="code-function">clignoterLED</span>(PIN_LED_ROUGE, 100);
    <span class="code-keyword">break</span>;
}

compteur++;
<span class="code-keyword">if</span> (compteur >= NOMBRE_CYCLES) {
  compteur = 0;
  <span class="code-function">changerMode</span>();
}

<span class="code-comment">// V√©rification d'une condition avec constante</span>
<span class="code-keyword">float</span> temperature = <span class="code-function">lireTemperature</span>();
<span class="code-keyword">if</span> (temperature > TEMPERATURE_MAX) {
  <span class="code-function">digitalWrite</span>(PIN_LED_ROUGE, HIGH);
  Serial.<span class="code-function">println</span>(<span class="code-string">"ALERTE: Temperature trop elevee!"</span>);
}
}

<span class="code-keyword">void</span> <span class="code-function">clignoterLED</span>(<span class="code-keyword">int</span> pin, <span class="code-keyword">int</span> delai) {
<span class="code-function">digitalWrite</span>(pin, HIGH);
<span class="code-function">delay</span>(delai);
<span class="code-function">digitalWrite</span>(pin, LOW);
<span class="code-function">delay</span>(delai);
}

<span class="code-keyword">void</span> <span class="code-function">changerMode</span>() {
modeActuel = <span class="code-keyword">static_cast</span>&lt;ModeFonctionnement&gt;((modeActuel + 1) % 3);
Serial.<span class="code-function">print</span>(<span class="code-string">"Mode change: "</span>);
Serial.<span class="code-function">println</span>(modeActuel);
}

<span class="code-keyword">float</span> <span class="code-function">lireTemperature</span>() {
<span class="code-comment">// Simulation de lecture de temp√©rature</span>
<span class="code-keyword">return</span> <span class="code-function">random</span>(20, 90) + <span class="code-function">random</span>(0, 100) / 100.0;
}</code></pre>
        </div>
      </section>
       
        <h3 id="tableaux">Tableaux (Arrays)</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">// D√©claration de tableaux</span>
<span class="code-keyword">int</span> temperatures[7];              <span class="code-comment">// Tableau de 7 entiers</span>
<span class="code-keyword">float</span> mesures[10] = {0};          <span class="code-comment">// Initialis√© √† 0</span>
<span class="code-keyword">char</span> message[] = <span class="code-string">"Hello"</span>;        <span class="code-comment">// Tableau de caract√®res</span>

<span class="code-comment">// Initialisation explicite</span>
<span class="code-keyword">int</span> pinsLED[] = {2, 4, 7, 8, 12, 13};
<span class="code-keyword">float</span> coefficients[3] = {1.2, 3.4, 5.6};
<span class="code-type">String</span> jours[7] = {<span class="code-string">"Lun"</span>, <span class="code-string">"Mar"</span>, <span class="code-string">"Mer"</span>, <span class="code-string">"Jeu"</span>, <span class="code-string">"Ven"</span>, <span class="code-string">"Sam"</span>, <span class="code-string">"Dim"</span>};

<span class="code-comment">// Tableaux multidimensionnels</span>
<span class="code-keyword">int</span> matrice[3][3] = {
  {1, 2, 3},
  {4, 5, 6},
  {7, 8, 9}
};

<span class="code-comment">// Utilisation des tableaux</span>
<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  
  <span class="code-comment">// Acc√®s aux √©l√©ments</span>
  temperatures[0] = 20;
  temperatures[1] = 22;
  
  <span class="code-comment">// Parcours d'un tableau</span>
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 6; i++) {
    <span class="code-function">pinMode</span>(pinsLED[i], OUTPUT);
  }
  
  <span class="code-comment">// Taille d'un tableau</span>
  <span class="code-keyword">int</span> taille = <span class="code-function">sizeof</span>(pinsLED) / <span class="code-function">sizeof</span>(pinsLED[0]);
  Serial.<span class="code-function">print</span>(<span class="code-string">"Nombre de LEDs: "</span>);
  Serial.<span class="code-function">println</span>(taille);
}</code></pre>
        </div>

        

        <!-- Structures (struct) -->
        <section id="structures">
          <h3>Structures (struct) en C++</h3>
          <p>Les structures permettent de regrouper plusieurs variables de types diff√©rents sous un seul nom.</p>

          <div class="code-example">
            <h4>D√©claration et utilisation des structures</h4>
            <pre><code><span class="code-comment">// D√©claration d'une structure</span>
<span class="code-keyword">struct</span> Capteur {
  <span class="code-keyword">int</span> pin;              <span class="code-comment">// Broche du capteur</span>
  <span class="code-keyword">float</span> valeur;         <span class="code-comment">// Valeur lue</span>
  <span class="code-keyword">float</span> valeurMin;      <span class="code-comment">// Valeur minimale</span>
  <span class="code-keyword">float</span> valeurMax;      <span class="code-comment">// Valeur maximale</span>
  <span class="code-type">String</span> nom;          <span class="code-comment">// Nom du capteur</span>
  <span class="code-keyword">bool</span> actif;           <span class="code-comment">// √âtat actif/inactif</span>
};

<span class="code-comment">// D√©claration avec initialisation</span>
<span class="code-keyword">struct</span> Point {
  <span class="code-keyword">int</span> x = 0;
  <span class="code-keyword">int</span> y = 0;
};

<span class="code-comment">// Structure avec m√©thodes</span>
<span class="code-keyword">struct</span> LED {
  <span class="code-keyword">int</span> pin;
  <span class="code-keyword">bool</span> allumee;
  
  <span class="code-comment">// Constructeur</span>
  LED(<span class="code-keyword">int</span> p) : pin(p), allumee(<span class="code-keyword">false</span>) {
    <span class="code-function">pinMode</span>(pin, OUTPUT);
  }
  
  <span class="code-comment">// M√©thodes</span>
  <span class="code-keyword">void</span> <span class="code-function">allumer</span>() {
    <span class="code-function">digitalWrite</span>(pin, HIGH);
    allumee = <span class="code-keyword">true</span>;
  }
  
  <span class="code-keyword">void</span> <span class="code-function">eteindre</span>() {
    <span class="code-function">digitalWrite</span>(pin, LOW);
    allumee = <span class="code-keyword">false</span>;
  }
  
  <span class="code-keyword">void</span> <span class="code-function">toggle</span>() {
    <span class="code-keyword">if</span> (allumee) {
      <span class="code-function">eteindre</span>();
    } <span class="code-keyword">else</span> {
      <span class="code-function">allumer</span>();
    }
  }
};

<span class="code-comment">// Tableau de structures</span>
<span class="code-keyword">struct</span> Etudiant {
  <span class="code-type">String</span> nom;
  <span class="code-keyword">int</span> age;
  <span class="code-keyword">float</span> moyenne;
};

<span class="code-comment">// Structure imbriqu√©e</span>
<span class="code-keyword">struct</span> Adresse {
  <span class="code-type">String</span> rue;
  <span class="code-type">String</span> ville;
  <span class="code-type">String</span> codePostal;
};

<span class="code-keyword">struct</span> Personne {
  <span class="code-type">String</span> nom;
  <span class="code-keyword">int</span> age;
  Adresse adresse;  <span class="code-comment">// Structure imbriqu√©e</span>
};</code></pre>
          </div>

          <h4>Exemple complet avec structures</h4>
          <div class="code-example">
            <pre><code><span class="code-comment">/*
  Programme d√©montrant l'utilisation des structures
  Gestion de plusieurs capteurs avec structures
*/</span>

<span class="code-comment">// D√©finition des structures</span>
<span class="code-keyword">struct</span> CapteurTemperature {
  <span class="code-keyword">int</span> pin;
  <span class="code-type">String</span> nom;
  <span class="code-keyword">float</span> temperature;
  <span class="code-keyword">float</span> seuilAlerte;
  <span class="code-keyword">bool</span> alerteActive;
  
  <span class="code-comment">// M√©thode pour initialiser le capteur</span>
  <span class="code-keyword">void</span> <span class="code-function">initialiser</span>() {
    temperature = 0.0;
    alerteActive = <span class="code-keyword">false</span>;
    Serial.<span class="code-function">print</span>(<span class="code-string">"Capteur "</span>);
    Serial.<span class="code-function">print</span>(nom);
    Serial.<span class="code-function">print</span>(<span class="code-string">" initialise sur pin "</span>);
    Serial.<span class="code-function">println</span>(pin);
  }
  
  <span class="code-comment">// M√©thode pour lire la temp√©rature (simul√©e)</span>
  <span class="code-keyword">void</span> <span class="code-function">lireTemperature</span>() {
    <span class="code-comment">// Simulation de lecture</span>
    temperature = 20.0 + <span class="code-function">random</span>(0, 150) / 10.0;
    
    <span class="code-comment">// V√©rification d'alerte</span>
    alerteActive = (temperature > seuilAlerte);
  }
  
  <span class="code-comment">// M√©thode pour afficher les informations</span>
  <span class="code-keyword">void</span> <span class="code-function">afficher</span>() {
    Serial.<span class="code-function">print</span>(nom);
    Serial.<span class="code-function">print</span>(<span class="code-string">": "</span>);
    Serial.<span class="code-function">print</span>(temperature);
    Serial.<span class="code-function">print</span>(<span class="code-string">"¬∞C"</span>);
    
    <span class="code-keyword">if</span> (alerteActive) {
      Serial.<span class="code-function">println</span>(<span class="code-string">" [ALERTE!]"</span>);
    } <span class="code-keyword">else</span> {
      Serial.<span class="code-function">println</span>();
    }
  }
};

<span class="code-keyword">struct</span> SystemeControle {
  CapteurTemperature capteurs[3];
  <span class="code-keyword">int</span> nombreCapteurs;
  <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierScan;
  
  <span class="code-comment">// Initialisation du syst√®me</span>
  <span class="code-keyword">void</span> <span class="code-function">initialiser</span>() {
    nombreCapteurs = 3;
    
    <span class="code-comment">// Configuration des capteurs</span>
    capteurs[0] = {A0, <span class="code-string">"Salon"</span>, 0.0, 25.0, <span class="code-keyword">false</span>};
    capteurs[1] = {A1, <span class="code-string">"Cuisine"</span>, 0.0, 30.0, <span class="code-keyword">false</span>};
    capteurs[2] = {A2, <span class="code-string">"Chambre"</span>, 0.0, 22.0, <span class="code-keyword">false</span>};
    
    <span class="code-comment">// Initialisation de chaque capteur</span>
    <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < nombreCapteurs; i++) {
      capteurs[i].<span class="code-function">initialiser</span>();
    }
    
    dernierScan = 0;
    Serial.<span class="code-function">println</span>(<span class="code-string">"Systeme de controle initialise"</span>);
  }
  
  <span class="code-comment">// Scanner tous les capteurs</span>
  <span class="code-keyword">void</span> <span class="code-function">scannerCapteurs</span>() {
    <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> maintenant = <span class="code-function">millis</span>();
    
    <span class="code-keyword">if</span> (maintenant - dernierScan > 2000) { <span class="code-comment">// Toutes les 2 secondes</span>
      dernierScan = maintenant;
      
      Serial.<span class="code-function">println</span>(<span class="code-string">"=== Scan des capteurs ==="</span>);
      
      <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < nombreCapteurs; i++) {
        capteurs[i].<span class="code-function">lireTemperature</span>();
        capteurs[i].<span class="code-function">afficher</span>();
      }
      
      Serial.<span class="code-function">println</span>();
    }
  }
  
  <span class="code-comment">// V√©rifier les alertes</span>
  <span class="code-keyword">bool</span> <span class="code-function">verifierAlertes</span>() {
    <span class="code-keyword">bool</span> alerte = <span class="code-keyword">false</span>;
    
    <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < nombreCapteurs; i++) {
      <span class="code-keyword">if</span> (capteurs[i].alerteActive) {
        alerte = <span class="code-keyword">true</span>;
        Serial.<span class="code-function">print</span>(<span class="code-string">"ALERTE: "</span>);
        Serial.<span class="code-function">print</span>(capteurs[i].nom);
        Serial.<span class="code-function">print</span>(<span class="code-string">" temperature trop elevee ("</span>);
        Serial.<span class="code-function">print</span>(capteurs[i].temperature);
        Serial.<span class="code-function">println</span>(<span class="code-string">"¬∞C)"</span>);
      }
    }
    
    <span class="code-keyword">return</span> alerte;
  }
};

<span class="code-comment">// Variables globales</span>
SystemeControle systeme;

<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_ALERTE = 13;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  <span class="code-function">pinMode</span>(LED_ALERTE, OUTPUT);
  
  <span class="code-comment">// Initialisation avec graine al√©atoire</span>
  <span class="code-function">randomSeed</span>(<span class="code-function">analogRead</span>(A5));
  
  <span class="code-comment">// Initialisation du syst√®me</span>
  systeme.<span class="code-function">initialiser</span>();
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Scanner les capteurs</span>
  systeme.<span class="code-function">scannerCapteurs</span>();
  
  <span class="code-comment">// V√©rifier les alertes</span>
  <span class="code-keyword">bool</span> alerte = systeme.<span class="code-function">verifierAlertes</span>();
  
  <span class="code-comment">// Contr√¥le de la LED d'alerte</span>
  <span class="code-keyword">if</span> (alerte) {
    <span class="code-function">digitalWrite</span>(LED_ALERTE, HIGH);
  } <span class="code-keyword">else</span> {
    <span class="code-function">digitalWrite</span>(LED_ALERTE, LOW);
  }
  
  <span class="code-function">delay</span>(100);
}</code></pre>
          </div>

          <div class="info-box">
            <p><strong>Note :</strong> En C++, les structures sont tr√®s similaires aux classes. La principale diff√©rence
              est que par d√©faut, les membres d'une structure sont publics, tandis que ceux d'une classe sont priv√©s.
            </p>
          </div>
        </section>
      </section>

      <!-- =========================================== -->
      <!-- SECTION FONCTIONS DE BASE -->
      <!-- =========================================== -->
      <section id="fonctions">
        <h2>Fonctions de base Arduino et fonctions personnalis√©es</h2>
        <p>Les fonctions permettent d'organiser le code en blocs r√©utilisables. Arduino fournit de nombreuses fonctions
          pr√©d√©finies.</p>

        <h3 id="fonctions-arduino">Fonctions Arduino essentielles</h3>
        <div class="cards">
          <div class="card">
            <i class="fas fa-terminal"></i>
            <h3>Entr√©es/Sorties Digitales</h3>
            <p><code>pinMode()</code>, <code>digitalWrite()</code>, <code>digitalRead()</code></p>
          </div>
          <div class="card">
            <i class="fas fa-wave-square"></i>
            <h3>Entr√©es/Sorties Analogiques</h3>
            <p><code>analogRead()</code>, <code>analogWrite()</code>, <code>analogReference()</code></p>
          </div>
          <div class="card">
            <i class="fas fa-clock"></i>
            <h3>Temps et D√©lais</h3>
            <p><code>delay()</code>, <code>delayMicroseconds()</code>, <code>millis()</code>, <code>micros()</code></p>
          </div>
          <div class="card">
            <i class="fas fa-broadcast-tower"></i>
            <h3>Communication S√©rie</h3>
            <p><code>Serial.begin()</code>, <code>Serial.print()</code>, <code>Serial.read()</code>, etc.</p>
          </div>
        </div>

        <div class="code-example">
          <h4>Exemples d'utilisation des fonctions Arduino</h4>
          <pre><code><span class="code-comment">// Configuration d'une broche</span>
<span class="code-function">pinMode</span>(13, OUTPUT);          <span class="code-comment">// Broche 13 en sortie</span>
<span class="code-function">pinMode</span>(2, INPUT_PULLUP);     <span class="code-comment">// Broche 2 en entr√©e avec r√©sistance pull-up</span>

<span class="code-comment">// √âcriture digitale</span>
<span class="code-function">digitalWrite</span>(13, HIGH);       <span class="code-comment">// Allume la LED</span>
<span class="code-function">digitalWrite</span>(13, LOW);        <span class="code-comment">// √âteint la LED</span>

<span class="code-comment">// Lecture digitale</span>
<span class="code-keyword">int</span> etatBouton = <span class="code-function">digitalRead</span>(2);

<span class="code-comment">// Lecture analogique (0-1023 pour 0-5V)</span>
<span class="code-keyword">int</span> valeurPotentiometre = <span class="code-function">analogRead</span>(A0);

<span class="code-comment">// √âcriture PWM (0-255 pour 0%-100%)</span>
<span class="code-function">analogWrite</span>(9, 128);          <span class="code-comment">// 50% de cycle</span>

<span class="code-comment">// Gestion du temps</span>
<span class="code-function">delay</span>(1000);                  <span class="code-comment">// Pause de 1 seconde</span>
<span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> tempsEcoule = <span class="code-function">millis</span>();  <span class="code-comment">// Temps depuis le d√©marrage</span>

<span class="code-comment">// Math√©matiques</span>
<span class="code-keyword">int</span> minimum = <span class="code-function">min</span>(10, 20);     <span class="code-comment">// Retourne 10</span>
<span class="code-keyword">int</span> maximum = <span class="code-function">max</span>(10, 20);     <span class="code-comment">// Retourne 20</span>
<span class="code-keyword">int</span> contrainte = <span class="code-function">constrain</span>(valeur, 0, 100);  <span class="code-comment">// Limite entre 0 et 100</span>
<span class="code-keyword">int</span> mappage = <span class="code-function">map</span>(valeur, 0, 1023, 0, 255);  <span class="code-comment">// Change l'√©chelle</span></code></pre>
        </div>

        <h3 id="fonctions-personnalisees">Cr√©ation de fonctions personnalis√©es</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">// Fonction sans param√®tre et sans valeur de retour</span>
<span class="code-keyword">void</span> <span class="code-function">clignoterLED</span>() {
  <span class="code-function">digitalWrite</span>(13, HIGH);
  <span class="code-function">delay</span>(500);
  <span class="code-function">digitalWrite</span>(13, LOW);
  <span class="code-function">delay</span>(500);
}

<span class="code-comment">// Fonction avec param√®tres</span>
<span class="code-keyword">void</span> <span class="code-function">clignoterBroche</span>(<span class="code-keyword">int</span> broche, <span class="code-keyword">int</span> duree) {
  <span class="code-function">digitalWrite</span>(broche, HIGH);
  <span class="code-function">delay</span>(duree);
  <span class="code-function">digitalWrite</span>(broche, LOW);
  <span class="code-function">delay</span>(duree);
}

<span class="code-comment">// Fonction avec valeur de retour</span>
<span class="code-keyword">int</span> <span class="code-function">calculerMoyenne</span>(<span class="code-keyword">int</span> a, <span class="code-keyword">int</span> b) {
  <span class="code-keyword">return</span> (a + b) / 2;
}

<span class="code-comment">// Fonction avec param√®tre par r√©f√©rence (modifie la variable originale)</span>
<span class="code-keyword">void</span> <span class="code-function">incrementer</span>(<span class="code-keyword">int</span> &valeur) {
  valeur++;
}

<span class="code-comment">// Fonction avec param√®tres par d√©faut</span>
<span class="code-keyword">void</span> <span class="code-function">clignoter</span>(<span class="code-keyword">int</span> broche = 13, <span class="code-keyword">int</span> duree = 1000) {
  <span class="code-function">digitalWrite</span>(broche, HIGH);
  <span class="code-function">delay</span>(duree);
  <span class="code-function">digitalWrite</span>(broche, LOW);
  <span class="code-function">delay</span>(duree);
}

<span class="code-comment">// Fonction surcharg√©e (m√™me nom, param√®tres diff√©rents)</span>
<span class="code-keyword">void</span> <span class="code-function">afficher</span>(<span class="code-keyword">int</span> nombre) {
  Serial.<span class="code-function">println</span>(nombre);
}

<span class="code-keyword">void</span> <span class="code-function">afficher</span>(<span class="code-type">String</span> texte) {
  Serial.<span class="code-function">println</span>(texte);
}

<span class="code-comment">// Fonction inline (pour les petites fonctions fr√©quemment appel√©es)</span>
<span class="code-keyword">inline</span> <span class="code-keyword">int</span> <span class="code-function">carre</span>(<span class="code-keyword">int</span> x) {
  <span class="code-keyword">return</span> x * x;
}

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  <span class="code-function">pinMode</span>(13, OUTPUT);
  
  <span class="code-comment">// Utilisation des fonctions</span>
  <span class="code-function">clignoterLED</span>();
  
  <span class="code-function">clignoterBroche</span>(13, 200);
  
  <span class="code-keyword">int</span> moyenne = <span class="code-function">calculerMoyenne</span>(10, 20);
  
  <span class="code-keyword">int</span> compteur = 5;
  <span class="code-function">incrementer</span>(compteur);  <span class="code-comment">// compteur devient 6</span>
  
  <span class="code-function">clignoter</span>();           <span class="code-comment">// Utilise les valeurs par d√©faut</span>
  <span class="code-function">clignoter</span>(9, 500);     <span class="code-comment">// Sp√©cifie les param√®tres</span>
  
  <span class="code-function">afficher</span>(42);          <span class="code-comment">// Appelle afficher(int)</span>
  <span class="code-function">afficher</span>(<span class="code-string">"Hello"</span>);    <span class="code-comment">// Appelle afficher(String)</span>
  
  <span class="code-keyword">int</span> resultat = <span class="code-function">carre</span>(5);  <span class="code-comment">// 25</span>
}</code></pre>
        </div>
        <!-- Param√®tres et retour de fonctions -->
        <section id="parametres-retour">
          <h3>Param√®tres et valeurs de retour des fonctions</h3>
          <p>Les fonctions peuvent recevoir des param√®tres (donn√©es d'entr√©e) et retourner des valeurs (donn√©es de
            sortie).</p>

          <h4>Types de param√®tres</h4>
          <div class="code-example">
            <pre><code><span class="code-comment">// 1. Param√®tres par valeur (copie)</span>
<span class="code-keyword">void</span> <span class="code-function">incrementerParValeur</span>(<span class="code-keyword">int</span> x) {
x = x + 1;  <span class="code-comment">// Ne modifie pas la variable originale</span>
}

<span class="code-comment">// 2. Param√®tres par r√©f√©rence (modifie l'original)</span>
<span class="code-keyword">void</span> <span class="code-function">incrementerParReference</span>(<span class="code-keyword">int</span> &x) {
x = x + 1;  <span class="code-comment">// Modifie la variable originale</span>
}

<span class="code-comment">// 3. Param√®tres par pointeur</span>
<span class="code-keyword">void</span> <span class="code-function">incrementerParPointeur</span>(<span class="code-keyword">int</span> *x) {
*x = *x + 1;  <span class="code-comment">// Modifie la variable originale via pointeur</span>
}

<span class="code-comment">// 4. Param√®tres par tableau</span>
<span class="code-keyword">void</span> <span class="code-function">afficherTableau</span>(<span class="code-keyword">int</span> tableau[], <span class="code-keyword">int</span> taille) {
<span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < taille; i++) {
  Serial.<span class="code-function">println</span>(tableau[i]);
}
}

<span class="code-comment">// 5. Param√®tres par structure</span>
<span class="code-keyword">struct</span> Point {
<span class="code-keyword">int</span> x;
<span class="code-keyword">int</span> y;
};

<span class="code-keyword">void</span> <span class="code-function">afficherPoint</span>(Point p) {
Serial.<span class="code-function">print</span>(<span class="code-string">"("</span>);
Serial.<span class="code-function">print</span>(p.x);
Serial.<span class="code-function">print</span>(<span class="code-string">", "</span>);
Serial.<span class="code-function">print</span>(p.y);
Serial.<span class="code-function">println</span>(<span class="code-string">")"</span>);
}

<span class="code-comment">// 6. Param√®tres par r√©f√©rence constante (lecture seule)</span>
<span class="code-keyword">void</span> <span class="code-function">afficherPointConst</span>(<span class="code-keyword">const</span> Point &p) {
<span class="code-comment">// p.x = 10;  // ERREUR : p est en lecture seule</span>
Serial.<span class="code-function">print</span>(<span class="code-string">"("</span>);
Serial.<span class="code-function">print</span>(p.x);
Serial.<span class="code-function">print</span>(<span class="code-string">", "</span>);
Serial.<span class="code-function">print</span>(p.y);
Serial.<span class="code-function">println</span>(<span class="code-string">")"</span>);
}</code></pre>
          </div>

          <h4>Valeurs de retour</h4>
          <div class="code-example">
            <pre><code><span class="code-comment">// 1. Fonction sans retour (void)</span>
<span class="code-keyword">void</span> <span class="code-function">afficherMessage</span>() {
Serial.<span class="code-function">println</span>(<span class="code-string">"Bonjour"</span>);
}

<span class="code-comment">// 2. Fonction avec retour simple</span>
<span class="code-keyword">int</span> <span class="code-function">addition</span>(<span class="code-keyword">int</span> a, <span class="code-keyword">int</span> b) {
<span class="code-keyword">return</span> a + b;
}

<span class="code-comment">// 3. Fonction avec retour de bool√©en</span>
<span class="code-keyword">bool</span> <span class="code-function">estPair</span>(<span class="code-keyword">int</span> nombre) {
<span class="code-keyword">return</span> (nombre % 2 == 0);
}

<span class="code-comment">// 4. Fonction avec retour de float</span>
<span class="code-keyword">float</span> <span class="code-function">calculerMoyenne</span>(<span class="code-keyword">float</span> a, <span class="code-keyword">float</span> b) {
<span class="code-keyword">return</span> (a + b) / 2.0;
}

<span class="code-comment">// 5. Fonction avec retour de String</span>
<span class="code-type">String</span> <span class="code-function">creerMessage</span>(<span class="code-type">String</span> nom, <span class="code-keyword">int</span> age) {
<span class="code-type">String</span> message = <span class="code-string">"Bonjour "</span> + nom + <span class="code-string">", vous avez "</span> + age + <span class="code-string">" ans"</span>;
<span class="code-keyword">return</span> message;
}

<span class="code-comment">// 6. Fonction avec retour de tableau (via pointeur)</span>
<span class="code-keyword">void</span> <span class="code-function">creerTableau</span>(<span class="code-keyword">int</span> *tableau, <span class="code-keyword">int</span> taille) {
<span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < taille; i++) {
  tableau[i] = i * i;  <span class="code-comment">// Carr√©s des nombres</span>
}
}

<span class="code-comment">// 7. Fonction avec retour de structure</span>
Point <span class="code-function">creerPoint</span>(<span class="code-keyword">int</span> x, <span class="code-keyword">int</span> y) {
Point p;
p.x = x;
p.y = y;
<span class="code-keyword">return</span> p;
}

<span class="code-comment">// 8. Fonction avec plusieurs retours (via param√®tres de r√©f√©rence)</span>
<span class="code-keyword">void</span> <span class="code-function">calculerMinMax</span>(<span class="code-keyword">int</span> a, <span class="code-keyword">int</span> b, <span class="code-keyword">int</span> &min, <span class="code-keyword">int</span> &max) {
<span class="code-keyword">if</span> (a < b) {
  min = a;
  max = b;
} <span class="code-keyword">else</span> {
  min = b;
  max = a;
}
}</code></pre>
          </div>

          <h4>Exemple complet</h4>
          <div class="code-example">
            <pre><code><span class="code-comment">/*
Programme d√©montrant les param√®tres et retours de fonctions
*/</span>

<span class="code-keyword">struct</span> Rectangle {
<span class="code-keyword">float</span> largeur;
<span class="code-keyword">float</span> hauteur;
};

<span class="code-comment">// Fonction avec param√®tre par valeur</span>
<span class="code-keyword">float</span> <span class="code-function">calculerPerimetre</span>(<span class="code-keyword">float</span> largeur, <span class="code-keyword">float</span> hauteur) {
<span class="code-keyword">return</span> 2 * (largeur + hauteur);
}

<span class="code-comment">// Fonction avec param√®tre par r√©f√©rence</span>
<span class="code-keyword">void</span> <span class="code-function">echanger</span>(<span class="code-keyword">int</span> &a, <span class="code-keyword">int</span> &b) {
<span class="code-keyword">int</span> temp = a;
a = b;
b = temp;
}

<span class="code-comment">// Fonction avec param√®tre par structure</span>
<span class="code-keyword">float</span> <span class="code-function">calculerAire</span>(<span class="code-keyword">const</span> Rectangle &rect) {
<span class="code-keyword">return</span> rect.largeur * rect.hauteur;
}

<span class="code-comment">// Fonction avec retour de structure</span>
Rectangle <span class="code-function">creerRectangle</span>(<span class="code-keyword">float</span> l, <span class="code-keyword">float</span> h) {
Rectangle rect;
rect.largeur = l;
rect.hauteur = h;
<span class="code-keyword">return</span> rect;
}

<span class="code-comment">// Fonction avec plusieurs retours via r√©f√©rences</span>
<span class="code-keyword">void</span> <span class="code-function">analyserTableau</span>(<span class="code-keyword">int</span> tableau[], <span class="code-keyword">int</span> taille, 
                   <span class="code-keyword">int</span> &min, <span class="code-keyword">int</span> &max, <span class="code-keyword">float</span> &moyenne) {
<span class="code-keyword">if</span> (taille == 0) <span class="code-keyword">return</span>;

min = tableau[0];
max = tableau[0];
<span class="code-keyword">int</span> somme = 0;

<span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < taille; i++) {
  <span class="code-keyword">if</span> (tableau[i] < min) min = tableau[i];
  <span class="code-keyword">if</span> (tableau[i] > max) max = tableau[i];
  somme += tableau[i];
}

moyenne = <span class="code-keyword">static_cast</span>&lt;<span class="code-keyword">float</span>&gt;(somme) / taille;
}

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
Serial.<span class="code-function">begin</span>(9600);

<span class="code-comment">// Test des fonctions</span>
Serial.<span class="code-function">println</span>(<span class="code-string">"=== Tests parametres et retours ==="</span>);

<span class="code-comment">// 1. Test param√®tre par valeur</span>
<span class="code-keyword">float</span> perimetre = <span class="code-function">calculerPerimetre</span>(5.0, 3.0);
Serial.<span class="code-function">print</span>(<span class="code-string">"Perimetre rectangle 5x3: "</span>);
Serial.<span class="code-function">println</span>(perimetre);

<span class="code-comment">// 2. Test param√®tre par r√©f√©rence</span>
<span class="code-keyword">int</span> x = 10, y = 20;
Serial.<span class="code-function">print</span>(<span class="code-string">"Avant echange: x="</span>);
Serial.<span class="code-function">print</span>(x);
Serial.<span class="code-function">print</span>(<span class="code-string">", y="</span>);
Serial.<span class="code-function">println</span>(y);

<span class="code-function">echanger</span>(x, y);
Serial.<span class="code-function">print</span>(<span class="code-string">"Apres echange: x="</span>);
Serial.<span class="code-function">print</span>(x);
Serial.<span class="code-function">print</span>(<span class="code-string">", y="</span>);
Serial.<span class="code-function">println</span>(y);

<span class="code-comment">// 3. Test avec structure</span>
Rectangle monRect = <span class="code-function">creerRectangle</span>(4.0, 6.0);
<span class="code-keyword">float</span> aire = <span class="code-function">calculerAire</span>(monRect);
Serial.<span class="code-function">print</span>(<span class="code-string">"Aire rectangle 4x6: "</span>);
Serial.<span class="code-function">println</span>(aire);

<span class="code-comment">// 4. Test avec tableau et retours multiples</span>
<span class="code-keyword">int</span> donnees[] = {12, 45, 23, 67, 34, 89, 10};
<span class="code-keyword">int</span> taille = <span class="code-function">sizeof</span>(donnees) / <span class="code-function">sizeof</span>(donnees[0]);

<span class="code-keyword">int</span> min, max;
<span class="code-keyword">float</span> moyenne;
<span class="code-function">analyserTableau</span>(donnees, taille, min, max, moyenne);

Serial.<span class="code-function">println</span>(<span class="code-string">"Analyse du tableau:"</span>);
Serial.<span class="code-function">print</span>(<span class="code-string">"  Minimum: "</span>);
Serial.<span class="code-function">println</span>(min);
Serial.<span class="code-function">print</span>(<span class="code-string">"  Maximum: "</span>);
Serial.<span class="code-function">println</span>(max);
Serial.<span class="code-function">print</span>(<span class="code-string">"  Moyenne: "</span>);
Serial.<span class="code-function">println</span>(moyenne);

<span class="code-comment">// 5. Test fonction avec retour bool√©en</span>
Serial.<span class="code-function">print</span>(<span class="code-string">"15 est pair? "</span>);
Serial.<span class="code-function">println</span>(<span class="code-function">estPair</span>(15) ? <span class="code-string">"Oui"</span> : <span class="code-string">"Non"</span>);

Serial.<span class="code-function">print</span>(<span class="code-string">"20 est pair? "</span>);
Serial.<span class="code-function">println</span>(<span class="code-function">estPair</span>(20) ? <span class="code-string">"Oui"</span> : <span class="code-string">"Non"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
<span class="code-comment">// Rien dans loop pour cet exemple</span>
<span class="code-function">delay</span>(1000);
}</code></pre>
          </div>
        </section>

        <!-- R√©cursivit√© -->
        <section id="recursivite">
          <h3>R√©cursivit√© en programmation</h3>
          <p>Une fonction r√©cursive est une fonction qui s'appelle elle-m√™me. Elle doit avoir une condition d'arr√™t pour
            √©viter la r√©cursion infinie.</p>

          <div class="warning-box">
            <p><strong>Attention :</strong> Sur Arduino, l'espace m√©moire est limit√©. Les fonctions r√©cursives utilisent
              la pile (stack) et peuvent causer un d√©bordement si la r√©cursion est trop profonde.</p>
          </div>

          <h4>Exemples classiques de r√©cursivit√©</h4>
          <div class="code-example">
            <pre><code><span class="code-comment">// 1. Factorielle (n!)</span>
<span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> <span class="code-function">factorielle</span>(<span class="code-keyword">int</span> n) {
<span class="code-comment">// Condition d'arr√™t</span>
<span class="code-keyword">if</span> (n <= 1) {
  <span class="code-keyword">return</span> 1;
}
<span class="code-comment">// Appel r√©cursif</span>
<span class="code-keyword">return</span> n * <span class="code-function">factorielle</span>(n - 1);
}

<span class="code-comment">// 2. Suite de Fibonacci</span>
<span class="code-keyword">int</span> <span class="code-function">fibonacci</span>(<span class="code-keyword">int</span> n) {
<span class="code-comment">// Conditions d'arr√™t</span>
<span class="code-keyword">if</span> (n <= 0) <span class="code-keyword">return</span> 0;
<span class="code-keyword">if</span> (n == 1) <span class="code-keyword">return</span> 1;

<span class="code-comment">// Appel r√©cursif</span>
<span class="code-keyword">return</span> <span class="code-function">fibonacci</span>(n - 1) + <span class="code-function">fibonacci</span>(n - 2);
}

<span class="code-comment">// 3. Exponentiation r√©cursive</span>
<span class="code-keyword">int</span> <span class="code-function">puissance</span>(<span class="code-keyword">int</span> base, <span class="code-keyword">int</span> exposant) {
<span class="code-comment">// Condition d'arr√™t</span>
<span class="code-keyword">if</span> (exposant == 0) {
  <span class="code-keyword">return</span> 1;
}
<span class="code-comment">// Appel r√©cursif</span>
<span class="code-keyword">return</span> base * <span class="code-function">puissance</span>(base, exposant - 1);
}

<span class="code-comment">// 4. Somme des √©l√©ments d'un tableau (r√©cursif)</span>
<span class="code-keyword">int</span> <span class="code-function">sommeTableau</span>(<span class="code-keyword">int</span> tableau[], <span class="code-keyword">int</span> taille) {
<span class="code-comment">// Condition d'arr√™t</span>
<span class="code-keyword">if</span> (taille == 0) {
  <span class="code-keyword">return</span> 0;
}
<span class="code-comment">// Appel r√©cursif : dernier √©l√©ment + somme du reste</span>
<span class="code-keyword">return</span> tableau[taille - 1] + <span class="code-function">sommeTableau</span>(tableau, taille - 1);
}

<span class="code-comment">// 5. Recherche binaire r√©cursive (tableau tri√©)</span>
<span class="code-keyword">int</span> <span class="code-function">rechercheBinaire</span>(<span class="code-keyword">int</span> tableau[], <span class="code-keyword">int</span> debut, <span class="code-keyword">int</span> fin, <span class="code-keyword">int</span> valeur) {
<span class="code-comment">// Condition d'arr√™t : √©l√©ment non trouv√©</span>
<span class="code-keyword">if</span> (debut > fin) {
  <span class="code-keyword">return</span> -1;
}

<span class="code-keyword">int</span> milieu = (debut + fin) / 2;

<span class="code-comment">// Condition d'arr√™t : √©l√©ment trouv√©</span>
<span class="code-keyword">if</span> (tableau[milieu] == valeur) {
  <span class="code-keyword">return</span> milieu;
}

<span class="code-comment">// Appels r√©cursifs</span>
<span class="code-keyword">if</span> (tableau[milieu] > valeur) {
  <span class="code-comment">// Recherche dans la moiti√© gauche</span>
  <span class="code-keyword">return</span> <span class="code-function">rechercheBinaire</span>(tableau, debut, milieu - 1, valeur);
} <span class="code-keyword">else</span> {
  <span class="code-comment">// Recherche dans la moiti√© droite</span>
  <span class="code-keyword">return</span> <span class="code-function">rechercheBinaire</span>(tableau, milieu + 1, fin, valeur);
}
}

<span class="code-comment">// 6. Parcours r√©cursif d'une structure arborescente (simul√©e)</span>
<span class="code-keyword">struct</span> Noeud {
<span class="code-keyword">int</span> valeur;
Noeud* gauche;
Noeud* droit;
};

<span class="code-keyword">void</span> <span class="code-function">parcoursPrefixe</span>(Noeud* racine) {
<span class="code-comment">// Condition d'arr√™t</span>
<span class="code-keyword">if</span> (racine == <span class="code-keyword">nullptr</span>) {
  <span class="code-keyword">return</span>;
}

<span class="code-comment">// Traitement du noeud courant</span>
Serial.<span class="code-function">println</span>(racine-&gt;valeur);

<span class="code-comment">// Appels r√©cursifs</span>
<span class="code-function">parcoursPrefixe</span>(racine-&gt;gauche);
<span class="code-function">parcoursPrefixe</span>(racine-&gt;droit);
}</code></pre>
          </div>

          <h4>Exemple complet avec r√©cursivit√©</h4>
          <div class="code-example">
            <pre><code><span class="code-comment">/*
Programme d√©montrant la r√©cursivit√© sur Arduino
Attention : utiliser avec prudence √† cause des limites de m√©moire
*/</span>

<span class="code-comment">// Compteur pour suivre la profondeur de r√©cursivit√©</span>
<span class="code-keyword">int</span> profondeurMax = 0;

<span class="code-comment">// 1. Fonction pour afficher un compte √† rebours r√©cursif</span>
<span class="code-keyword">void</span> <span class="code-function">compteRebours</span>(<span class="code-keyword">int</span> n, <span class="code-keyword">int</span> profondeur = 0) {
<span class="code-comment">// Mise √† jour de la profondeur maximale</span>
<span class="code-keyword">if</span> (profondeur > profondeurMax) {
  profondeurMax = profondeur;
}

<span class="code-comment">// Condition d'arr√™t</span>
<span class="code-keyword">if</span> (n < 0) {
  Serial.<span class="code-function">println</span>(<span class="code-string">"Fin du compte a rebours!"</span>);
  <span class="code-keyword">return</span>;
}

<span class="code-comment">// Affichage du nombre courant</span>
Serial.<span class="code-function">print</span>(<span class="code-string">"Compte rebours: "</span>);
Serial.<span class="code-function">println</span>(n);

<span class="code-function">delay</span>(500);  <span class="code-comment">// Pause pour visualiser</span>

<span class="code-comment">// Appel r√©cursif</span>
<span class="code-function">compteRebours</span>(n - 1, profondeur + 1);
}

<span class="code-comment">// 2. Fonction pour calculer le PGCD (r√©cursif)</span>
<span class="code-keyword">int</span> <span class="code-function">pgcd</span>(<span class="code-keyword">int</span> a, <span class="code-keyword">int</span> b) {
<span class="code-comment">// Condition d'arr√™t</span>
<span class="code-keyword">if</span> (b == 0) {
  <span class="code-keyword">return</span> a;
}

<span class="code-comment">// Appel r√©cursif</span>
<span class="code-keyword">return</span> <span class="code-function">pgcd</span>(b, a % b);
}

<span class="code-comment">// 3. Fonction pour inverser une cha√Æne (simul√©e avec tableau)</span>
<span class="code-keyword">void</span> <span class="code-function">inverserChaine</span>(<span class="code-type">char</span> chaine[], <span class="code-keyword">int</span> debut, <span class="code-keyword">int</span> fin) {
<span class="code-comment">// Condition d'arr√™t</span>
<span class="code-keyword">if</span> (debut >= fin) {
  <span class="code-keyword">return</span>;
}

<span class="code-comment">// √âchange des caract√®res aux extr√©mit√©s</span>
<span class="code-type">char</span> temp = chaine[debut];
chaine[debut] = chaine[fin];
chaine[fin] = temp;

<span class="code-comment">// Appel r√©cursif pour le reste de la cha√Æne</span>
<span class="code-function">inverserChaine</span>(chaine, debut + 1, fin - 1);
}

<span class="code-comment">// 4. Fonction pour g√©n√©rer la s√©quence de Collatz (r√©cursive)</span>
<span class="code-keyword">void</span> <span class="code-function">collatz</span>(<span class="code-keyword">int</span> n, <span class="code-keyword">int</span> etape = 0) {
Serial.<span class="code-function">print</span>(<span class="code-string">"Etape "</span>);
Serial.<span class="code-function">print</span>(etape);
Serial.<span class="code-function">print</span>(<span class="code-string">": "</span>);
Serial.<span class="code-function">println</span>(n);

<span class="code-comment">// Condition d'arr√™t</span>
<span class="code-keyword">if</span> (n == 1) {
  Serial.<span class="code-function">println</span>(<span class="code-string">"Sequence terminee en "</span> + <span class="code-type">String</span>(etape) + <span class="code-string">" etapes"</span>);
  <span class="code-keyword">return</span>;
}

<span class="code-function">delay</span>(200);  <span class="code-comment">// Pause pour visualiser</span>

<span class="code-comment">// R√®gle de Collatz et appel r√©cursif</span>
<span class="code-keyword">if</span> (n % 2 == 0) {  <span class="code-comment">// Si n est pair</span>
  <span class="code-function">collatz</span>(n / 2, etape + 1);
} <span class="code-keyword">else</span> {              <span class="code-comment">// Si n est impair</span>
  <span class="code-function">collatz</span>(3 * n + 1, etape + 1);
}
}

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
Serial.<span class="code-function">begin</span>(9600);

Serial.<span class="code-function">println</span>(<span class="code-string">"=== Demonstration de la recursivite ==="</span>);
Serial.<span class="code-function">println</span>();

<span class="code-comment">// Test 1 : Compte √† rebours</span>
Serial.<span class="code-function">println</span>(<span class="code-string">"1. Compte a rebours recursif:"</span>);
profondeurMax = 0;
<span class="code-function">compteRebours</span>(5);
Serial.<span class="code-function">print</span>(<span class="code-string">"Profondeur maximale: "</span>);
Serial.<span class="code-function">println</span>(profondeurMax);
Serial.<span class="code-function">println</span>();

<span class="code-function">delay</span>(1000);

<span class="code-comment">// Test 2 : PGCD</span>
Serial.<span class="code-function">println</span>(<span class="code-string">"2. Calcul du PGCD:"</span>);
<span class="code-keyword">int</span> a = 48, b = 18;
<span class="code-keyword">int</span> resultatPGCD = <span class="code-function">pgcd</span>(a, b);
Serial.<span class="code-function">print</span>(<span class="code-string">"PGCD("</span>);
Serial.<span class="code-function">print</span>(a);
Serial.<span class="code-function">print</span>(<span class="code-string">", "</span>);
Serial.<span class="code-function">print</span>(b);
Serial.<span class="code-function">print</span>(<span class="code-string">") = "</span>);
Serial.<span class="code-function">println</span>(resultatPGCD);
Serial.<span class="code-function">println</span>();

<span class="code-function">delay</span>(1000);

<span class="code-comment">// Test 3 : Inversion de cha√Æne</span>
Serial.<span class="code-function">println</span>(<span class="code-string">"3. Inversion de chaine:"</span>);
<span class="code-type">char</span> message[] = <span class="code-string">"ARDUINO"</span>;
Serial.<span class="code-function">print</span>(<span class="code-string">"Original: "</span>);
Serial.<span class="code-function">println</span>(message);

<span class="code-function">inverserChaine</span>(message, 0, <span class="code-function">strlen</span>(message) - 1);
Serial.<span class="code-function">print</span>(<span class="code-string">"Inverse: "</span>);
Serial.<span class="code-function">println</span>(message);
Serial.<span class="code-function">println</span>();

<span class="code-function">delay</span>(1000);

<span class="code-comment">// Test 4 : Factorielle (avec limitation)</span>
Serial.<span class="code-function">println</span>(<span class="code-string">"4. Factorielle (limitee pour Arduino):"</span>);
<span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i <= 7; i++) {  <span class="code-comment">// Limit√© √† 7! √† cause de la m√©moire</span>
  Serial.<span class="code-function">print</span>(i);
  Serial.<span class="code-function">print</span>(<span class="code-string">"! = "</span>);
  Serial.<span class="code-function">println</span>(<span class="code-function">factorielle</span>(i));
}
Serial.<span class="code-function">println</span>();

<span class="code-function">delay</span>(1000);

<span class="code-comment">// Test 5 : S√©quence de Collatz</span>
Serial.<span class="code-function">println</span>(<span class="code-string">"5. Sequence de Collatz pour n=27:"</span>);
<span class="code-function">collatz</span>(27);

Serial.<span class="code-function">println</span>();
Serial.<span class="code-function">println</span>(<span class="code-string">"=== Fin de la demonstration ==="</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
<span class="code-comment">// Programme en une seule ex√©cution</span>
<span class="code-function">delay</span>(1000);
}</code></pre>
          </div>

          <div class="info-box">
            <p><strong>Conseil :</strong> Sur Arduino, pr√©f√©rez les solutions it√©ratives (boucles) aux solutions
              r√©cursives pour √©conomiser la m√©moire de la pile (stack), sauf lorsque la r√©cursivit√© simplifie
              consid√©rablement le code.</p>
          </div>
        </section>
      </section>

      <!-- =========================================== -->
      <!-- SECTION ENTR√âES/SORTIES -->
      <!-- =========================================== -->
      <section id="entrees-sorties">
        <h2>Entr√©es et Sorties (I/O) sur Arduino</h2>
        <p>Les broches d'entr√©e/sortie permettent d'interagir avec le monde ext√©rieur : lire des capteurs, contr√¥ler des
          actionneurs, etc.</p>

        <h3 id="digital">Entr√©es/Sorties Digitales</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Programme complet : Contr√¥le d'une LED avec un bouton
  Bouton connect√© √† la broche 2, LED connect√©e √† la broche 13
*/</span>

<span class="code-keyword">const</span> <span class="code-keyword">int</span> BOUTON_PIN = 2;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 13;

<span class="code-keyword">int</span> etatBouton = LOW;
<span class="code-keyword">int</span> dernierEtatBouton = LOW;
<span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierDebounce = 0;
<span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> delaiDebounce = 50;

<span class="code-keyword">bool</span> ledAllumee = <span class="code-keyword">false</span>;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  
  <span class="code-comment">// Configuration des broches</span>
  <span class="code-function">pinMode</span>(BOUTON_PIN, INPUT_PULLUP);  <span class="code-comment">// R√©sistance pull-up interne</span>
  <span class="code-function">pinMode</span>(LED_PIN, OUTPUT);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Controle LED avec bouton - Pret"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Lecture de l'√©tat du bouton</span>
  <span class="code-keyword">int</span> lecture = <span class="code-function">digitalRead</span>(BOUTON_PIN);
  
  <span class="code-comment">// Anti-rebond (debounce)</span>
  <span class="code-keyword">if</span> (lecture != dernierEtatBouton) {
    dernierDebounce = <span class="code-function">millis</span>();
  }
  
  <span class="code-keyword">if</span> ((<span class="code-function">millis</span>() - dernierDebounce) > delaiDebounce) {
    <span class="code-comment">// Si l'√©tat a chang√©</span>
    <span class="code-keyword">if</span> (lecture != etatBouton) {
      etatBouton = lecture;
      
      <span class="code-comment">// Si le bouton est appuy√© (LOW avec pull-up)</span>
      <span class="code-keyword">if</span> (etatBouton == LOW) {
        ledAllumee = !ledAllumee;  <span class="code-comment">// Inverse l'√©tat</span>
        
        <span class="code-keyword">if</span> (ledAllumee) {
          <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
          Serial.<span class="code-function">println</span>(<span class="code-string">"LED allumee"</span>);
        } <span class="code-keyword">else</span> {
          <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
          Serial.<span class="code-function">println</span>(<span class="code-string">"LED eteinte"</span>);
        }
      }
    }
  }
  
  dernierEtatBouton = lecture;
}</code></pre>
        </div>

        <h3 id="analog">Entr√©es/Sorties Analogiques</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Lecture d'un potentiom√®tre et contr√¥le d'une LED en PWM
  Potentiom√®tre connect√© √† A0, LED connect√©e √† la broche 9 (PWM)
*/</span>

<span class="code-keyword">const</span> <span class="code-keyword">int</span> POT_PIN = A0;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 9;

<span class="code-keyword">int</span> valeurPot = 0;
<span class="code-keyword">int</span> luminosite = 0;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  
  <span class="code-comment">// Pas besoin de pinMode pour les entr√©es analogiques</span>
  <span class="code-comment">// La broche LED est configur√©e automatiquement par analogWrite</span>
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Controle LED PWM avec potentiometre"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Lecture du potentiom√®tre (0-1023)</span>
  valeurPot = <span class="code-function">analogRead</span>(POT_PIN);
  
  <span class="code-comment">// Conversion en valeur PWM (0-255)</span>
  luminosite = <span class="code-function">map</span>(valeurPot, 0, 1023, 0, 255);
  
  <span class="code-comment">// Application de la luminosit√© √† la LED</span>
  <span class="code-function">analogWrite</span>(LED_PIN, luminosite);
  
  <span class="code-comment">// Affichage des valeurs (toutes les 100ms)</span>
  <span class="code-keyword">static</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierAffichage = 0;
  <span class="code-keyword">if</span> (<span class="code-function">millis</span>() - dernierAffichage > 100) {
    Serial.<span class="code-function">print</span>(<span class="code-string">"Potentiometre: "</span>);
    Serial.<span class="code-function">print</span>(valeurPot);
    Serial.<span class="code-function">print</span>(<span class="code-string">" | Luminosite: "</span>);
    Serial.<span class="code-function">println</span>(luminosite);
    
    dernierAffichage = <span class="code-function">millis</span>();
  }
  
  <span class="code-function">delay</span>(10);  <span class="code-comment">// Petit d√©lai pour stabilit√©</span>
}</code></pre>
        </div>

        <h3 id="pwm">PWM (Pulse Width Modulation)</h3>
        <div class="info-box">
          <p><strong>PWM (Modulation par Largeur d'Impulsion)</strong> : Technique pour simuler une sortie analogique
            avec une sortie digitale. Les broches PWM sur Arduino Uno sont : 3, 5, 6, 9, 10, 11 (marqu√©es ~).</p>
        </div>
        <!-- Interruptions -->
        <section id="interruptions">
          <h3>Interruptions (Interrupts) sur Arduino</h3>
          <p>Les interruptions permettent d'interrompre l'ex√©cution normale du programme pour ex√©cuter une fonction
            sp√©cifique lorsqu'un √©v√©nement se produit.</p>

          <div class="info-box">
            <p><strong>Important :</strong> Les fonctions d'interruption (ISR - Interrupt Service Routine) doivent √™tre
              courtes et rapides. √âvitez les <code>delay()</code>, <code>millis()</code> et les communications s√©rie
              complexes dans les ISR.</p>
          </div>

          <h4>Types d'interruptions sur Arduino</h4>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Carte</th>
                  <th>Broches d'interruption</th>
                  <th>Num√©ros d'interruption</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Arduino Uno, Nano</td>
                  <td>2, 3</td>
                  <td>0 (pin 2), 1 (pin 3)</td>
                </tr>
                <tr>
                  <td>Arduino Mega</td>
                  <td>2, 3, 18, 19, 20, 21</td>
                  <td>0 √† 5</td>
                </tr>
                <tr>
                  <td>Arduino Leonardo, Micro</td>
                  <td>0, 1, 2, 3, 7</td>
                  <td>0, 1, 2, 3, 4</td>
                </tr>
                <tr>
                  <td>ESP32</td>
                  <td>Toutes les broches GPIO*</td>
                  <td>Num√©ros variables</td>
                </tr>
                <tr>
                  <td>ESP8266</td>
                  <td>Toutes les broches* (sauf GPIO16)</td>
                  <td>Num√©ros variables</td>
                </tr>
              </tbody>
            </table>
            <p class="code-comment" style="margin-top: 0.5rem;">* Sur ESP, la plupart des broches supportent les
              interruptions</p>
          </div>

          <h4>Modes d'interruption disponibles</h4>
          <div class="code-example">
            <pre><code><span class="code-comment">// Modes d'interruption disponibles :</span>
LOW        <span class="code-comment">// D√©clenche quand la broche est BASSE</span>
CHANGE     <span class="code-comment">// D√©clenche quand la broche change d'√©tat</span>
RISING     <span class="code-comment">// D√©clenche quand la broche passe de LOW √† HIGH</span>
FALLING    <span class="code-comment">// D√©clenche quand la broche passe de HIGH √† LOW</span>
HIGH       <span class="code-comment">// D√©clenche quand la broche est HAUTE (certaines cartes seulement)</span></code></pre>
          </div>

          <h4>Exemples d'utilisation des interruptions</h4>

          <div class="code-example">
            <h5>Exemple 1 : Compteur d'interruptions simple</h5>
            <pre><code><span class="code-comment">/*
Compteur d'interruptions avec bouton
Bouton connect√© √† la broche d'interruption 2
*/</span>

<span class="code-keyword">volatile</span> <span class="code-keyword">int</span> compteur = 0;        <span class="code-comment">// volatile pour les variables partag√©es avec ISR</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> BOUTON_INTERRUPT = 2;  <span class="code-comment">// Broche d'interruption</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 13;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
Serial.<span class="code-function">begin</span>(9600);

<span class="code-comment">// Configuration des broches</span>
<span class="code-function">pinMode</span>(BOUTON_INTERRUPT, INPUT_PULLUP);
<span class="code-function">pinMode</span>(LED_PIN, OUTPUT);

<span class="code-comment">// Attachement de l'interruption</span>
<span class="code-comment">// attachInterrupt(digitalPinToInterrupt(pin), ISR, mode)</span>
<span class="code-function">attachInterrupt</span>(<span class="code-function">digitalPinToInterrupt</span>(BOUTON_INTERRUPT), interruptionBouton, FALLING);

Serial.<span class="code-function">println</span>(<span class="code-string">"Systeme interruptions pret"</span>);
Serial.<span class="code-function">println</span>(<span class="code-string">"Appuyez sur le bouton..."</span>);
}

<span class="code-comment">// Fonction d'interruption (ISR) - DOIT ETRE COURTE ET RAPIDE</span>
<span class="code-keyword">void</span> <span class="code-function">interruptionBouton</span>() {
compteur++;  <span class="code-comment">// Incr√©mente le compteur</span>
<span class="code-function">digitalWrite</span>(LED_PIN, HIGH);  <span class="code-comment">// Allume la LED bri√®vement</span>
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
<span class="code-comment">// √âteint la LED apr√®s un court instant</span>
<span class="code-function">digitalWrite</span>(LED_PIN, LOW);

<span class="code-comment">// Affiche le compteur p√©riodiquement</span>
<span class="code-keyword">static</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierAffichage = 0;
<span class="code-keyword">if</span> (<span class="code-function">millis</span>() - dernierAffichage > 1000) {
  Serial.<span class="code-function">print</span>(<span class="code-string">"Compteur: "</span>);
  Serial.<span class="code-function">println</span>(compteur);
  dernierAffichage = <span class="code-function">millis</span>();
}
}</code></pre>
          </div>

          <div class="code-example">
            <h5>Exemple 2 : Anti-rebond (debounce) avec interruptions</h5>
            <pre><code><span class="code-comment">/*
Anti-rebond am√©lior√© avec interruptions et gestion du temps
*/</span>

<span class="code-keyword">volatile</span> <span class="code-keyword">bool</span> boutonAppuye = <span class="code-keyword">false</span>;
<span class="code-keyword">volatile</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierAppui = 0;
<span class="code-keyword">const</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> DELAI_ANTI_REBOND = 50;  <span class="code-comment">// 50ms pour l'anti-rebond</span>

<span class="code-keyword">const</span> <span class="code-keyword">int</span> BOUTON_PIN = 2;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 13;

<span class="code-keyword">bool</span> ledAllumee = <span class="code-keyword">false</span>;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
Serial.<span class="code-function">begin</span>(9600);

<span class="code-function">pinMode</span>(BOUTON_PIN, INPUT_PULLUP);
<span class="code-function">pinMode</span>(LED_PIN, OUTPUT);

<span class="code-comment">// Attachement de l'interruption sur changement d'√©tat</span>
<span class="code-function">attachInterrupt</span>(<span class="code-function">digitalPinToInterrupt</span>(BOUTON_PIN), interruptionBouton, CHANGE);

Serial.<span class="code-function">println</span>(<span class="code-string">"Systeme anti-rebond avec interruptions pret"</span>);
}

<span class="code-comment">// ISR avec anti-rebond</span>
<span class="code-keyword">void</span> <span class="code-function">interruptionBouton</span>() {
<span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> tempsActuel = <span class="code-function">micros</span>();  <span class="code-comment">// Utilise micros() pour plus de pr√©cision</span>

<span class="code-comment">// Anti-rebond : ignore les appuis trop rapproch√©s</span>
<span class="code-keyword">if</span> (tempsActuel - dernierAppui > DELAI_ANTI_REBOND * 1000) {
  boutonAppuye = <span class="code-keyword">true</span>;
  dernierAppui = tempsActuel;
}
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
<span class="code-keyword">if</span> (boutonAppuye) {
  boutonAppuye = <span class="code-keyword">false</span>;  <span class="code-comment">// R√©initialise le flag</span>
  
  <span class="code-comment">// Inversion de l'√©tat de la LED</span>
  ledAllumee = !ledAllumee;
  
  <span class="code-keyword">if</span> (ledAllumee) {
    <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
    Serial.<span class="code-function">println</span>(<span class="code-string">"LED allumee"</span>);
  } <span class="code-keyword">else</span> {
    <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
    Serial.<span class="code-function">println</span>(<span class="code-string">"LED eteinte"</span>);
  }
}

<span class="code-comment">// Autres t√¢ches peuvent s'ex√©cuter ici sans √™tre bloqu√©es</span>
<span class="code-function">delay</span>(10);  <span class="code-comment">// Petit d√©lai pour r√©duire la charge CPU</span>
}</code></pre>
          </div>

          <div class="code-example">
            <h5>Exemple 3 : Gestion de plusieurs interruptions</h5>
            <pre><code><span class="code-comment">/*
Gestion de plusieurs boutons avec interruptions
*/</span>

<span class="code-keyword">volatile</span> <span class="code-keyword">bool</span> bouton1Appuye = <span class="code-keyword">false</span>;
<span class="code-keyword">volatile</span> <span class="code-keyword">bool</span> bouton2Appuye = <span class="code-keyword">false</span>;

<span class="code-keyword">const</span> <span class="code-keyword">int</span> BOUTON1_PIN = 2;   <span class="code-comment">// Interruption 0</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> BOUTON2_PIN = 3;   <span class="code-comment">// Interruption 1</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_ROUGE = 9;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_VERTE = 10;

<span class="code-keyword">int</span> luminositeRouge = 0;
<span class="code-keyword">int</span> luminositeVerte = 0;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
Serial.<span class="code-function">begin</span>(9600);

<span class="code-comment">// Configuration des broches</span>
<span class="code-function">pinMode</span>(BOUTON1_PIN, INPUT_PULLUP);
<span class="code-function">pinMode</span>(BOUTON2_PIN, INPUT_PULLUP);
<span class="code-function">pinMode</span>(LED_ROUGE, OUTPUT);
<span class="code-function">pinMode</span>(LED_VERTE, OUTPUT);

<span class="code-comment">// Attachement des interruptions</span>
<span class="code-function">attachInterrupt</span>(<span class="code-function">digitalPinToInterrupt</span>(BOUTON1_PIN), interruptionBouton1, FALLING);
<span class="code-function">attachInterrupt</span>(<span class="code-function">digitalPinToInterrupt</span>(BOUTON2_PIN), interruptionBouton2, FALLING);

Serial.<span class="code-function">println</span>(<span class="code-string">"Systeme multi-interruptions pret"</span>);
Serial.<span class="code-function">println</span>(<span class="code-string">"Bouton 1: Augmente LED rouge"</span>);
Serial.<span class="code-function">println</span>(<span class="code-string">"Bouton 2: Augmente LED verte"</span>);
}

<span class="code-comment">// ISR pour le bouton 1</span>
<span class="code-keyword">void</span> <span class="code-function">interruptionBouton1</span>() {
bouton1Appuye = <span class="code-keyword">true</span>;
}

<span class="code-comment">// ISR pour le bouton 2</span>
<span class="code-keyword">void</span> <span class="code-function">interruptionBouton2</span>() {
bouton2Appuye = <span class="code-keyword">true</span>;
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
<span class="code-comment">// Traitement du bouton 1</span>
<span class="code-keyword">if</span> (bouton1Appuye) {
  bouton1Appuye = <span class="code-keyword">false</span>;
  
  luminositeRouge += 25;
  <span class="code-keyword">if</span> (luminositeRouge > 255) {
    luminositeRouge = 0;
  }
  
  <span class="code-function">analogWrite</span>(LED_ROUGE, luminositeRouge);
  
  Serial.<span class="code-function">print</span>(<span class="code-string">"LED rouge: "</span>);
  Serial.<span class="code-function">println</span>(luminositeRouge);
}

<span class="code-comment">// Traitement du bouton 2</span>
<span class="code-keyword">if</span> (bouton2Appuye) {
  bouton2Appuye = <span class="code-keyword">false</span>;
  
  luminositeVerte += 25;
  <span class="code-keyword">if</span> (luminositeVerte > 255) {
    luminositeVerte = 0;
  }
  
  <span class="code-function">analogWrite</span>(LED_VERTE, luminositeVerte);
  
  Serial.<span class="code-function">print</span>(<span class="code-string">"LED verte: "</span>);
  Serial.<span class="code-function">println</span>(luminositeVerte);
}

<span class="code-comment">// T√¢che de fond : effet de respiration sur les deux LEDs</span>
<span class="code-keyword">static</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierUpdate = 0;
<span class="code-keyword">if</span> (<span class="code-function">millis</span>() - dernierUpdate > 20) {
  dernierUpdate = <span class="code-function">millis</span>();
  
  <span class="code-comment">// Maintien des luminosit√©s (d√©j√† d√©finies par les interruptions)</span>
  <span class="code-function">analogWrite</span>(LED_ROUGE, luminositeRouge);
  <span class="code-function">analogWrite</span>(LED_VERTE, luminositeVerte);
}
}</code></pre>
          </div>

          <div class="code-example">
            <h5>Exemple 4 : Interruptions sur ESP32 (plus de broches disponibles)</h5>
            <pre><code><span class="code-comment">/*
Interruptions sur ESP32 avec plusieurs broches
ESP32 permet d'utiliser presque toutes les broches GPIO
*/</span>

<span class="code-comment">// Pour ESP32, inclure cette biblioth√®que</span>
<span class="code-keyword">#include</span> &lt;Arduino.h&gt;

<span class="code-keyword">volatile</span> <span class="code-keyword">int</span> compteurInterruptions = 0;
<span class="code-keyword">volatile</span> <span class="code-keyword">bool</span> interruptionDeclenchee = <span class="code-keyword">false</span>;

<span class="code-keyword">const</span> <span class="code-keyword">int</span> BOUTON_PIN = 4;    <span class="code-comment">// GPIO4 sur ESP32</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 2;      <span class="code-comment">// LED int√©gr√©e sur GPIO2</span>

<span class="code-comment">// Pour stocker le temps du dernier appui (anti-rebond)</span>
<span class="code-keyword">portMUX_TYPE</span> mux = portMUX_INITIALIZER_UNLOCKED;
<span class="code-keyword">volatile</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierAppui = 0;
<span class="code-keyword">const</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> DELAI_ANTI_REBOND = 200000;  <span class="code-comment">// 200ms en microsecondes</span>

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
Serial.<span class="code-function">begin</span>(115200);

<span class="code-function">pinMode</span>(BOUTON_PIN, INPUT_PULLUP);
<span class="code-function">pinMode</span>(LED_PIN, OUTPUT);

<span class="code-comment">// Configuration de l'interruption sur ESP32</span>
<span class="function-name">attachInterrupt</span>(<span class="function-name">digitalPinToInterrupt</span>(BOUTON_PIN), interruptionESP32, FALLING);

Serial.<span class="function-name">println</span>("Systeme interruptions ESP32 pret");
Serial.<span class="function-name">println</span>("Appuyez sur le bouton connecte a GPIO4");
}

<span class="comment">// ISR pour ESP32 (avec protection contre les acc√®s concurrents)</span>
<span class="type">void</span> <span class="function-name">interruptionESP32</span>() {
<span class="comment">// Protection contre les acc√®s concurrents (multi-core)</span>
portENTER_CRITICAL_ISR(&mux);

<span class="type">unsigned</span> <span class="type">long</span> tempsActuel = micros();

<span class="comment">// Anti-rebond</span>
<span class="keyword">if</span> (tempsActuel - dernierAppui > DELAI_ANTI_REBOND) {
  compteurInterruptions++;
  interruptionDeclenchee = <span class="keyword">true</span>;
  dernierAppui = tempsActuel;
}

portEXIT_CRITICAL_ISR(&mux);
}

<span class="type">void</span> <span class="function-name">loop</span>() {
<span class="keyword">if</span> (interruptionDeclenchee) {
  interruptionDeclenchee = <span class="keyword">false</span>;
  
  <span class="comment">// Allume la LED bri√®vement</span>
  <span class="function-name">digitalWrite</span>(LED_PIN, HIGH);
  delay(50);
  <span class="function-name">digitalWrite</span>(LED_PIN, LOW);
  
  <span class="function-name">Serial.print</span>("Interruption ! Compteur: ");
  <span class="function-name">Serial.println</span>(compteurInterruptions);
}

<span class="comment">// Affiche l'√©tat p√©riodiquement</span>
<span class="keyword">static</span> <span class="type">unsigned</span> <span class="type">long</span> dernierAffichage = 0;
<span class="keyword">if</span> (millis() - dernierAffichage > 5000) {
  dernierAffichage = millis();
  <span class="function-name">Serial.print</span>("Etat actuel - Compteur total: ");
  <span class="function-name">Serial.println</span>(compteurInterruptions);
}

delay(10);
}</code></pre>
          </div>

          <h4>Bonnes pratiques pour les interruptions</h4>
          <div class="info-box">
            <ol>
              <li><strong>Gardez les ISR courtes :</strong> Ne faites que le minimum n√©cessaire (drapeaux, compteurs)
              </li>
              <li><strong>Utilisez <code>volatile</code> :</strong> Pour les variables partag√©es entre ISR et programme
                principal</li>
              <li><strong>√âvitez les appels bloquants :</strong> Pas de <code>delay()</code>,
                <code>Serial.print()</code> complexes
              </li>
              <li><strong>Impl√©mentez l'anti-rebond :</strong> Soit en hardware, soit en software avec gestion du temps
              </li>
              <li><strong>D√©sactivez les interruptions si n√©cessaire :</strong> <code>noInterrupts()</code> et
                <code>interrupts()</code>
              </li>
              <li><strong>Sur ESP32, prot√©gez les acc√®s :</span> Avec <code>portENTER_CRITICAL_ISR()</code> pour les
                  variables partag√©es</li>
            </ol>
          </div>

          <h4>Fonctions de gestion des interruptions</h4>
          <div class="code-example">
            <pre><code><span class="code-comment">// Activation/d√©sactivation globale des interruptions</span>
<span class="code-function">interrupts</span>();      <span class="code-comment">// Active les interruptions</span>
<span class="code-function">noInterrupts</span>();    <span class="code-comment">// D√©sactive les interruptions</span>

<span class="code-comment">// Attachement et d√©tachement d'interruptions</span>
<span class="code-function">attachInterrupt</span>(<span class="code-function">digitalPinToInterrupt</span>(pin), ISR, mode);
<span class="code-function">detachInterrupt</span>(<span class="code-function">digitalPinToInterrupt</span>(pin));

<span class="code-comment">// Exemple de section critique</span>
<span class="code-function">noInterrupts</span>();      <span class="code-comment">// D√©sactive les interruptions</span>
<span class="code-comment">// Code critique qui ne doit pas √™tre interrompu</span>
variablePartagee++;
<span class="code-function">interrupts</span>();        <span class="code-comment">// R√©active les interruptions</span></code></pre>
          </div>
        </section>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Effet de respiration (fade) sur une LED avec PWM
*/</span>

<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 9;
<span class="code-keyword">int</span> luminosite = 0;
<span class="code-keyword">int</span> increment = 5;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  <span class="code-comment">// Pas besoin de pinMode pour PWM avec analogWrite</span>
  Serial.<span class="code-function">begin</span>(9600);
  Serial.<span class="code-function">println</span>(<span class="code-string">"Effet de respiration LED PWM"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Applique la luminosit√© courante</span>
  <span class="code-function">analogWrite</span>(LED_PIN, luminosite);
  
  <span class="code-comment">// Change la luminosit√© pour le prochain cycle</span>
  luminosite = luminosite + increment;
  
  <span class="code-comment">// Inverse la direction aux limites</span>
  <span class="code-keyword">if</span> (luminosite <= 0 || luminosite >= 255) {
    increment = -increment;
  }
  
  <span class="code-comment">// Affiche la luminosit√©</span>
  Serial.<span class="code-function">print</span>(<span class="code-string">"Luminosite: "</span>);
  Serial.<span class="code-function">println</span>(luminosite);
  
  <span class="code-function">delay</span>(30);  <span class="code-comment">// Contr√¥le la vitesse de l'effet</span>
}</code></pre>
        </div>
      </section>

      <!-- =========================================== -->
      <!-- SECTION ALLUMER UNE LED -->
      <!-- =========================================== -->
      <section id="allumer-led">
        <h2>Allumer une LED - Techniques avanc√©es</h2>
        <p>Contr√¥ler une LED est la base de nombreux projets Arduino. Voici diff√©rentes techniques.</p>

        <h3 id="led-simple">LED simple avec r√©sistance</h3>
        <div class="info-box">
          <p><strong>Important :</strong> Toujours utiliser une r√©sistance en s√©rie avec une LED pour limiter le
            courant. Valeur typique : 220Œ© √† 1kŒ©.</p>
        </div>

        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Allumage simple d'une LED externe
  LED connect√©e √† la broche 7 via une r√©sistance 220Œ©
*/</span>

<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 7;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  <span class="code-function">pinMode</span>(LED_PIN, OUTPUT);
  Serial.<span class="code-function">begin</span>(9600);
  Serial.<span class="code-function">println</span>(<span class="code-string">"Controle LED simple"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Allume la LED</span>
  <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
  Serial.<span class="code-function">println</span>(<span class="code-string">"LED allumee"</span>);
  <span class="code-function">delay</span>(2000);
  
  <span class="code-comment">// √âteint la LED</span>
  <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
  Serial.<span class="code-function">println</span>(<span class="code-string">"LED eteinte"</span>);
  <span class="code-function">delay</span>(2000);
}</code></pre>
        </div>

        <h3 id="led-clignotante">LED clignotante avec motifs</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  LED clignotante avec diff√©rents motifs
*/</span>

<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 13;

<span class="code-comment">// Tableau de motifs : {temps allum√©, temps √©teint} en ms</span>
<span class="code-keyword">int</span> motifs[][2] = {
  {100, 100},    <span class="code-comment">// Rapide</span>
  {500, 500},    <span class="code-comment">// Moyen</span>
  {1000, 1000},  <span class="code-comment">// Lent</span>
  {100, 900},    <span class="code-comment">// Clignotement court</span>
  {50, 50, 50, 200}  <span class="code-comment">// SOS (modifi√©)</span>
};

<span class="code-keyword">int</span> motifActuel = 0;
<span class="code-keyword">int</span> nombreMotifs = 5;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  <span class="code-function">pinMode</span>(LED_PIN, OUTPUT);
  Serial.<span class="code-function">begin</span>(9600);
  Serial.<span class="code-function">println</span>(<span class="code-string">"LED clignotante avec motifs"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  Serial.<span class="code-function">print</span>(<span class="code-string">"Motif "</span>);
  Serial.<span class="code-function">println</span>(motifActuel + 1);
  
  <span class="code-keyword">if</span> (motifActuel < 4) {  <span class="code-comment">// Motifs simples</span>
    <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 10; i++) {  <span class="code-comment">// R√©p√®te 10 fois</span>
      <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
      <span class="code-function">delay</span>(motifs[motifActuel][0]);
      <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
      <span class="code-function">delay</span>(motifs[motifActuel][1]);
    }
  } <span class="code-keyword">else</span> {  <span class="code-comment">// Motif SOS</span>
    <span class="code-comment">// S (3 courts)</span>
    <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 3; i++) {
      <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
      <span class="code-function">delay</span>(motifs[motifActuel][0]);
      <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
      <span class="code-function">delay</span>(motifs[motifActuel][1]);
    }
    
    <span class="code-comment">// O (3 longs)</span>
    <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 3; i++) {
      <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
      <span class="code-function">delay</span>(motifs[motifActuel][2]);
      <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
      <span class="code-function">delay</span>(motifs[motifActuel][1]);
    }
    
    <span class="code-comment">// S (3 courts)</span>
    <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 3; i++) {
      <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
      <span class="code-function">delay</span>(motifs[motifActuel][0]);
      <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
      <span class="code-function">delay</span>(motifs[motifActuel][1]);
    }
    
    <span class="code-function">delay</span>(1000);  <span class="code-comment">// Pause entre les SOS</span>
  }
  
  <span class="code-comment">// Passe au motif suivant</span>
  motifActuel = (motifActuel + 1) % nombreMotifs;
  <span class="code-function">delay</span>(1000);  <span class="code-comment">// Pause entre les motifs</span>
}</code></pre>
        </div>
<!-- =========================================== -->
<!-- SECTION LED PWM - MANQUANTE -->
<!-- =========================================== -->
<section id="led-pwm">
  <h3>Contr√¥le PWM (Pulse Width Modulation) des LEDs</h3>
  
  <p>Le PWM (Modulation par Largeur d'Impulsion) permet de faire varier l'intensit√© lumineuse d'une LED en contr√¥lant le rapport cyclique d'un signal num√©rique.</p>
  
  <div class="info-box">
    <p><strong>Principe du PWM :</strong> Au lieu d'allumer/√©teindre compl√®tement une LED, on l'allume et l'√©teint tr√®s rapidement. La luminosit√© per√ßue d√©pend du temps relatif o√π elle est allum√©e.</p>
  </div>
  
  <h4>Broches PWM sur Arduino</h4>
  
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Carte Arduino</th>
          <th>Broches PWM</th>
          <th>Fr√©quence PWM</th>
          <th>R√©solution</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Arduino Uno/Nano</td>
          <td>3, 5, 6, 9, 10, 11</td>
          <td>490 Hz (broches 5,6: 980 Hz)</td>
          <td>8 bits (0-255)</td>
        </tr>
        <tr>
          <td>Arduino Mega</td>
          <td>2-13, 44-46</td>
          <td>490 Hz</td>
          <td>8 bits (0-255)</td>
        </tr>
        <tr>
          <td>ESP32</td>
          <td>Toutes les broches GPIO*</td>
          <td>Variable (jusqu'√† 40 MHz)</td>
          <td>1-16 bits</td>
        </tr>
        <tr>
          <td>ESP8266</td>
          <td>Toutes les broches digitales</td>
          <td>1 kHz</td>
          <td>10 bits (0-1023)</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <h4>Fonction analogWrite()</h4>
  
  <div class="code-example">
    <h5>Syntaxe de base</h5>
    <pre><code><span class="code-comment">// Contr√¥le PWM d'une LED</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 9;  <span class="code-comment">// Broche PWM</span>

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  <span class="code-comment">// Pas besoin de pinMode() pour analogWrite()</span>
  <span class="code-comment">// Mais c'est une bonne pratique de le mettre</span>
  <span class="code-function">pinMode</span>(LED_PIN, OUTPUT);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// √âteint compl√®tement (0%)</span>
  <span class="code-function">analogWrite</span>(LED_PIN, 0);
  <span class="code-function">delay</span>(1000);
  
  <span class="code-comment">// 25% de luminosit√©</span>
  <span class="code-function">analogWrite</span>(LED_PIN, 64);  <span class="code-comment">// 25% de 255 = 64</span>
  <span class="code-function">delay</span>(1000);
  
  <span class="code-comment">// 50% de luminosit√©</span>
  <span class="code-function">analogWrite</span>(LED_PIN, 128); <span class="code-comment">// 50% de 255 = 128</span>
  <span class="code-function">delay</span>(1000);
  
  <span class="code-comment">// 75% de luminosit√©</span>
  <span class="code-function">analogWrite</span>(LED_PIN, 191); <span class="code-comment">// 75% de 255 = 191</span>
  <span class="code-function">delay</span>(1000);
  
  <span class="code-comment">// Pleine luminosit√© (100%)</span>
  <span class="code-function">analogWrite</span>(LED_PIN, 255); <span class="code-comment">// 100% de 255 = 255</span>
  <span class="code-function">delay</span>(1000);
}</code></pre>
  </div>
  
  <h4>Effet de respiration (fade in/out)</h4>
  
  <div class="code-example">
    <h5>Effet de respiration complet</h5>
    <pre><code><span class="code-comment">/*
  Effet de respiration LED
  Variation progressive de la luminosit√©
*/</span>

<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 9;
<span class="code-keyword">int</span> luminosite = 0;
<span class="code-keyword">int</span> increment = 5;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  <span class="code-comment">// La broche 9 supporte PWM sur Arduino Uno</span>
  Serial.<span class="code-function">begin</span>(9600);
  Serial.<span class="code-function">println</span>(<span class="code-string">"Effet de respiration LED PWM"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Applique la luminosit√© courante</span>
  <span class="code-function">analogWrite</span>(LED_PIN, luminosite);
  
  <span class="code-comment">// Change la luminosit√© pour le prochain cycle</span>
  luminosite = luminosite + increment;
  
  <span class="code-comment">// Inverse la direction aux limites</span>
  <span class="code-keyword">if</span> (luminosite <= 0 || luminosite >= 255) {
    increment = -increment;
    
    <span class="code-comment">// Affiche le changement de direction</span>
    Serial.<span class="code-function">print</span>(<span class="code-string">"Direction inversee: "</span>);
    Serial.<span class="code-function">println</span>(increment > 0 ? <span class="code-string">"Mont√©e"</span> : <span class="code-string">"Descente"</span>);
  }
  
  <span class="code-comment">// Affiche la luminosit√© actuelle</span>
  Serial.<span class="code-function">print</span>(<span class="code-string">"Luminosite: "</span>);
  Serial.<span class="code-function">print</span>(luminosite);
  Serial.<span class="code-function">print</span>(<span class="code-string">" ("</span>);
  Serial.<span class="code-function">print</span>((luminosite * 100) / 255);
  Serial.<span class="code-function">println</span>(<span class="code-string">"%)"</span>);
  
  <span class="code-function">delay</span>(30);  <span class="code-comment">// Contr√¥le la vitesse de l'effet</span>
}</code></pre>
  </div>
  
  <h4>PWM avec ESP32 (r√©solution sup√©rieure)</h4>
  
  <div class="code-example">
    <h5>Configuration PWM avanc√©e ESP32</h5>
    <pre><code><span class="code-comment">/*
  PWM avanc√© sur ESP32
  R√©solution 16 bits et fr√©quence configurable
*/</span>

<span class="code-comment">// Biblioth√®que pour PWM ESP32</span>
<span class="code-keyword">#include</span> &lt;Arduino.h&gt;

<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 16;      <span class="code-comment">// GPIO16</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> FREQUENCE = 5000;  <span class="code-comment">// 5 kHz</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> CANAL_PWM = 0;     <span class="code-comment">// Canal PWM (0-15)</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> RESOLUTION = 12;   <span class="code-comment">// 12 bits (0-4095)</span>

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(115200);
  
  <span class="code-comment">// Configuration du PWM ESP32</span>
  ledcSetup(CANAL_PWM, FREQUENCE, RESOLUTION);
  ledcAttachPin(LED_PIN, CANAL_PWM);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"PWM ESP32 configure:"</span>);
  Serial.<span class="code-function">print</span>(<span class="code-string">"Frequence: "</span>);
  Serial.<span class="code-function">print</span>(FREQUENCE);
  Serial.<span class="code-function">println</span>(<span class="code-string">" Hz"</span>);
  Serial.<span class="code-function">print</span>(<span class="code-string">"Resolution: "</span>);
  Serial.<span class="code-function">print</span>(RESOLUTION);
  Serial.<span class="code-function">print</span>(<span class="code-string">" bits ("</span>);
  Serial.<span class="code-function">print</span>((1 << RESOLUTION) - 1);
  Serial.<span class="code-function">println</span>(<span class="code-string">" niveaux)"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Effet de respiration avec haute r√©solution</span>
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> dutyCycle = 0; dutyCycle <= 4095; dutyCycle += 10) {
    ledcWrite(CANAL_PWM, dutyCycle);
    <span class="code-function">delay</span>(1);
  }
  
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> dutyCycle = 4095; dutyCycle >= 0; dutyCycle -= 10) {
    ledcWrite(CANAL_PWM, dutyCycle);
    <span class="code-function">delay</span>(1);
  }
}</code></pre>
  </div>
  
  <div class="warning-box">
    <p><strong>Attention :</strong> Sur ESP32, la fonction <code>analogWrite()</code> n'existe pas par d√©faut. Il faut utiliser les fonctions <code>ledcSetup()</code>, <code>ledcAttachPin()</code> et <code>ledcWrite()</code>.</p>
  </div>
  
  <h4>Applications pratiques du PWM</h4>
  
  <div class="cards">
    <div class="card">
      <i class="fas fa-lightbulb"></i>
      <h5>Contr√¥le de luminosit√©</h5>
      <p>Variation progressive de l'√©clairage LED</p>
    </div>
    <div class="card">
      <i class="fas fa-cogs"></i>
      <h5>Contr√¥le de moteurs</h5>
      <p>Variation de vitesse des moteurs DC</p>
    </div>
    <div class="card">
      <i class="fas fa-sliders-h"></i>
      <h5>Servomoteurs</h5>
      <p>Contr√¥le de position avec signal PWM</p>
    </div>
    <div class="card">
      <i class="fas fa-wave-square"></i>
      <h5>G√©n√©ration de signaux</h5>
      <p>Cr√©ation de formes d'onde simples</p>
    </div>
  </div>
  
  <div class="exercise">
    <h4><i class="fas fa-pencil-alt"></i> Exercice pratique</h4>
    <p><strong>Objectif :</strong> Cr√©er un variateur de lumi√®re contr√¥l√© par potentiom√®tre.</p>
    <p><strong>Mat√©riel requis :</strong></p>
    <ul>
      <li>Arduino Uno</li>
      <li>LED</li>
      <li>R√©sistance 220Œ©</li>
      <li>Potentiom√®tre 10kŒ©</li>
      <li>Breadboard et fils</li>
    </ul>
    <p><strong>Consignes :</strong> Connectez le potentiom√®tre √† l'entr√©e analogique A0 et la LED √† la broche PWM 9. √âcrivez un programme qui lit la valeur du potentiom√®tre (0-1023) et l'applique √† la LED en convertissant l'√©chelle (0-255).</p>
  </div>
</section>
        <h3 id="led-rvb">LED RGB (Cathode commune)</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Controle d'une LED RGB (cathode commune)
  Broches PWM requises : R=9, G=10, B=11
*/</span>

<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_ROUGE = 9;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_VERT = 10;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_BLEU = 11;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  Serial.<span class="code-function">println</span>(<span class="code-string">"Controle LED RGB"</span>);
}

<span class="code-comment">// Fonction pour d√©finir une couleur RGB</span>
<span class="code-keyword">void</span> <span class="code-function">setCouleur</span>(<span class="code-keyword">int</span> rouge, <span class="code-keyword">int</span> vert, <span class="code-keyword">int</span> bleu) {
  <span class="code-function">analogWrite</span>(PIN_ROUGE, rouge);
  <span class="code-function">analogWrite</span>(PIN_VERT, vert);
  <span class="code-function">analogWrite</span>(PIN_BLEU, bleu);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  Serial.<span class="code-function">println</span>(<span class="code-string">"Rouge"</span>);
  <span class="code-function">setCouleur</span>(255, 0, 0);   <span class="code-comment">// Rouge pur</span>
  <span class="code-function">delay</span>(1000);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Vert"</span>);
  <span class="code-function">setCouleur</span>(0, 255, 0);   <span class="code-comment">// Vert pur</span>
  <span class="code-function">delay</span>(1000);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Bleu"</span>);
  <span class="code-function">setCouleur</span>(0, 0, 255);   <span class="code-comment">// Bleu pur</span>
  <span class="code-function">delay</span>(1000);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Jaune"</span>);
  <span class="code-function">setCouleur</span>(255, 255, 0); <span class="code-comment">// Jaune</span>
  <span class="code-function">delay</span>(1000);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Magenta"</span>);
  <span class="code-function">setCouleur</span>(255, 0, 255); <span class="code-comment">// Magenta</span>
  <span class="code-function">delay</span>(1000);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Cyan"</span>);
  <span class="code-function">setCouleur</span>(0, 255, 255); <span class="code-comment">// Cyan</span>
  <span class="code-function">delay</span>(1000);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Blanc"</span>);
  <span class="code-function">setCouleur</span>(255, 255, 255); <span class="code-comment">// Blanc</span>
  <span class="code-function">delay</span>(1000);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Eteint"</span>);
  <span class="code-function">setCouleur</span>(0, 0, 0);     <span class="code-comment">// Eteint</span>
  <span class="code-function">delay</span>(1000);
  
  <span class="code-comment">// D√©grad√© de couleurs</span>
  Serial.<span class="code-function">println</span>(<span class="code-string">"D degrade de couleurs..."</span>);
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i <= 255; i++) {
    <span class="code-function">setCouleur</span>(i, 255 - i, 128);
    <span class="code-function">delay</span>(10);
  }
}</code></pre>
        </div>
      </section>

      <!-- =========================================== -->
      <!-- SECTION BIBLIOTH√àQUES (.H) -->
      <!-- =========================================== -->
      <section id="bibliotheques">
        <h2>Biblioth√®ques Arduino (.h et .cpp)</h2>
        <p>Les biblioth√®ques √©tendent les fonctionnalit√©s d'Arduino en fournissant du code r√©utilisable.</p>

        <h3 id="utilisation-biblio">Utilisation des biblioth√®ques</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Exemple d'utilisation de biblioth√®ques standard
  Utilise Servo.h pour contr√¥ler un servomoteur
  et LiquidCrystal.h pour un √©cran LCD
*/</span>

<span class="code-comment">// Inclusion des biblioth√®ques</span>
<span class="code-keyword">#include</span> &lt;Servo.h&gt;
<span class="code-keyword">#include</span> &lt;LiquidCrystal.h&gt;

<span class="code-comment">// Cr√©ation des objets</span>
Servo monServo;
<span class="code-comment">// LCD: RS, EN, D4, D5, D6, D7</span>
LiquidCrystal lcd(12, 11, 5, 4, 3, 2);

<span class="code-comment">// D√©finition des broches</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_SERVO = 9;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> POT_PIN = A0;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  
  <span class="code-comment">// Initialisation du servomoteur</span>
  monServo.<span class="code-function">attach</span>(PIN_SERVO);
  
  <span class="code-comment">// Initialisation de l'√©cran LCD (16 colonnes, 2 lignes)</span>
  lcd.<span class="code-function">begin</span>(16, 2);
  lcd.<span class="code-function">print</span>(<span class="code-string">"Servo Control"</span>);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Systeme pret"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Lecture du potentiom√®tre</span>
  <span class="code-keyword">int</span> valeurPot = <span class="code-function">analogRead</span>(POT_PIN);
  
  <span class="code-comment">// Conversion en angle (0-180 degr√©s)</span>
  <span class="code-keyword">int</span> angle = <span class="code-function">map</span>(valeurPot, 0, 1023, 0, 180);
  
  <span class="code-comment">// D√©placement du servomoteur</span>
  monServo.<span class="code-function">write</span>(angle);
  
  <span class="code-comment">// Affichage sur LCD</span>
  lcd.<span class="code-function">setCursor</span>(0, 1);
  lcd.<span class="code-function">print</span>(<span class="code-string">"Angle: "</span>);
  lcd.<span class="code-function">print</span>(angle);
  lcd.<span class="code-function">print</span>(<span class="code-string">"   "</span>);  <span class="code-comment">// Pour effacer les caract√®res restants</span>
  
  <span class="code-comment">// Affichage sur moniteur s√©rie</span>
  Serial.<span class="code-function">print</span>(<span class="code-string">"Potentiometre: "</span>);
  Serial.<span class="code-function">print</span>(valeurPot);
  Serial.<span class="code-function">print</span>(<span class="code-string">" | Angle: "</span>);
  Serial.<span class="code-function">println</span>(angle);
  
  <span class="code-function">delay</span>(50);
}</code></pre>
        </div>

        <h3 id="creation-biblio">Cr√©ation d'une biblioth√®que personnalis√©e</h3>

        <div class="code-example">
          <h4>Fichier LEDController.h (en-t√™te)</h4>
          <pre><code><span class="code-comment">/*
  LEDController.h - Biblioth√®que pour contr√¥ler des LEDs
  Cr√©√© par Votre Nom, Date
*/</span>

<span class="code-comment">// Garde contre les inclusions multiples</span>
<span class="code-keyword">#ifndef</span> LEDController_h
<span class="code-keyword">#define</span> LEDController_h

<span class="code-comment">// Inclusion des biblioth√®ques n√©cessaires</span>
<span class="code-keyword">#include</span> <span class="code-string">"Arduino.h"</span>

<span class="code-comment">// D√©finition de la classe</span>
<span class="code-keyword">class</span> LEDController {
  <span class="code-keyword">public</span>:
    <span class="code-comment">// Constructeurs</span>
    LEDController(<span class="code-keyword">int</span> pin);                     <span class="code-comment">// Constructeur simple</span>
    LEDController(<span class="code-keyword">int</span> pin, <span class="code-keyword">bool</span> initialState); <span class="code-comment">// Avec √©tat initial</span>
    
    <span class="code-comment">// M√©thodes publiques</span>
    <span class="code-keyword">void</span> <span class="code-function">begin</span>();                          <span class="code-comment">// Initialisation</span>
    <span class="code-keyword">void</span> <span class="code-function">on</span>();                             <span class="code-comment">// Allume la LED</span>
    <span class="code-keyword">void</span> <span class="code-function">off</span>();                            <span class="code-comment">// √âteint la LED</span>
    <span class="code-keyword">void</span> <span class="code-function">toggle</span>();                         <span class="code-comment">// Inverse l'√©tat</span>
    <span class="code-keyword">void</span> <span class="code-function">blink</span>(<span class="code-keyword">int</span> delayTime);               <span class="code-comment">// Fait clignoter</span>
    <span class="code-keyword">void</span> <span class="code-function">setBrightness</span>(<span class="code-keyword">int</span> brightness);      <span class="code-comment">// PWM (0-255)</span>
    <span class="code-keyword">bool</span> <span class="code-function">isOn</span>();                           <span class="code-comment">// Retourne l'√©tat</span>
    
  <span class="code-keyword">private</span>:
    <span class="code-comment">// Variables membres priv√©es</span>
    <span class="code-keyword">int</span> _pin;                               <span class="code-comment">// Broche de la LED</span>
    <span class="code-keyword">bool</span> _state;                            <span class="code-comment">// √âtat courant</span>
    <span class="code-keyword">bool</span> _isPWM;                            <span class="code-comment">// Si la broche supporte PWM</span>
    <span class="code-keyword">int</span> _brightness;                        <span class="code-comment">// Luminosit√© (0-255)</span>
    
    <span class="code-comment">// M√©thode priv√©e</span>
    <span class="code-keyword">void</span> <span class="code-function">_updateLED</span>();                     <span class="code-comment">// Met √† jour la LED</span>
};

<span class="code-keyword">#endif</span></code></pre>
        </div>

        <div class="code-example">
          <h4>Fichier LEDController.cpp (impl√©mentation)</h4>
          <pre><code><span class="code-comment">/*
  LEDController.cpp - Impl√©mentation de la biblioth√®que LEDController
*/</span>

<span class="code-keyword">#include</span> <span class="code-string">"Arduino.h"</span>
<span class="code-keyword">#include</span> <span class="code-string">"LEDController.h"</span>

<span class="code-comment">// Liste des broches PWM sur Arduino Uno</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> pwmPins[] = {3, 5, 6, 9, 10, 11};
<span class="code-keyword">const</span> <span class="code-keyword">int</span> numPwmPins = 6;

<span class="code-comment">// Constructeur simple</span>
LEDController::LEDController(<span class="code-keyword">int</span> pin) {
  _pin = pin;
  _state = <span class="code-keyword">false</span>;
  _brightness = 255;
  _isPWM = <span class="code-keyword">false</span>;
  
  <span class="code-comment">// V√©rifie si la broche supporte PWM</span>
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < numPwmPins; i++) {
    <span class="code-keyword">if</span> (pin == pwmPins[i]) {
      _isPWM = <span class="code-keyword">true</span>;
      <span class="code-keyword">break</span>;
    }
  }
}

<span class="code-comment">// Constructeur avec √©tat initial</span>
LEDController::LEDController(<span class="code-keyword">int</span> pin, <span class="code-keyword">bool</span> initialState) {
  _pin = pin;
  _state = initialState;
  _brightness = 255;
  _isPWM = <span class="code-keyword">false</span>;
  
  <span class="code-comment">// V√©rifie si la broche supporte PWM</span>
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < numPwmPins; i++) {
    <span class="code-keyword">if</span> (pin == pwmPins[i]) {
      _isPWM = <span class="code-keyword">true</span>;
      <span class="code-keyword">break</span>;
    }
  }
}

<span class="code-comment">// Initialisation</span>
<span class="code-keyword">void</span> LEDController::<span class="code-function">begin</span>() {
  <span class="code-function">pinMode</span>(_pin, OUTPUT);
  <span class="code-function">_updateLED</span>();
}

<span class="code-comment">// Allume la LED</span>
<span class="code-keyword">void</span> LEDController::<span class="code-function">on</span>() {
  _state = <span class="code-keyword">true</span>;
  <span class="code-function">_updateLED</span>();
}

<span class="code-comment">// √âteint la LED</span>
<span class="code-keyword">void</span> LEDController::<span class="code-function">off</span>() {
  _state = <span class="code-keyword">false</span>;
  <span class="code-function">_updateLED</span>();
}

<span class="code-comment">// Inverse l'√©tat</span>
<span class="code-keyword">void</span> LEDController::<span class="code-function">toggle</span>() {
  _state = !_state;
  <span class="code-function">_updateLED</span>();
}

<span class="code-comment">// Fait clignoter la LED</span>
<span class="code-keyword">void</span> LEDController::<span class="code-function">blink</span>(<span class="code-keyword">int</span> delayTime) {
  <span class="code-function">on</span>();
  <span class="code-function">delay</span>(delayTime);
  <span class="code-function">off</span>();
  <span class="code-function">delay</span>(delayTime);
}

<span class="code-comment">// D√©finit la luminosit√© (PWM)</span>
<span class="code-keyword">void</span> LEDController::<span class="code-function">setBrightness</span>(<span class="code-keyword">int</span> brightness) {
  <span class="code-keyword">if</span> (brightness < 0) brightness = 0;
  <span class="code-keyword">if</span> (brightness > 255) brightness = 255;
  _brightness = brightness;
  <span class="code-function">_updateLED</span>();
}

<span class="code-comment">// Retourne l'√©tat de la LED</span>
<span class="code-keyword">bool</span> LEDController::<span class="code-function">isOn</span>() {
  <span class="code-keyword">return</span> _state;
}

<span class="code-comment">// M√©thode priv√©e : met √† jour la LED</span>
<span class="code-keyword">void</span> LEDController::<span class="code-function">_updateLED</span>() {
  <span class="code-keyword">if</span> (_state) {
    <span class="code-keyword">if</span> (_isPWM) {
      <span class="code-function">analogWrite</span>(_pin, _brightness);
    } <span class="code-keyword">else</span> {
      <span class="code-function">digitalWrite</span>(_pin, HIGH);
    }
  } <span class="code-keyword">else</span> {
    <span class="code-function">digitalWrite</span>(_pin, LOW);
  }
}</code></pre>
        </div>

        <div class="code-example">
          <h4>Exemple d'utilisation de la biblioth√®que</h4>
          <pre><code><span class="code-comment">/*
  Test de la biblioth√®que LEDController
*/</span>

<span class="code-keyword">#include</span> <span class="code-string">"LEDController.h"</span>

<span class="code-comment">// Cr√©ation d'objets LEDController</span>
LEDController led1(13);          <span class="code-comment">// LED sur broche 13 (digital)</span>
LEDController led2(9, <span class="code-keyword">false</span>);   <span class="code-comment">// LED sur broche 9 (PWM), √©teinte au d√©part</span>

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  
  <span class="code-comment">// Initialisation des LEDs</span>
  led1.<span class="code-function">begin</span>();
  led2.<span class="code-function">begin</span>();
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Test biblioth√®que LEDController"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  Serial.<span class="code-function">println</span>(<span class="code-string">"LED1: Clignotement simple"</span>);
  led1.<span class="code-function">blink</span>(500);  <span class="code-comment">// Clignote toutes les 500ms</span>
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"LED2: Variation de luminosite"</span>);
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i <= 255; i += 5) {
    led2.<span class="code-function">on</span>();
    led2.<span class="code-function">setBrightness</span>(i);
    <span class="code-function">delay</span>(20);
  }
  
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 255; i >= 0; i -= 5) {
    led2.<span class="code-function">setBrightness</span>(i);
    <span class="code-function">delay</span>(20);
  }
  
  led2.<span class="code-function">off</span>();
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Test toggle"</span>);
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 5; i++) {
    led1.<span class="code-function">toggle</span>();
    led2.<span class="code-function">toggle</span>();
    <span class="code-function">delay</span>(200);
  }
  
  <span class="code-comment">// V√©rification de l'√©tat</span>
  <span class="code-keyword">if</span> (led1.<span class="code-function">isOn</span>()) {
    Serial.<span class="code-function">println</span>(<span class="code-string">"LED1 est allumee"</span>);
  } <span class="code-keyword">else</span> {
    Serial.<span class="code-function">println</span>(<span class="code-string">"LED1 est eteinte"</span>);
  }
}</code></pre>
        </div>
        <!-- =========================================== -->
<!-- SECTION BIBLIOTH√àQUES STANDARD - MANQUANTE -->
<!-- =========================================== -->
<section id="biblio-standard">
  <h3>Biblioth√®ques Arduino standard</h3>
  
  <p>L'IDE Arduino inclut un ensemble de biblioth√®ques standard qui facilitent le d√©veloppement en fournissant des fonctions pr√™tes √† l'emploi pour des t√¢ches courantes.</p>
  
  <div class="info-box">
    <p><strong>Inclure une biblioth√®que :</strong> Utilisez <code>#include &lt;NomBibliotheque.h&gt;</code> en haut de votre sketch. Les biblioth√®ques standard sont automatiquement disponibles dans l'IDE.</p>
  </div>
  
  <h4>Principales biblioth√®ques standard</h4>
  
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Biblioth√®que</th>
          <th>Description</th>
          <th>Fonctions principales</th>
          <th>Exemple d'utilisation</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>EEPROM.h</strong></td>
          <td>Gestion de la m√©moire EEPROM</td>
          <td>EEPROM.read(), EEPROM.write()</td>
          <td>Sauvegarde de donn√©es</td>
        </tr>
        <tr>
          <td><strong>Servo.h</strong></td>
          <td>Contr√¥le de servomoteurs</td>
          <td>Servo.attach(), Servo.write()</td>
          <td>Robots, syst√®mes de contr√¥le</td>
        </tr>
        <tr>
          <td><strong>Stepper.h</strong></td>
          <td>Contr√¥le de moteurs pas-√†-pas</td>
          <td>Stepper.step(), Stepper.setSpeed()</td>
          <td>Imprimantes 3D, CNC</td>
        </tr>
        <tr>
          <td><strong>SPI.h</strong></td>
          <td>Communication SPI</td>
          <td>SPI.begin(), SPI.transfer()</td>
          <td>√âcrans, cartes SD, capteurs</td>
        </tr>
        <tr>
          <td><strong>Wire.h</strong></td>
          <td>Communication I2C/TWI</td>
          <td>Wire.begin(), Wire.read()</td>
          <td>Capteurs, afficheurs</td>
        </tr>
        <tr>
          <td><strong>LiquidCrystal.h</strong></td>
          <td>Contr√¥le d'√©crans LCD</td>
          <td>LiquidCrystal.begin(), print()</td>
          <td>Affichage d'informations</td>
        </tr>
        <tr>
          <td><strong>SD.h</strong></td>
          <td>Lecture/√©criture cartes SD</td>
          <td>SD.begin(), SD.open()</td>
          <td>Enregistrement de donn√©es</td>
        </tr>
        <tr>
          <td><strong>SoftwareSerial.h</strong></td>
          <td>Port s√©rie logiciel</td>
          <td>SoftwareSerial.read()</td>
          <td>Communication s√©rie additionnelle</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <h4>Exemples d√©taill√©s d'utilisation</h4>
  
  <h5>1. Biblioth√®que EEPROM - Sauvegarde de donn√©es</h5>
  
  <div class="code-example">
    <h5>Sauvegarde et lecture en EEPROM</h5>
    <pre><code><span class="code-comment">/*
  Utilisation de la m√©moire EEPROM
  Sauvegarde de donn√©es persistantes
*/</span>

<span class="code-keyword">#include</span> &lt;EEPROM.h&gt;

<span class="code-keyword">const</span> <span class="code-keyword">int</span> ADRESSE_COMPTEUR = 0;  <span class="code-comment">// Adresse en EEPROM</span>
<span class="code-keyword">int</span> compteur;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  
  <span class="code-comment">// Lecture du compteur depuis l'EEPROM</span>
  EEPROM.<span class="code-function">get</span>(ADRESSE_COMPTEUR, compteur);
  
  <span class="code-keyword">if</span> (<span class="code-function">isnan</span>(compteur)) {  <span class="code-comment">// Premi√®re utilisation</span>
    compteur = 0;
    Serial.<span class="code-function">println</span>(<span class="code-string">"Initialisation du compteur"</span>);
  }
  
  Serial.<span class="code-function">print</span>(<span class="code-string">"Compteur actuel: "</span>);
  Serial.<span class="code-function">println</span>(compteur);
  
  <span class="code-comment">// Incr√©mente le compteur</span>
  compteur++;
  
  <span class="code-comment">// Sauvegarde en EEPROM</span>
  EEPROM.<span class="code-function">put</span>(ADRESSE_COMPTEUR, compteur);
  
  Serial.<span class="code-function">print</span>(<span class="code-string">"Nouveau compteur: "</span>);
  Serial.<span class="code-function">println</span>(compteur);
  Serial.<span class="code-function">println</span>(<span class="code-string">"Donnees sauvegardees en EEPROM"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Programme qui s'ex√©cute une seule fois</span>
  <span class="code-function">delay</span>(1000);
}</code></pre>
  </div>
  
  <div class="info-box">
    <p><strong>Note :</strong> La m√©moire EEPROM a une dur√©e de vie limit√©e (environ 100,000 cycles d'√©criture). √âvitez d'√©crire fr√©quemment aux m√™mes adresses.</p>
  </div>
  
  <h5>2. Biblioth√®que Servo - Contr√¥le de servomoteur</h5>
  
  <div class="code-example">
    <h5>Contr√¥le pr√©cis d'un servomoteur</h5>
    <pre><code><span class="code-comment">/*
  Contr√¥le d'un servomoteur avec potentiom√®tre
*/</span>

<span class="code-keyword">#include</span> &lt;Servo.h&gt;

Servo monServo;            <span class="code-comment">// Cr√©ation d'un objet Servo</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_SERVO = 9;   <span class="code-comment">// Broche du servomoteur</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_POT = A0;     <span class="code-comment">// Potentiom√®tre</span>
<span class="code-keyword">int</span> anglePrecedent = 0;    <span class="code-comment">// Pour d√©tecter les changements</span>

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  
  <span class="code-comment">// Attache le servomoteur √† la broche</span>
  monServo.<span class="code-function">attach</span>(PIN_SERVO);
  
  <span class="code-comment">// Position initiale √† 90¬∞ (milieu)</span>
  monServo.<span class="code-function">write</span>(90);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Controle servomoteur avec potentiometre"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Lecture du potentiom√®tre (0-1023)</span>
  <span class="code-keyword">int</span> valeurPot = <span class="code-function">analogRead</span>(PIN_POT);
  
  <span class="code-comment">// Conversion en angle (0-180 degr√©s)</span>
  <span class="code-keyword">int</span> angle = <span class="code-function">map</span>(valeurPot, 0, 1023, 0, 180);
  
  <span class="code-comment">// D√©placement du servomoteur seulement si l'angle a chang√©</span>
  <span class="code-keyword">if</span> (<span class="code-function">abs</span>(angle - anglePrecedent) > 2) {
    monServo.<span class="code-function">write</span>(angle);
    anglePrecedent = angle;
    
    <span class="code-comment">// Affichage des informations</span>
    Serial.<span class="code-function">print</span>(<span class="code-string">"Potentiometre: "</span>);
    Serial.<span class="code-function">print</span>(valeurPot);
    Serial.<span class="code-function">print</span>(<span class="code-string">" | Angle: "</span>);
    Serial.<span class="code-function">print</span>(angle);
    Serial.<span class="code-function">println</span>(<span class="code-string">"¬∞"</span>);
  }
  
  <span class="code-function">delay</span>(20);  <span class="code-comment">// D√©lai pour stabilit√©</span>
}</code></pre>
  </div>
  
  <h5>3. Biblioth√®que LiquidCrystal - Affichage LCD</h5>
  
  <div class="code-example">
    <h5>Affichage sur √©cran LCD 16x2</h5>
    <pre><code><span class="code-comment">/*
  Affichage d'informations sur √©cran LCD
  Connexion standard 4 bits
*/</span>

<span class="code-keyword">#include</span> &lt;LiquidCrystal.h&gt;

<span class="code-comment">// Initialisation LCD (RS, EN, D4, D5, D6, D7)</span>
LiquidCrystal lcd(12, 11, 5, 4, 3, 2);

<span class="code-keyword">int</span> compteur = 0;
<span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierUpdate = 0;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  <span class="code-comment">// Initialisation de l'√©cran (16 colonnes, 2 lignes)</span>
  lcd.<span class="code-function">begin</span>(16, 2);
  
  <span class="code-comment">// Message d'accueil</span>
  lcd.<span class="code-function">print</span>(<span class="code-string">"Bienvenue!"</span>);
  <span class="code-function">delay</span>(2000);
  
  lcd.<span class="code-function">clear</span>();
  lcd.<span class="code-function">print</span>(<span class="code-string">"Compteur: 0"</span>);
  lcd.<span class="code-function">setCursor</span>(0, 1);
  lcd.<span class="code-function">print</span>(<span class="code-string">"Temp: 20.5C"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> maintenant = <span class="code-function">millis</span>();
  
  <span class="code-keyword">if</span> (maintenant - dernierUpdate > 1000) {
    dernierUpdate = maintenant;
    
    <span class="code-comment">// Incr√©mente le compteur</span>
    compteur++;
    
    <span class="code-comment">// Simulation de temp√©rature</span>
    <span class="code-keyword">float</span> temperature = 20.0 + (<span class="code-function">sin</span>(compteur * 0.1) * 5.0);
    
    <span class="code-comment">// Mise √† jour de l'affichage</span>
    lcd.<span class="code-function">clear</span>();
    lcd.<span class="code-function">setCursor</span>(0, 0);
    lcd.<span class="code-function">print</span>(<span class="code-string">"Compteur: "</span>);
    lcd.<span class="code-function">print</span>(compteur);
    
    lcd.<span class="code-function">setCursor</span>(0, 1);
    lcd.<span class="code-function">print</span>(<span class="code-string">"Temp: "</span>);
    lcd.<span class="code-function">print</span>(temperature, 1);
    lcd.<span class="code-function">print</span>((<span class="code-type">char</span>)223);  <span class="code-comment">// Symbole degr√©</span>
    lcd.<span class="code-function">print</span>(<span class="code-string">"C"</span>);
    
    <span class="code-comment">// Affichage barre de progression</span>
    <span class="code-keyword">int</span> progression = compteur % 17;  <span class="code-comment">// 0-16</span>
    lcd.<span class="code-function">setCursor</span>(progression, 0);
    lcd.<span class="code-function">print</span>(<span class="code-string">"&gt;"</span>);  <span class="code-comment">// Curseur de progression</span>
  }
  
  <span class="code-function">delay</span>(100);
}</code></pre>
  </div>
  
  <h4>Biblioth√®ques de communication</h4>
  
  <h5>4. Biblioth√®que Wire - Communication I2C</h5>
  
  <div class="code-example">
    <h5>Communication I2C avec capteur</h5>
    <pre><code><span class="code-comment">/*
  Communication I2C avec un p√©riph√©rique
  Exemple avec scan de bus I2C
*/</span>

<span class="code-keyword">#include</span> &lt;Wire.h&gt;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Wire.<span class="code-function">begin</span>();        <span class="code-comment">// Rejoint le bus I2C en tant que master</span>
  Serial.<span class="code-function">begin</span>(9600);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Scan du bus I2C..."</span>);
  
  <span class="code-keyword">int</span> peripheriquesTrouves = 0;
  
  <span class="code-keyword">for</span> (<span class="code-keyword">byte</span> adresse = 1; adresse < 127; adresse++) {
    Wire.<span class="code-function">beginTransmission</span>(adresse);
    <span class="code-keyword">byte</span> erreur = Wire.<span class="code-function">endTransmission</span>();
    
    <span class="code-keyword">if</span> (erreur == 0) {
      Serial.<span class="code-function">print</span>(<span class="code-string">"Peripherique I2C trouve a l'adresse 0x"</span>);
      <span class="code-keyword">if</span> (adresse < 16) Serial.<span class="code-function">print</span>(<span class="code-string">"0"</span>);
      Serial.<span class="code-function">print</span>(adresse, HEX);
      Serial.<span class="code-function">println</span>();
      
      peripheriquesTrouves++;
    }
  }
  
  <span class="code-keyword">if</span> (peripheriquesTrouves == 0) {
    Serial.<span class="code-function">println</span>(<span class="code-string">"Aucun peripherique I2C trouve"</span>);
  } <span class="code-keyword">else</span> {
    Serial.<span class="code-function">print</span>(<span class="code-string">"Total: "</span>);
    Serial.<span class="code-function">print</span>(peripheriquesTrouves);
    Serial.<span class="code-function">println</span>(<span class="code-string">" peripherique(s) I2C"</span>);
  }
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Le scan ne s'ex√©cute qu'une fois</span>
  <span class="code-function">delay</span>(5000);
}</code></pre>
  </div>
  
  <h5>5. Biblioth√®que SPI - Communication s√©rie haute vitesse</h5>
  
  <div class="code-example">
    <h5>Configuration SPI de base</h5>
    <pre><code><span class="code-comment">/*
  Configuration de la communication SPI
*/</span>

<span class="code-keyword">#include</span> &lt;SPI.h&gt;

<span class="code-comment">// Broches SPI (d√©pendent de la carte)</span>
<span class="code-keyword">#ifdef</span> ARDUINO_AVR_UNO
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_SS = 10;    <span class="code-comment">// Slave Select</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_MOSI = 11;   <span class="code-comment">// Master Out Slave In</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_MISO = 12;   <span class="code-comment">// Master In Slave Out</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> PIN_SCK = 13;    <span class="code-comment">// Serial Clock</span>
<span class="code-keyword">#endif</span>

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  
  <span class="code-comment">// Initialisation SPI</span>
  SPI.<span class="code-function">begin</span>();
  
  <span class="code-comment">// Configuration des broches</span>
  <span class="code-function">pinMode</span>(PIN_SS, OUTPUT);
  digitalWrite(PIN_SS, HIGH);  <span class="code-comment">// D√©sactive l'esclave par d√©faut</span>
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"SPI initialise"</span>);
  
  <span class="code-comment">// Test d'envoi de donn√©es</span>
  <span class="code-function">envoyerDonneesSPI</span>(0xAA);  <span class="code-comment">// Donn√©e de test</span>
}

<span class="code-keyword">void</span> <span class="code-function">envoyerDonneesSPI</span>(<span class="code-keyword">byte</span> donnee) {
  digitalWrite(PIN_SS, LOW);   <span class="code-comment">// S√©lectionne l'esclave</span>
  
  <span class="code-comment">// Envoi de la donn√©e</span>
  <span class="code-keyword">byte</span> reponse = SPI.<span class="code-function">transfer</span>(donnee);
  
  digitalWrite(PIN_SS, HIGH);  <span class="code-comment">// Lib√®re l'esclave</span>
  
  Serial.<span class="code-function">print</span>(<span class="code-string">"Donnee envoyee: 0x"</span>);
  Serial.<span class="code-function">print</span>(donnee, HEX);
  Serial.<span class="code-function">print</span>(<span class="code-string">" | Reponse: 0x"</span>);
  Serial.<span class="code-function">println</span>(reponse, HEX);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Envoi p√©riodique de donn√©es</span>
  <span class="code-keyword">static</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierEnvoi = 0;
  <span class="code-keyword">static</span> <span class="code-keyword">byte</span> compteur = 0;
  
  <span class="code-keyword">if</span> (<span class="code-function">millis</span>() - dernierEnvoi > 1000) {
    dernierEnvoi = <span class="code-function">millis</span>();
    
    <span class="code-function">envoyerDonneesSPI</span>(compteur);
    compteur++;
  }
  
  <span class="code-function">delay</span>(10);
}</code></pre>
  </div>
  
  <h4>Bonnes pratiques avec les biblioth√®ques</h4>
  
  <div class="info-box">
    <ol>
      <li><strong>V√©rifiez la documentation :</strong> Chaque biblioth√®que a sa propre documentation avec des exemples</li>
      <li><strong>Gestion de la m√©moire :</strong> Certaines biblioth√®ques consomment beaucoup de m√©moire (SD, Ethernet)</li>
      <li><strong>Compatibilit√© :</strong> V√©rifiez que la biblioth√®que est compatible avec votre carte</li>
      <li><strong>Version :</strong> Certaines biblioth√®ques peuvent avoir des versions diff√©rentes</li>
      <li><strong>Conflits :</strong> √âvitez d'inclure des biblioth√®ques qui utilisent les m√™mes ressources</li>
    </ol>
  </div>
  
  <div class="exercise">
    <h4><i class="fas fa-pencil-alt"></i> Exercice pratique</h4>
    <p><strong>Objectif :</strong> Cr√©er un enregistreur de donn√©es avec EEPROM et affichage LCD.</p>
    <p><strong>Mat√©riel requis :</strong></p>
    <ul>
      <li>Arduino Uno</li>
      <li>√âcran LCD 16x2</li>
      <li>Capteur de temp√©rature (DHT11 ou simulation)</li>
      <li>Bouton poussoir</li>
    </ul>
    <p><strong>Consignes :</strong></p>
    <ol>
      <li>Affichez la temp√©rature actuelle sur la premi√®re ligne du LCD</li>
      <li>Sur la deuxi√®me ligne, affichez la temp√©rature maximale enregistr√©e</li>
      <li>Utilisez l'EEPROM pour sauvegarder la temp√©rature maximale</li>
      <li>Un bouton doit permettre de r√©initialiser le maximum</li>
      <li>Utilisez les biblioth√®ques <code>LiquidCrystal.h</code> et <code>EEPROM.h</code></li>
    </ol>
  </div>
  
</section>
      </section>

      <!-- =========================================== -->
      <!-- SECTION STRUCTURES DE CONTR√îLE -->
      <!-- =========================================== -->
      <section id="structures-controle">
        <h2>Structures de contr√¥le en C++/Arduino</h2>
        <p>Les structures de contr√¥le permettent de diriger l'ex√©cution du code en fonction de conditions ou de r√©p√©ter
          des blocs de code.</p>

        <h3 id="conditions">Structures conditionnelles</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Exemples complets de structures conditionnelles
*/</span>

<span class="code-keyword">const</span> <span class="code-keyword">int</span> CAPTEUR_PIN = A0;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 13;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> SEUIL_BAS = 300;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> SEUIL_HAUT = 700;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  <span class="code-function">pinMode</span>(LED_PIN, OUTPUT);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-keyword">int</span> valeur = <span class="code-function">analogRead</span>(CAPTEUR_PIN);
  
  <span class="code-comment">// =======================</span>
  <span class="code-comment">// 1. Structure if simple</span>
  <span class="code-comment">// =======================</span>
  <span class="code-keyword">if</span> (valeur > SEUIL_HAUT) {
    <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
    Serial.<span class="code-function">println</span>(<span class="code-string">"LED allumee (valeur haute)"</span>);
  }
  
  <span class="code-comment">// ==========================</span>
  <span class="code-comment">// 2. Structure if-else</span>
  <span class="code-comment">// ==========================</span>
  <span class="code-keyword">if</span> (valeur > 500) {
    Serial.<span class="code-function">println</span>(<span class="code-string">"Valeur superieure a 500"</span>);
  } <span class="code-keyword">else</span> {
    Serial.<span class="code-function">println</span>(<span class="code-string">"Valeur inferieure ou egale a 500"</span>);
  }
  
  <span class="code-comment">// ==============================</span>
  <span class="code-comment">// 3. Structure if-else if-else</span>
  <span class="code-comment">// ==============================</span>
  <span class="code-keyword">if</span> (valeur < SEUIL_BAS) {
    Serial.<span class="code-function">println</span>(<span class="code-string">"Niveau BAS"</span>);
    <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
  } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (valeur >= SEUIL_BAS && valeur <= SEUIL_HAUT) {
    Serial.<span class="code-function">println</span>(<span class="code-string">"Niveau MOYEN"</span>);
    <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
    <span class="code-function">delay</span>(100);
    <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
    <span class="code-function">delay</span>(100);
  } <span class="code-keyword">else</span> {
    Serial.<span class="code-function">println</span>(<span class="code-string">"Niveau HAUT"</span>);
    <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
  }
  
  <span class="code-comment">// ==============================</span>
  <span class="code-comment">// 4. Op√©rateur ternaire</span>
  <span class="code-comment">// ==============================</span>
  <span class="code-type">String</span> etat = (valeur > 500) ? <span class="code-string">"HAUT"</span> : <span class="code-string">"BAS"</span>;
  Serial.<span class="code-function">print</span>(<span class="code-string">"Etat (ternaire): "</span>);
  Serial.<span class="code-function">println</span>(etat);
  
  <span class="code-comment">// Condition complexe avec op√©rateurs logiques</span>
  <span class="code-keyword">bool</span> condition1 = (valeur > 200);
  <span class="code-keyword">bool</span> condition2 = (valeur < 800);
  
  <span class="code-keyword">if</span> (condition1 && condition2) {          <span class="code-comment">// ET logique</span>
    Serial.<span class="code-function">println</span>(<span class="code-string">"Valeur entre 200 et 800"</span>);
  }
  
  <span class="code-keyword">if</span> (valeur < 100 || valeur > 900) {     <span class="code-comment">// OU logique</span>
    Serial.<span class="code-function">println</span>(<span class="code-string">"Valeur extreme!"</span>);
  }
  
  <span class="code-keyword">if</span> (!(valeur < 0)) {                    <span class="code-comment">// NON logique</span>
    Serial.<span class="code-function">println</span>(<span class="code-string">"Valeur positive"</span>);
  }
  
  <span class="code-function">delay</span>(1000);
}</code></pre>
        </div>

      

        <h3 id="boucles">Boucles de r√©p√©tition</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Exemples complets de boucles
*/</span>

<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 13;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  <span class="code-function">pinMode</span>(LED_PIN, OUTPUT);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  Serial.<span class="code-function">println</span>(<span class="code-string">"=== Demonstration des boucles ==="</span>);
  
  <span class="code-comment">// ==============================</span>
  <span class="code-comment">// 1. Boucle for classique</span>
  <span class="code-comment">// ==============================</span>
  Serial.<span class="code-function">println</span>(<span class="code-string">"Boucle for:"</span>);
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 5; i++) {
    Serial.<span class="code-function">print</span>(<span class="code-string">"Iteration "</span>);
    Serial.<span class="code-function">println</span>(i);
    <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
    <span class="code-function">delay</span>(100);
    <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
    <span class="code-function">delay</span>(100);
  }
  
  <span class="code-comment">// Boucle for avec pas de 2</span>
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i <= 10; i += 2) {
    Serial.<span class="code-function">print</span>(<span class="code-string">"i = "</span>);
    Serial.<span class="code-function">println</span>(i);
  }
  
  <span class="code-comment">// Boucle for d√©croissante</span>
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 10; i > 0; i--) {
    Serial.<span class="code-function">print</span>(<span class="code-string">"Decount: "</span>);
    Serial.<span class="code-function">println</span>(i);
    <span class="code-function">delay</span>(200);
  }
  
  <span class="code-comment">// ==============================</span>
  <span class="code-comment">// 2. Boucle while</span>
  <span class="code-comment">// ==============================</span>
  Serial.<span class="code-function">println</span>(<span class="code-string">"Boucle while:"</span>);
  <span class="code-keyword">int</span> compteur = 0;
  <span class="code-keyword">while</span> (compteur < 3) {
    Serial.<span class="code-function">print</span>(<span class="code-string">"Compteur = "</span>);
    Serial.<span class="code-function">println</span>(compteur);
    <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
    <span class="code-function">delay</span>(300);
    <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
    <span class="code-function">delay</span>(300);
    compteur++;
  }
  
  <span class="code-comment">// ==============================</span>
  <span class="code-comment">// 3. Boucle do-while</span>
  <span class="code-comment">// ==============================</span>
  Serial.<span class="code-function">println</span>(<span class="code-string">"Boucle do-while:"</span>);
  compteur = 0;
  <span class="code-keyword">do</span> {
    Serial.<span class="code-function">print</span>(<span class="code-string">"Compteur do-while = "</span>);
    Serial.<span class="code-function">println</span>(compteur);
    compteur++;
  } <span class="code-keyword">while</span> (compteur < 3);
  
  <span class="code-comment">// La diff√©rence avec while : do-while s'ex√©cute au moins une fois</span>
  compteur = 10;
  <span class="code-keyword">do</span> {
    Serial.<span class="code-function">println</span>(<span class="code-string">"Ce message s'affiche malgre compteur = 10"</span>);
  } <span class="code-keyword">while</span> (compteur < 3);
  
  <span class="code-comment">// ==============================</span>
  <span class="code-comment">// 4. Boucles imbriqu√©es</span>
  <span class="code-comment">// ==============================</span>
  Serial.<span class="code-function">println</span>(<span class="code-string">"Boucles imbriquees:"</span>);
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> ligne = 1; ligne <= 3; ligne++) {
    <span class="code-keyword">for</span> (<span class="code-keyword">int</span> colonne = 1; colonne <= 3; colonne++) {
      Serial.<span class="code-function">print</span>(<span class="code-string">"("</span>);
      Serial.<span class="code-function">print</span>(ligne);
      Serial.<span class="code-function">print</span>(<span class="code-string">","</span>);
      Serial.<span class="code-function">print</span>(colonne);
      Serial.<span class="code-function">print</span>(<span class="code-string">") "</span>);
    }
    Serial.<span class="code-function">println</span>();
  }
  
  <span class="code-comment">// ==============================</span>
  <span class="code-comment">// 5. Instructions de contr√¥le</span>
  <span class="code-comment">// ==============================</span>
  Serial.<span class="code-function">println</span>(<span class="code-string">"Instructions break et continue:"</span>);
  
  <span class="code-comment">// break : sort de la boucle</span>
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 10; i++) {
    <span class="code-keyword">if</span> (i == 5) {
      Serial.<span class="code-function">println</span>(<span class="code-string">"Break a i = 5"</span>);
      <span class="code-keyword">break</span>;  <span class="code-comment">// Sort de la boucle</span>
    }
    Serial.<span class="code-function">print</span>(i);
    Serial.<span class="code-function">print</span>(<span class="code-string">" "</span>);
  }
  Serial.<span class="code-function">println</span>();
  
  <span class="code-comment">// continue : passe √† l'it√©ration suivante</span>
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 10; i++) {
    <span class="code-keyword">if</span> (i % 2 == 0) {
      <span class="code-keyword">continue</span>;  <span class="code-comment">// Passe les nombres pairs</span>
    }
    Serial.<span class="code-function">print</span>(i);
    Serial.<span class="code-function">print</span>(<span class="code-string">" "</span>);
  }
  Serial.<span class="code-function">println</span>();
  
  <span class="code-function">delay</span>(3000);
}</code></pre>
        </div>

        <h3 id="switch-case">Structure switch-case</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Exemple de switch-case pour un menu de commandes
*/</span>

<span class="code-keyword">char</span> commande;
<span class="code-keyword">int</span> ledPin = 13;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  <span class="code-function">pinMode</span>(ledPin, OUTPUT);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Systeme de commandes LED"</span>);
  Serial.<span class="code-function">println</span>(<span class="code-string">"Commandes disponibles:"</span>);
  Serial.<span class="code-function">println</span>(<span class="code-string">"  a - Allumer LED"</span>);
  Serial.<span class="code-function">println</span>(<span class="code-string">"  e - Eteindre LED"</span>);
  Serial.<span class="code-function">println</span>(<span class="code-string">"  c - Clignoter LED"</span>);
  Serial.<span class="code-function">println</span>(<span class="code-string">"  s - SOS"</span>);
  Serial.<span class="code-function">println</span>(<span class="code-string">"  q - Quitter"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-keyword">if</span> (Serial.<span class="code-function">available</span>()) {
    commande = Serial.<span class="code-function">read</span>();
    
    <span class="code-comment">// Structure switch-case pour traiter la commande</span>
    <span class="code-keyword">switch</span> (commande) {
      <span class="code-keyword">case</span> <span class="code-string">'a'</span>:
      <span class="code-keyword">case</span> <span class="code-string">'A'</span>:
        Serial.<span class="code-function">println</span>(<span class="code-string">"Commande: Allumer LED"</span>);
        <span class="code-function">digitalWrite</span>(ledPin, HIGH);
        <span class="code-keyword">break</span>;
        
      <span class="code-keyword">case</span> <span class="code-string">'e'</span>:
      <span class="code-keyword">case</span> <span class="code-string">'E'</span>:
        Serial.<span class="code-function">println</span>(<span class="code-string">"Commande: Eteindre LED"</span>);
        <span class="code-function">digitalWrite</span>(ledPin, LOW);
        <span class="code-keyword">break</span>;
        
      <span class="code-keyword">case</span> <span class="code-string">'c'</span>:
      <span class="code-keyword">case</span> <span class="code-string">'C'</span>:
        Serial.<span class="code-function">println</span>(<span class="code-string">"Commande: Clignoter LED"</span>);
        <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 5; i++) {
          <span class="code-function">digitalWrite</span>(ledPin, HIGH);
          <span class="code-function">delay</span>(200);
          <span class="code-function">digitalWrite</span>(ledPin, LOW);
          <span class="code-function">delay</span>(200);
        }
        <span class="code-keyword">break</span>;
        
      <span class="code-keyword">case</span> <span class="code-string">'s'</span>:
      <span class="code-keyword">case</span> <span class="code-string">'S'</span>:
        Serial.<span class="code-function">println</span>(<span class="code-string">"Commande: SOS"</span>);
        <span class="code-function">sosSignal</span>();
        <span class="code-keyword">break</span>;
        
      <span class="code-keyword">case</span> <span class="code-string">'q'</span>:
      <span class="code-keyword">case</span> <span class="code-string">'Q'</span>:
        Serial.<span class="code-function">println</span>(<span class="code-string">"Fin du programme"</span>);
        <span class="code-keyword">while</span> (1) { <span class="code-comment">// Boucle infinie pour arr√™ter</span>
          <span class="code-function">delay</span>(1000);
        }
        <span class="code-keyword">break</span>;
        
      <span class="code-keyword">case</span> <span class="code-string">'\n'</span>:
      <span class="code-keyword">case</span> <span class="code-string">'\r'</span>:
        <span class="code-comment">// Ignorer les caract√®res de nouvelle ligne</span>
        <span class="code-keyword">break</span>;
        
      <span class="code-keyword">default</span>:
        Serial.<span class="code-function">println</span>(<span class="code-string">"Commande inconnue"</span>);
        Serial.<span class="code-function">println</span>(<span class="code-string">"Tapez 'h' pour l'aide"</span>);
        <span class="code-keyword">break</span>;
    }
  }
}

<span class="code-keyword">void</span> <span class="code-function">sosSignal</span>() {
  <span class="code-comment">// S (3 courts)</span>
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 3; i++) {
    <span class="code-function">digitalWrite</span>(ledPin, HIGH);
    <span class="code-function">delay</span>(200);
    <span class="code-function">digitalWrite</span>(ledPin, LOW);
    <span class="code-function">delay</span>(200);
  }
  
  <span class="code-comment">// O (3 longs)</span>
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 3; i++) {
    <span class="code-function">digitalWrite</span>(ledPin, HIGH);
    <span class="code-function">delay</span>(600);
    <span class="code-function">digitalWrite</span>(ledPin, LOW);
    <span class="code-function">delay</span>(200);
  }
  
  <span class="code-comment">// S (3 courts)</span>
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 3; i++) {
    <span class="code-function">digitalWrite</span>(ledPin, HIGH);
    <span class="code-function">delay</span>(200);
    <span class="code-function">digitalWrite</span>(ledPin, LOW);
    <span class="code-function">delay</span>(200);
  }
  
  <span class="code-function">delay</span>(1000);
}</code></pre>
        </div>
      </section>

      <!-- =========================================== -->
      <!-- SECTION COMMUNICATION ESP -->
      <!-- =========================================== -->
      <section id="communication">
        <h2>Communication avec ESP32/ESP8266</h2>
        <p>Les modules ESP ajoutent des capacit√©s WiFi et Bluetooth aux projets Arduino.</p>

        <h3 id="wifi">Connexion WiFi (ESP32/ESP8266)</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Connexion WiFi avec ESP32
  N√©cessite la biblioth√®que WiFi.h
*/</span>

<span class="code-keyword">#include</span> &lt;WiFi.h&gt;      <span class="code-comment">// Pour ESP32</span>
<span class="code-comment">// #include &lt;ESP8266WiFi.h&gt; // Pour ESP8266</span>

<span class="code-comment">// Identifiants WiFi</span>
<span class="code-keyword">const</span> <span class="code-type">char</span>* ssid = <span class="code-string">"Votre_SSID"</span>;
<span class="code-keyword">const</span> <span class="code-type">char</span>* password = <span class="code-string">"Votre_Mot_De_Passe"</span>;

<span class="code-comment">// Serveur web sur le port 80</span>
WiFiServer server(80);

<span class="code-comment">// Variable pour stocker la requ√™te HTTP</span>
<span class="code-type">String</span> header;

<span class="code-comment">// Variables pour contr√¥ler la LED</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> ledPin = 2;  <span class="code-comment">// LED int√©gr√©e de l'ESP32</span>
<span class="code-keyword">bool</span> ledState = <span class="code-keyword">false</span>;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(115200);
  
  <span class="code-comment">// Configuration de la LED</span>
  <span class="code-function">pinMode</span>(ledPin, OUTPUT);
  <span class="code-function">digitalWrite</span>(ledPin, LOW);
  
  <span class="code-comment">// Connexion au WiFi</span>
  Serial.<span class="code-function">print</span>(<span class="code-string">"Connexion au WiFi "</span>);
  Serial.<span class="code-function">println</span>(ssid);
  
  WiFi.<span class="code-function">begin</span>(ssid, password);
  
  <span class="code-keyword">while</span> (WiFi.<span class="code-function">status</span>() != WL_CONNECTED) {
    <span class="code-function">delay</span>(500);
    Serial.<span class="code-function">print</span>(<span class="code-string">"."</span>);
  }
  
  <span class="code-comment">// Connexion r√©ussie</span>
  Serial.<span class="code-function">println</span>(<span class="code-string">""</span>);
  Serial.<span class="code-function">println</span>(<span class="code-string">"WiFi connecte!"</span>);
  Serial.<span class="code-function">print</span>(<span class="code-string">"Adresse IP: "</span>);
  Serial.<span class="code-function">println</span>(WiFi.<span class="code-function">localIP</span>());
  
  <span class="code-comment">// D√©marrage du serveur web</span>
  server.<span class="code-function">begin</span>();
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  WiFiClient client = server.<span class="code-function">available</span>();
  
  <span class="code-keyword">if</span> (client) {
    Serial.<span class="code-function">println</span>(<span class="code-string">"Nouveau client"</span>);
    <span class="code-type">String</span> currentLine = <span class="code-string">""</span>;
    
    <span class="code-keyword">while</span> (client.<span class="code-function">connected</span>()) {
      <span class="code-keyword">if</span> (client.<span class="code-function">available</span>()) {
        <span class="code-type">char</span> c = client.<span class="code-function">read</span>();
        Serial.<span class="code-function">write</span>(c);
        header += c;
        
        <span class="code-keyword">if</span> (c == <span class="code-string">'\n'</span>) {
          <span class="code-keyword">if</span> (currentLine.<span class="code-function">length</span>() == 0) {
            <span class="code-comment">// Envoi de la r√©ponse HTTP</span>
            client.<span class="code-function">println</span>(<span class="code-string">"HTTP/1.1 200 OK"</span>);
            client.<span class="code-function">println</span>(<span class="code-string">"Content-type:text/html"</span>);
            client.<span class="code-function">println</span>(<span class="code-string">"Connection: close"</span>);
            client.<span class="code-function">println</span>();
            
            <span class="code-comment">// Page web HTML</span>
            client.<span class="code-function">println</span>(<span class="code-string">"&lt;!DOCTYPE html&gt;&lt;html&gt;"</span>);
            client.<span class="code-function">println</span>(<span class="code-string">"&lt;head&gt;&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;"</span>);
            client.<span class="code-function">println</span>(<span class="code-string">"&lt;title&gt;Controle LED ESP32&lt;/title&gt;"</span>);
            client.<span class="code-function">println</span>(<span class="code-string">"&lt;style&gt;body { font-family: Arial; text-align: center; }"</span>);
            client.<span class="code-function">println</span>(<span class="code-string">".button { background-color: #4CAF50; border: none; color: white;"</span>);
            client.<span class="code-function">println</span>(<span class="code-string">"padding: 16px 40px; text-decoration: none; font-size: 30px; margin: 2px; cursor: pointer; }"</span>);
            client.<span class="code-function">println</span>(<span class="code-string">".button2 { background-color: #f44336; }&lt;/style&gt;&lt;/head&gt;"</span>);
            client.<span class="code-function">println</span>(<span class="code-string">"&lt;body&gt;&lt;h1&gt;Controle LED ESP32&lt;/h1&gt;"</span>);
            
            <span class="code-keyword">if</span> (ledState) {
              client.<span class="code-function">println</span>(<span class="code-string">"&lt;p&gt;Etat LED: ALLUMEE&lt;/p&gt;"</span>);
              client.<span class="code-function">println</span>(<span class="code-string">"&lt;p&gt;&lt;a href=\"/off\"&gt;&lt;button class=\"button button2\"&gt;ETEINDRE&lt;/button&gt;&lt;/a&gt;&lt;/p&gt;"</span>);
            } <span class="code-keyword">else</span> {
              client.<span class="code-function">println</span>(<span class="code-string">"&lt;p&gt;Etat LED: ETEINTE&lt;/p&gt;"</span>);
              client.<span class="code-function">println</span>(<span class="code-string">"&lt;p&gt;&lt;a href=\"/on\"&gt;&lt;button class=\"button\"&gt;ALLUMER&lt;/button&gt;&lt;/a&gt;&lt;/p&gt;"</span>);
            }
            
            client.<span class="code-function">println</span>(<span class="code-string">"&lt;/body&gt;&lt;/html&gt;"</span>);
            client.<span class="code-function">println</span>();
            
            <span class="code-keyword">break</span>;
          } <span class="code-keyword">else</span> {
            currentLine = <span class="code-string">""</span>;
          }
        } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (c != <span class="code-string">'\r'</span>) {
          currentLine += c;
        }
        
        <span class="code-comment">// Traitement des requ√™tes</span>
        <span class="code-keyword">if</span> (currentLine.<span class="code-function">endsWith</span>(<span class="code-string">"GET /on"</span>)) {
          Serial.<span class="code-function">println</span>(<span class="code-string">"Commande: ALLUMER LED"</span>);
          ledState = <span class="code-keyword">true</span>;
          <span class="code-function">digitalWrite</span>(ledPin, HIGH);
        } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (currentLine.<span class="code-function">endsWith</span>(<span class="code-string">"GET /off"</span>)) {
          Serial.<span class="code-function">println</span>(<span class="code-string">"Commande: ETEINDRE LED"</span>);
          ledState = <span class="code-keyword">false</span>;
          <span class="code-function">digitalWrite</span>(ledPin, LOW);
        }
      }
    }
    
    <span class="code-comment">// Nettoyage</span>
    header = <span class="code-string">""</span>;
    client.<span class="code-function">stop</span>();
    Serial.<span class="code-function">println</span>(<span class="code-string">"Client deconnecte"</span>);
    Serial.<span class="code-function">println</span>(<span class="code-string">""</span>);
  }
}</code></pre>
        </div>

      
        <!-- Bluetooth (ESP32) -->
        <section id="bluetooth">
          <h3>Communication Bluetooth avec ESP32</h3>
          <p>L'ESP32 dispose d'un module Bluetooth classique et Bluetooth Low Energy (BLE) int√©gr√©, permettant des
            communications sans fil √† courte port√©e.</p>

          <div class="info-box">
            <p><strong>Note :</strong> Le Bluetooth est disponible seulement sur ESP32, pas sur ESP8266. L'ESP32
              supporte √† la fois Bluetooth classique (SPP) et Bluetooth Low Energy (BLE).</p>
          </div>

          <h4>Bluetooth S√©rie (Classique) - Similaire au Bluetooth HC-05</h4>
          <div class="code-example">
            <h5>Exemple : Communication Bluetooth s√©rie ESP32 vers smartphone</h5>
            <pre><code><span class="code-comment">/*
Communication Bluetooth s√©rie avec ESP32
Cr√©e un port s√©rie virtuel Bluetooth
Compatible avec les apps Serial Bluetooth Terminal
*/</span>

<span class="code-keyword">#include</span> "BluetoothSerial.h"

<span class="code-comment">// V√©rifie si le Bluetooth est disponible</span>
<span class="code-keyword">#if</span> !defined(CONFIG_BT_ENABLED) || !defined(CONFIG_BLUEDROID_ENABLED)
<span class="code-keyword">#error</span> Bluetooth n'est pas disponible! Activez-le dans l'IDE
<span class="code-keyword">#endif</span>

<span class="code-comment">// Objet Bluetooth</span>
BluetoothSerial SerialBT;

<span class="code-comment">// Broches</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 2;  <span class="code-comment">// LED int√©gr√©e ESP32</span>

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
Serial.<span class="code-function">begin</span>(115200);

<span class="code-comment">// Configuration de la LED</span>
<span class="code-function">pinMode</span>(LED_PIN, OUTPUT);
<span class="code-function">digitalWrite</span>(LED_PIN, LOW);

<span class="code-comment">// D√©marrage du Bluetooth</span>
<span class="code-type">String</span> nomBluetooth = <span class="code-string">"ESP32_Controller"</span>;
SerialBT.<span class="code-function">begin</span>(nomBluetooth);  <span class="code-comment">// Nom du p√©riph√©rique Bluetooth</span>

Serial.<span class="code-function">println</span>(<span class="code-string">"Bluetooth demarre!"</span>);
Serial.<span class="code-function">print</span>(<span class="code-string">"Nom du peripherique: "</span>);
Serial.<span class="code-function">println</span>(nomBluetooth);
Serial.<span class="code-function">println</span>(<span class="code-string">"Connectez-vous via Bluetooth et envoyez des commandes:"</span>);
Serial.<span class="code-function">println</span>(<span class="code-string">"  '1' - Allumer LED"</span>);
Serial.<span class="code-function">println</span>(<span class="code-string">"  '0' - Eteindre LED"</span>);
Serial.<span class="code-function">println</span>(<span class="code-string">"  's' - Etat du systeme"</span>);
Serial.<span class="code-function">println</span>(<span class="code-string">"  '?' - Aide"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
<span class="code-comment">// Lecture des donn√©es Bluetooth</span>
<span class="code-keyword">if</span> (SerialBT.<span class="code-function">available</span>()) {
  <span class="code-type">char</span> commande = SerialBT.<span class="code-function">read</span>();
  <span class="code-function">traiterCommande</span>(commande);
}

<span class="code-comment">// Lecture des donn√©es s√©rie USB (pour debug)</span>
<span class="code-keyword">if</span> (Serial.<span class="code-function">available</span>()) {
  <span class="code-type">char</span> commande = Serial.<span class="code-function">read</span>();
  SerialBT.<span class="code-function">write</span>(commande);  <span class="code-comment">// Echo vers Bluetooth</span>
  <span class="code-function">traiterCommande</span>(commande);
}

<span class="code-comment">// Envoi p√©riodique de donn√©es (toutes les 5 secondes)</span>
<span class="code-keyword">static</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierEnvoi = 0;
<span class="code-keyword">if</span> (<span class="code-function">millis</span>() - dernierEnvoi > 5000) {
  dernierEnvoi = <span class="code-function">millis</span>();
  
  <span class="code-comment">// Envoi de donn√©es de t√©l√©m√©trie</span>
  <span class="code-keyword">float</span> temperature = <span class="code-function">lireTemperatureSimulee</span>();
  <span class="code-keyword">int</span> valeurAnalogique = <span class="code-function">analogRead</span>(34);  <span class="code-comment">// GPIO34 (entr√©e seulement)</span>
  
  <span class="code-type">String</span> telemetrie = <span class="code-string">"Telemetrie: Temp="</span> + <span class="code-type">String</span>(temperature, 1) + 
                     <span class="code-string">"C, ADC="</span> + <span class="code-type">String</span>(valeurAnalogique);
  
  SerialBT.<span class="code-function">println</span>(telemetrie);
  Serial.<span class="code-function">println</span>(telemetrie);
}

<span class="code-function">delay</span>(20);
}

<span class="code-keyword">void</span> <span class="code-function">traiterCommande</span>(<span class="code-type">char</span> commande) {
<span class="code-keyword">switch</span> (commande) {
  <span class="code-keyword">case</span> <span class="code-string">'1'</span>:
    <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
    SerialBT.<span class="code-function">println</span>(<span class="code-string">"LED allumee"</span>);
    Serial.<span class="code-function">println</span>(<span class="code-string">"LED allumee via Bluetooth"</span>);
    <span class="code-keyword">break</span>;
    
  <span class="code-keyword">case</span> <span class="code-string">'0'</span>:
    <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
    SerialBT.<span class="code-function">println</span>(<span class="code-string">"LED eteinte"</span>);
    Serial.<span class="code-function">println</span>(<span class="code-string">"LED eteinte via Bluetooth"</span>);
    <span class="code-keyword">break</span>;
    
  <span class="code-keyword">case</span> <span class="code-string">'s'</span>:
    <span class="code-function">envoyerEtatSysteme</span>();
    <span class="code-keyword">break</span>;
    
  <span class="code-keyword">case</span> <span class="code-string">'?'</span>:
    <span class="code-function">envoyerAide</span>();
    <span class="code-keyword">break</span>;
    
  <span class="code-keyword">case</span> <span class="code-string">'b'</span>:
    <span class="code-comment">// Test du bip (clignotement rapide)</span>
    <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < 5; i++) {
      <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
      <span class="code-function">delay</span>(100);
      <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
      <span class="code-function">delay</span>(100);
    }
    SerialBT.<span class="code-function">println</span>(<span class="code-string">"Bip execute"</span>);
    <span class="code-keyword">break</span>;
    
  <span class="code-keyword">default</span>:
    <span class="code-keyword">if</span> (commande != <span class="code-string">'\n'</span> && commande != <span class="code-string">'\r'</span>) {
      SerialBT.<span class="code-function">print</span>(<span class="code-string">"Commande inconnue: '"</span>);
      SerialBT.<span class="code-function">write</span>(commande);
      SerialBT.<span class="code-function">println</span>(<span class="code-string">"'"</span>);
    }
    <span class="code-keyword">break</span>;
}
}

<span class="code-keyword">void</span> <span class="code-function">envoyerEtatSysteme</span>() {
<span class="code-type">String</span> etat = <span class="code-string">"=== Etat du systeme ===\n"</span>;
etat += <span class="code-string">"Uptime: "</span> + <span class="code-type">String</span>(<span class="code-function">millis</span>() / 1000) + <span class="code-string">"s\n"</span>;
etat += <span class="code-string">"LED: "</span> + <span class="code-type">String</span>(<span class="code-function">digitalRead</span>(LED_PIN) ? <span class="code-string">"ALLUMEE"</span> : <span class="code-string">"ETEINTE"</span>) + <span class="code-string">"\n"</span>;
etat += <span class="code-string">"Temperature: "</span> + <span class="code-type">String</span>(<span class="code-function">lireTemperatureSimulee</span>(), 1) + <span class="code-string">"C\n"</span>;
etat += <span class="code-string">"Memoire libre: "</span> + <span class="code-type">String</span>(<span class="code-function">ESP.getFreeHeap</span>()) + <span class="code-string">" bytes"</span>;

SerialBT.<span class="code-function">println</span>(etat);
Serial.<span class="code-function">println</span>(etat);
}

<span class="code-keyword">void</span> <span class="code-function">envoyerAide</span>() {
<span class="code-type">String</span> aide = <span class="code-string">"=== Commandes disponibles ===\n"</span>;
aide += <span class="code-string">"1 - Allumer LED\n"</span>;
aide += <span class="code-string">"0 - Eteindre LED\n"</span>;
aide += <span class="code-string">"s - Etat du systeme\n"</span>;
aide += <span class="code-string">"b - Bip (clignotement)\n"</span>;
aide += <span class="code-string">"? - Aide (ce message)"</span>;

SerialBT.<span class="code-function">println</span>(aide);
}

<span class="code-keyword">float</span> <span class="code-function">lireTemperatureSimulee</span>() {
<span class="code-comment">// Simulation de lecture de temp√©rature</span>
<span class="code-keyword">return</span> 20.0 + (<span class="code-function">sin</span>(<span class="code-function">millis</span>() / 10000.0) * 10.0);
}</code></pre>
          </div>

          <h4>Bluetooth Low Energy (BLE) - Pour applications IoT</h4>
          <div class="code-example">
            <h5>Exemple : Serveur BLE avec caract√©ristiques personnalis√©es</h5>
            <pre><code><span class="code-comment">/*
Serveur BLE ESP32 avec services et caract√©ristiques
Contr√¥le une LED et lit un bouton via BLE
*/</span>

<span class="code-keyword">#include</span> &lt;BLEDevice.h&gt;
<span class="code-keyword">#include</span> &lt;BLEUtils.h&gt;
<span class="code-keyword">#include</span> &lt;BLEServer.h&gt;

<span class="code-comment">// UUIDs pour le service et les caract√©ristiques</span>
<span class="code-keyword">#define</span> SERVICE_UUID        <span class="code-string">"4fafc201-1fb5-459e-8fcc-c5c9c331914b"</span>
<span class="code-keyword">#define</span> CHARACTERISTIC_LED_UUID <span class="code-string">"beb5483e-36e1-4688-b7f5-ea07361b26a8"</span>
<span class="code-keyword">#define</span> CHARACTERISTIC_BOUTON_UUID <span class="code-string">"cba1d466-344c-4be3-ab3f-189f80dd7518"</span>
<span class="code-keyword">#define</span> CHARACTERISTIC_TEMP_UUID <span class="code-string">"d61f4c2e-6b3c-4a9d-bb5c-8c5d7a3e8c1a"</span>

<span class="code-comment">// Broches</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_PIN = 2;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> BOUTON_PIN = 4;

<span class="code-comment">// Variables globales</span>
BLEServer *pServer = <span class="code-keyword">nullptr</span>;
BLECharacteristic *pCharacteristicLED = <span class="code-keyword">nullptr</span>;
BLECharacteristic *pCharacteristicBouton = <span class="code-keyword">nullptr</span>;
BLECharacteristic *pCharacteristicTemp = <span class="code-keyword">nullptr</span>;

<span class="code-keyword">bool</span> deviceConnected = <span class="code-keyword">false</span>;
<span class="code-keyword">bool</span> ancienDeviceConnected = <span class="code-keyword">false</span>;

<span class="code-comment">// Callback pour les √©v√©nements de connexion BLE</span>
<span class="code-keyword">class</span> MyServerCallbacks: <span class="code-keyword">public</span> BLEServerCallbacks {
<span class="code-keyword">void</span> <span class="code-function">onConnect</span>(BLEServer* pServer) {
  deviceConnected = <span class="code-keyword">true</span>;
  Serial.<span class="code-function">println</span>(<span class="code-string">"Device BLE connecte"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">onDisconnect</span>(BLEServer* pServer) {
  deviceConnected = <span class="code-keyword">false</span>;
  Serial.<span class="code-function">println</span>(<span class="code-string">"Device BLE deconnecte"</span>);
  <span class="code-comment">// Red√©marrage de l'annonce pour permettre une reconnexion</span>
  pServer-&gt;<span class="code-function">getAdvertising</span>()-&gt;<span class="code-function">start</span>();
}
};

<span class="code-comment">// Callback pour les √©critures sur la caract√©ristique LED</span>
<span class="code-keyword">class</span> LEDCharacteristicCallbacks: <span class="code-keyword">public</span> BLECharacteristicCallbacks {
<span class="code-keyword">void</span> <span class="code-function">onWrite</span>(BLECharacteristic *pCharacteristic) {
  <span class="code-type">std::string</span> value = pCharacteristic-&gt;<span class="code-function">getValue</span>();
  
  <span class="code-keyword">if</span> (value.<span class="code-function">length</span>() > 0) {
    <span class="code-type">char</span> commande = value[0];
    
    <span class="code-keyword">switch</span> (commande) {
      <span class="code-keyword">case</span> <span class="code-string">'1'</span>:
        <span class="code-function">digitalWrite</span>(LED_PIN, HIGH);
        Serial.<span class="code-function">println</span>(<span class="code-string">"LED allumee via BLE"</span>);
        <span class="code-keyword">break</span>;
        
      <span class="code-keyword">case</span> <span class="code-string">'0'</span>:
        <span class="code-function">digitalWrite</span>(LED_PIN, LOW);
        Serial.<span class="code-function">println</span>(<span class="code-string">"LED eteinte via BLE"</span>);
        <span class="code-keyword">break</span>;
        
      <span class="code-keyword">default</span>:
        Serial.<span class="code-function">print</span>(<span class="code-string">"Commande BLE inconnue: "</span>);
        Serial.<span class="code-function">println</span>(commande);
        <span class="code-keyword">break</span>;
    }
  }
}
};

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
Serial.<span class="code-function">begin</span>(115200);

<span class="code-comment">// Configuration des broches</span>
<span class="code-function">pinMode</span>(LED_PIN, OUTPUT);
<span class="code-function">pinMode</span>(BOUTON_PIN, INPUT_PULLUP);
<span class="code-function">digitalWrite</span>(LED_PIN, LOW);

Serial.<span class="code-function">println</span>(<span class="code-string">"Demarrage serveur BLE..."</span>);

<span class="code-comment">// Initialisation BLE</span>
BLEDevice::<span class="code-function">init</span>(<span class="code-string">"ESP32_BLE_Server"</span>);

<span class="code-comment">// Cr√©ation du serveur BLE</span>
pServer = BLEDevice::<span class="code-function">createServer</span>();
pServer-&gt;<span class="code-function">setCallbacks</span>(<span class="code-keyword">new</span> MyServerCallbacks());

<span class="code-comment">// Cr√©ation du service BLE</span>
BLEService *pService = pServer-&gt;<span class="code-function">createService</span>(SERVICE_UUID);

<span class="code-comment">// Cr√©ation de la caract√©ristique LED (lecture/√©criture)</span>
pCharacteristicLED = pService-&gt;<span class="code-function">createCharacteristic</span>(
  CHARACTERISTIC_LED_UUID,
  BLECharacteristic::PROPERTY_READ |
  BLECharacteristic::PROPERTY_WRITE
);
pCharacteristicLED-&gt;<span class="code-function">setCallbacks</span>(<span class="code-keyword">new</span> LEDCharacteristicCallbacks());
pCharacteristicLED-&gt;<span class="code-function">setValue</span>(<span class="code-string">"LED: 0"</span>);

<span class="code-comment">// Cr√©ation de la caract√©ristique bouton (notify)</span>
pCharacteristicBouton = pService-&gt;<span class="code-function">createCharacteristic</span>(
  CHARACTERISTIC_BOUTON_UUID,
  BLECharacteristic::PROPERTY_READ |
  BLECharacteristic::PROPERTY_NOTIFY
);
pCharacteristicBouton-&gt;<span class="code-function">setValue</span>(<span class="code-string">"0"</span>);

<span class="code-comment">// Cr√©ation de la caract√©ristique temp√©rature (notify)</span>
pCharacteristicTemp = pService-&gt;<span class="code-function">createCharacteristic</span>(
  CHARACTERISTIC_TEMP_UUID,
  BLECharacteristic::PROPERTY_READ |
  BLECharacteristic::PROPERTY_NOTIFY
);
pCharacteristicTemp-&gt;<span class="code-function">setValue</span>(<span class="code-string">"20.0"</span>);

<span class="code-comment">// D√©marrage du service</span>
pService-&gt;<span class="code-function">start</span>();

<span class="code-comment">// D√©marrage de l'annonce BLE</span>
BLEAdvertising *pAdvertising = BLEDevice::<span class="code-function">getAdvertising</span>();
pAdvertising-&gt;<span class="code-function">addServiceUUID</span>(SERVICE_UUID);
pAdvertising-&gt;<span class="code-function">setScanResponse</span>(<span class="code-keyword">true</span>);
pAdvertising-&gt;<span class="code-function">setMinPreferred</span>(0x06);  <span class="code-comment">// Utile pour les connexions iPhone</span>
pAdvertising-&gt;<span class="code-function">setMinPreferred</span>(0x12);
BLEDevice::<span class="code-function">startAdvertising</span>();

Serial.<span class="code-function">println</span>(<span class="code-string">"Serveur BLE pret! Nom: ESP32_BLE_Server"</span>);
Serial.<span class="code-function">println</span>(<span class="code-string">"Connectez-vous avec une app BLE (ex: nRF Connect)"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
<span class="code-comment">// Gestion des connexions/d√©connexions</span>
<span class="code-keyword">if</span> (!deviceConnected && ancienDeviceConnected) {
  <span class="code-function">delay</span>(500);  <span class="code-comment">// D√©lai pour la pile Bluetooth</span>
  pServer-&gt;<span class="code-function">startAdvertising</span>();
  Serial.<span class="code-function">println</span>(<span class="code-string">"Annonce BLE redemarree"</span>);
  ancienDeviceConnected = deviceConnected;
}

<span class="code-keyword">if</span> (deviceConnected && !ancienDeviceConnected) {
  ancienDeviceConnected = deviceConnected;
}

<span class="code-keyword">static</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierUpdate = 0;
<span class="code-keyword">if</span> (deviceConnected && (<span class="code-function">millis</span>() - dernierUpdate > 1000)) {
  dernierUpdate = <span class="code-function">millis</span>();
  
  <span class="code-comment">// Mise √† jour de l'√©tat du bouton</span>
  <span class="code-keyword">int</span> etatBouton = <span class="code-function">digitalRead</span>(BOUTON_PIN);
  <span class="code-type">String</span> valeurBouton = <span class="code-type">String</span>(etatBouton);
  pCharacteristicBouton-&gt;<span class="code-function">setValue</span>(valeurBouton.<span class="code-function">c_str</span>());
  pCharacteristicBouton-&gt;<span class="code-function">notify</span>();
  
  <span class="code-comment">// Mise √† jour de la temp√©rature simul√©e</span>
  <span class="code-keyword">float</span> temperature = <span class="code-function">lireTemperatureSimulee</span>();
  <span class="code-type">String</span> valeurTemp = <span class="code-type">String</span>(temperature, 1);
  pCharacteristicTemp-&gt;<span class="code-function">setValue</span>(valeurTemp.<span class="code-function">c_str</span>());
  pCharacteristicTemp-&gt;<span class="code-function">notify</span>();
  
  <span class="code-comment">// Mise √† jour de l'√©tat LED</span>
  <span class="code-keyword">int</span> etatLED = <span class="code-function">digitalRead</span>(LED_PIN);
  <span class="code-type">String</span> valeurLED = <span class="code-string">"LED: "</span> + <span class="code-type">String</span>(etatLED);
  pCharacteristicLED-&gt;<span class="code-function">setValue</span>(valeurLED.<span class="code-function">c_str</span>());
  
  <span class="code-keyword">if</span> (Serial.<span class="code-function">availableForWrite</span>()) {
    Serial.<span class="code-function">print</span>(<span class="code-string">"Bouton: "</span>);
    Serial.<span class="code-function">print</span>(valeurBouton);
    Serial.<span class="code-function">print</span>(<span class="code-string">" | Temp: "</span>);
    Serial.<span class="code-function">print</span>(valeurTemp);
    Serial.<span class="code-function">print</span>(<span class="code-string">"C | LED: "</span>);
    Serial.<span class="code-function">println</span>(etatLED);
  }
}

<span class="code-function">delay</span>(10);
}

<span class="code-keyword">float</span> <span class="code-function">lireTemperatureSimulee</span>() {
<span class="code-comment">// Simulation de temp√©rature</span>
<span class="code-keyword">static</span> <span class="code-keyword">float</span> temp = 20.0;
temp += (<span class="code-function">random</span>(-10, 11) / 10.0);  <span class="code-comment">// Variation al√©atoire</span>
temp = <span class="code-function">constrain</span>(temp, 15.0, 35.0);  <span class="code-comment">// Limites r√©alistes</span>
<span class="code-keyword">return</span> temp;
}</code></pre>
          </div>
        </section>
        <h3 id="mqtt">Communication MQTT (Internet des Objets)</h3>
        <div class="info-box">
          <h4>Explication du Code MQTT ESP</h4>
          <p>Ce code impl√©mente un <strong>client MQTT complet</strong> sur ESP32/ESP8266 pour l'Internet des Objets (IoT).</p>
          
          <h5>Qu'est-ce que MQTT ?</h5>
          <p><strong>MQTT (Message Queuing Telemetry Transport)</strong> est un protocole de messagerie l√©ger con√ßu pour les appareils IoT. Il fonctionne sur le mod√®le <strong>publish/subscribe</strong> :</p>
          <ul>
              <li><strong>Broker</strong> : Serveur central qui g√®re les messages (ex: broker.hivemq.com)</li>
              <li><strong>Publisher</strong> : Envoie des messages sur des "topics"</li>
              <li><strong>Subscriber</strong> : Re√ßoit des messages des topics auxquels il est abonn√©</li>
          </ul>
          
          <h5>Architecture du code :</h5>
          <ol>
              <li><strong>Connexion WiFi</strong> : L'ESP se connecte d'abord au r√©seau</li>
              <li><strong>Connexion MQTT</strong> : √âtablit une connexion avec le broker MQTT public</li>
              <li><strong>Abonnement</strong> : S'abonne aux topics pour recevoir des commandes</li>
              <li><strong>Publication</strong> : Envoie p√©riodiquement des donn√©es (temp√©rature)</li>
              <li><strong>Callback</strong> : Traite les messages re√ßus via une fonction callback</li>
          </ol>
          
          <h5>Topics utilis√©s :</h5>
          <ul>
              <li><code>maison/salon/temperature</code> ‚Üí Publication des donn√©es de temp√©rature</li>
              <li><code>maison/salon/led/commande</code> ‚Üí R√©ception des commandes pour la LED</li>
              <li><code>maison/salon/led/etat</code> ‚Üí Publication de l'√©tat de la LED</li>
          </ul>
          
          <h5>Fonctionnement en d√©tail :</h5>
          
          <div class="code-example" style="margin: 1rem 0; padding: 1rem;">
              <h6>1. Setup MQTT</h6>
              <pre style="margin: 0; font-size: 0.9rem;">client.setServer(mqtt_server, mqtt_port);
      client.setCallback(callback);</pre>
              <p style="margin-top: 0.5rem;">Configure le broker et la fonction de callback pour traiter les messages re√ßus.</p>
          </div>
          
          <div class="code-example" style="margin: 1rem 0; padding: 1rem;">
              <h6>2. Fonction Callback</h6>
              <pre style="margin: 0; font-size: 0.9rem;">void callback(char* topic, byte* payload, unsigned int length) {
        // Traite les messages re√ßus
      }</pre>
              <p style="margin-top: 0.5rem;">Appel√©e automatiquement quand un message arrive sur un topic auquel on est abonn√©.</p>
          </div>
          
          <div class="code-example" style="margin: 1rem 0; padding: 1rem;">
              <h6>3. Publication de donn√©es</h6>
              <pre style="margin: 0; font-size: 0.9rem;">client.publish(topic_temperature, tempString);</pre>
              <p style="margin-top: 0.5rem;">Envoie les donn√©es de temp√©rature toutes les 5 secondes.</p>
          </div>
          
          <div class="code-example" style="margin: 1rem 0; padding: 1rem;">
              <h6>4. Abonnement aux topics</h6>
              <pre style="margin: 0; font-size: 0.9rem;">client.subscribe(topic_led);</pre>
              <p style="margin-top: 0.5rem;">S'abonne au topic des commandes LED pour pouvoir les recevoir.</p>
          </div>
          
          <h5>Avantages de MQTT pour l'IoT :</h5>
          <ul>
              <li><strong>L√©ger</strong> : Peu de consommation de m√©moire et bande passante</li>
              <li><strong>Asynchrone</strong> : Les appareils peuvent publier/s'abonner ind√©pendamment</li>
              <li><strong>Scalable</strong> : Supporte des milliers de clients connect√©s</li>
              <li><strong>Fiabilit√©</strong> : Niveaux de qualit√© de service (QoS) garantissant la livraison</li>
              <li><strong>S√©curit√©</strong> : Supporte l'authentification et le chiffrement</li>
          </ul>
          
          <h5>Cas d'usage typiques :</h5>
          <ul>
              <li><strong>Domotique</strong> : Contr√¥le √† distance des appareils</li>
              <li><strong>Monitoring</strong> : Surveillance de capteurs environnementaux</li>
              <li><strong>T√©l√©m√©trie</strong> : Collecte de donn√©es √† partir de plusieurs sources</li>
              <li><strong>Notifications</strong> : Alertes et notifications en temps r√©el</li>
          </ul>
          
          <div class="warning-box">
              <p><strong>Points importants :</strong></p>
              <ul>
                  <li>Le broker MQTT peut √™tre local (Mosquitto) ou cloud (HiveMQ, AWS IoT)</li>
                  <li>Les topics sont hi√©rarchiques (ex: <code>maison/etage1/salon/temperature</code>)</li>
                  <li>MQTT maintient une connexion persistante avec le broker</li>
                  <li>Parfait pour les connexions intermittentes ou √† faible bande passante</li>
              </ul>
          </div>
          
          <p>Avec ce code, l'ESP32 devient un <strong>n≈ìud IoT intelligent</strong> qui peut envoyer des donn√©es au cloud et recevoir des commandes √† distance, ouvrant la porte √† des applications domotiques et industrielles avanc√©es.</p>
      </div>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Client MQTT avec ESP32
  Publie la temp√©rature et re√ßoit des commandes
  N√©cessite la biblioth√®que PubSubClient
*/</span>

<span class="code-keyword">#include</span> &lt;WiFi.h&gt;
<span class="code-keyword">#include</span> &lt;PubSubClient.h&gt;

<span class="code-comment">// Configuration WiFi</span>
<span class="code-keyword">const</span> <span class="code-type">char</span>* ssid = <span class="code-string">"Votre_SSID"</span>;
<span class="code-keyword">const</span> <span class="code-type">char</span>* password = <span class="code-string">"Votre_Mot_De_Passe"</span>;

<span class="code-comment">// Configuration MQTT</span>
<span class="code-keyword">const</span> <span class="code-type">char</span>* mqtt_server = <span class="code-string">"broker.hivemq.com"</span>;  <span class="code-comment">// Broker public gratuit</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> mqtt_port = 1883;
<span class="code-keyword">const</span> <span class="code-type">char</span>* mqtt_client_id = <span class="code-string">"ESP32_Client_01"</span>;

<span class="code-comment">// Topics MQTT</span>
<span class="code-keyword">const</span> <span class="code-type">char</span>* topic_temperature = <span class="code-string">"maison/salon/temperature"</span>;
<span class="code-keyword">const</span> <span class="code-type">char</span>* topic_led = <span class="code-string">"maison/salon/led/commande"</span>;
<span class="code-keyword">const</span> <span class="code-type">char</span>* topic_led_status = <span class="code-string">"maison/salon/led/etat"</span>;

<span class="code-comment">// Broches</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> ledPin = 2;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> sensorPin = 34;  <span class="code-comment">// Broche ADC pour capteur simul√©</span>

<span class="code-comment">// Objets</span>
WiFiClient espClient;
PubSubClient client(espClient);

<span class="code-comment">// Variables</span>
<span class="code-keyword">bool</span> ledState = <span class="code-keyword">false</span>;
<span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> lastMsg = 0;

<span class="code-comment">// Connexion WiFi</span>
<span class="code-keyword">void</span> <span class="code-function">setup_wifi</span>() {
  <span class="code-function">delay</span>(10);
  Serial.<span class="code-function">println</span>();
  Serial.<span class="code-function">print</span>(<span class="code-string">"Connexion au WiFi: "</span>);
  Serial.<span class="code-function">println</span>(ssid);
  
  WiFi.<span class="code-function">begin</span>(ssid, password);
  
  <span class="code-keyword">while</span> (WiFi.<span class="code-function">status</span>() != WL_CONNECTED) {
    <span class="code-function">delay</span>(500);
    Serial.<span class="code-function">print</span>(<span class="code-string">"."</span>);
  }
  
  Serial.<span class="code-function">println</span>(<span class="code-string">""</span>);
  Serial.<span class="code-function">println</span>(<span class="code-string">"WiFi connecte"</span>);
  Serial.<span class="code-function">print</span>(<span class="code-string">"Adresse IP: "</span>);
  Serial.<span class="code-function">println</span>(WiFi.<span class="code-function">localIP</span>());
}

<span class="code-comment">// Callback pour les messages MQTT re√ßus</span>
<span class="code-keyword">void</span> <span class="code-function">callback</span>(<span class="code-type">char</span>* topic, <span class="code-type">byte</span>* payload, <span class="code-keyword">unsigned</span> <span class="code-keyword">int</span> length) {
  Serial.<span class="code-function">print</span>(<span class="code-string">"Message recu sur le topic: "</span>);
  Serial.<span class="code-function">println</span>(topic);
  
  <span class="code-comment">// Conversion du payload en String</span>
  <span class="code-type">String</span> message;
  <span class="code-keyword">for</span> (<span class="code-keyword">int</span> i = 0; i < length; i++) {
    message += (<span class="code-type">char</span>)payload[i];
  }
  Serial.<span class="code-function">print</span>(<span class="code-string">"Message: "</span>);
  Serial.<span class="code-function">println</span>(message);
  
  <span class="code-comment">// Traitement selon le topic</span>
  <span class="code-keyword">if</span> (<span class="code-function">strcmp</span>(topic, topic_led) == 0) {
    <span class="code-keyword">if</span> (message == <span class="code-string">"ON"</span>) {
      ledState = <span class="code-keyword">true</span>;
      <span class="code-function">digitalWrite</span>(ledPin, HIGH);
      client.<span class="code-function">publish</span>(topic_led_status, <span class="code-string">"LED ON"</span>);
      Serial.<span class="code-function">println</span>(<span class="code-string">"LED allumee"</span>);
    } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (message == <span class="code-string">"OFF"</span>) {
      ledState = <span class="code-keyword">false</span>;
      <span class="code-function">digitalWrite</span>(ledPin, LOW);
      client.<span class="code-function">publish</span>(topic_led_status, <span class="code-string">"LED OFF"</span>);
      Serial.<span class="code-function">println</span>(<span class="code-string">"LED eteinte"</span>);
    }
  }
}

<span class="code-comment">// Reconnexion MQTT</span>
<span class="code-keyword">void</span> <span class="code-function">reconnect</span>() {
  <span class="code-keyword">while</span> (!client.<span class="code-function">connected</span>()) {
    Serial.<span class="code-function">print</span>(<span class="code-string">"Connexion au broker MQTT..."</span>);
    
    <span class="code-keyword">if</span> (client.<span class="code-function">connect</span>(mqtt_client_id)) {
      Serial.<span class="code-function">println</span>(<span class="code-string">"connecte"</span>);
      
      <span class="code-comment">// Abonnement aux topics</span>
      client.<span class="code-function">subscribe</span>(topic_led);
      Serial.<span class="code-function">print</span>(<span class="code-string">"Abonne au topic: "</span>);
      Serial.<span class="code-function">println</span>(topic_led);
      
      <span class="code-comment">// Publication d'un message de connexion</span>
      client.<span class="code-function">publish</span>(topic_led_status, <span class="code-string">"ESP32 connecte"</span>);
    } <span class="code-keyword">else</span> {
      Serial.<span class="code-function">print</span>(<span class="code-string">"echec, rc="</span>);
      Serial.<span class="code-function">print</span>(client.<span class="code-function">state</span>());
      Serial.<span class="code-function">println</span>(<span class="code-string">" nouvel essai dans 5 secondes"</span>);
      <span class="code-function">delay</span>(5000);
    }
  }
}

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(115200);
  
  <span class="code-comment">// Configuration des broches</span>
  <span class="code-function">pinMode</span>(ledPin, OUTPUT);
  <span class="code-function">digitalWrite</span>(ledPin, LOW);
  
  <span class="code-comment">// Connexion WiFi</span>
  <span class="code-function">setup_wifi</span>();
  
  <span class="code-comment">// Configuration MQTT</span>
  client.<span class="code-function">setServer</span>(mqtt_server, mqtt_port);
  client.<span class="code-function">setCallback</span>(callback);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-keyword">if</span> (!client.<span class="code-function">connected</span>()) {
    <span class="code-function">reconnect</span>();
  }
  client.<span class="code-function">loop</span>();
  
  <span class="code-comment">// Publication p√©riodique de la temp√©rature (simul√©e)</span>
  <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> now = <span class="code-function">millis</span>();
  <span class="code-keyword">if</span> (now - lastMsg > 5000) {
    lastMsg = now;
    
    <span class="code-comment">// Lecture de la temp√©rature simul√©e (20-30¬∞C)</span>
    <span class="code-keyword">int</span> sensorValue = <span class="code-function">analogRead</span>(sensorPin);
    <span class="code-keyword">float</span> temperature = 20.0 + (sensorValue / 4095.0) * 10.0;
    
    <span class="code-comment">// Conversion en String</span>
    <span class="code-type">char</span> tempString[8];
    <span class="code-function">dtostrf</span>(temperature, 1, 2, tempString);
    
    <span class="code-comment">// Publication</span>
    Serial.<span class="code-function">print</span>(<span class="code-string">"Temperature: "</span>);
    Serial.<span class="code-function">print</span>(tempString);
    Serial.<span class="code-function">println</span>(<span class="code-string">"¬∞C"</span>);
    
    client.<span class="code-function">publish</span>(topic_temperature, tempString);
  }
}</code></pre>
        </div>

        <!-- Serveur Web ESP -->
        <section id="web-server">
          <h3>Serveur Web sur ESP32/ESP8266</h3>
          <p>Les modules ESP peuvent h√©berger des pages web pour contr√¥ler et surveiller des dispositifs via un
            navigateur.</p>

          <h4>Serveur Web de base avec API REST</h4>
          <div class="info-box">
            <h4>Architecture du Serveur Web ESP</h4>
            <p>Ce code cr√©e un <strong>serveur web complet</strong> sur ESP32/ESP8266 permettant de contr√¥ler des LEDs et lire des capteurs √† distance via un navigateur web.</p>
            
            <h5>Fonctionnement principal :</h5>
            <ol>
                <li><strong>Connexion WiFi</strong> : L'ESP se connecte au r√©seau et obtient une adresse IP accessible depuis n'importe quel navigateur</li>
                <li><strong>Serveur HTTP</strong> : √âcoute sur le port 80 et g√®re les requ√™tes HTTP entrantes</li>
                <li><strong>API REST</strong> : Fournit des endpoints JSON pour la communication programme-programme</li>
                <li><strong>Interface Web</strong> : G√©n√®re dynamiquement une page HTML avec JavaScript pour l'interaction utilisateur</li>
            </ol>
            
            <h5>Routes principales :</h5>
            <ul>
                <li><code>/</code> ‚Üí Page d'accueil HTML compl√®te avec interface de contr√¥le</li>
                <li><code>/api/etat</code> ‚Üí Retourne l'√©tat des LEDs au format JSON</li>
                <li><code>/api/led/[couleur]</code> ‚Üí Contr√¥le une LED sp√©cifique (POST)</li>
                <li><code>/api/capteurs</code> ‚Üí Lit les valeurs des capteurs (JSON)</li>
                <li><code>/api/leds</code> ‚Üí Contr√¥le toutes les LEDs simultan√©ment</li>
            </ul>
            
            <h5>Caract√©ristiques avanc√©es :</h5>
            <ul>
                <li><strong>HTML g√©n√©r√© dynamiquement</strong> : La page web est construite directement dans le code C++</li>
                <li><strong>JavaScript int√©gr√©</strong> : G√®re les interactions utilisateur et les appels AJAX</li>
                <li><strong>Communication bidirectionnelle</strong> : L'utilisateur contr√¥le les LEDs et re√ßoit des donn√©es des capteurs</li>
                <li><strong>Interface responsive</strong> : S'adapte aux mobiles et ordinateurs</li>
                <li><strong>Actualisation automatique</strong> : Les donn√©es des capteurs se mettent √† jour toutes les 2 secondes</li>
            </ul>
            
            <div class="warning-box">
                <p><strong>Points cl√©s √† retenir :</strong></p>
                <ul>
                    <li>L'ESP32 peut h√©berger un site web sans connexion Internet</li>
                    <li>La communication se fait via le r√©seau WiFi local</li>
                    <li>Le code m√©lange HTML, CSS, JavaScript et C++ dans un seul programme</li>
                    <li>Id√©al pour les interfaces de contr√¥le domotique et IoT</li>
                </ul>
            </div>
        </div>
          <div class="code-example">
            <h5>Exemple : Serveur web avec API REST pour contr√¥ler des LEDs</h5>
            <pre><code><span class="code-comment">/*
Serveur web ESP32 avec API REST
Contr√¥le de LEDs et lecture de capteurs via HTTP
*/</span>

<span class="code-keyword">#include</span> &lt;WiFi.h&gt;
<span class="code-keyword">#include</span> &lt;WebServer.h&gt;

<span class="code-comment">// Identifiants WiFi</span>
<span class="code-keyword">const</span> <span class="code-type">char</span>* ssid = <span class="code-string">"Votre_SSID"</span>;
<span class="code-keyword">const</span> <span class="code-type">char</span>* password = <span class="code-string">"Votre_Mot_De_Passe"</span>;

<span class="code-comment">// Broches</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_ROUGE = 25;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_VERTE = 26;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> LED_BLEUE = 27;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> BOUTON_PIN = 34;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> POT_PIN = 35;

<span class="code-comment">// Variables d'√©tat</span>
<span class="code-keyword">bool</span> ledRougeEtat = <span class="code-keyword">false</span>;
<span class="code-keyword">bool</span> ledVerteEtat = <span class="code-keyword">false</span>;
<span class="code-keyword">bool</span> ledBleueEtat = <span class="code-keyword">false</span>;

<span class="code-comment">// Serveur web sur le port 80</span>
WebServer server(80);

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
Serial.<span class="code-function">begin</span>(115200);

<span class="code-comment">// Configuration des broches</span>
<span class="code-function">pinMode</span>(LED_ROUGE, OUTPUT);
<span class="code-function">pinMode</span>(LED_VERTE, OUTPUT);
<span class="code-function">pinMode</span>(LED_BLEUE, OUTPUT);
<span class="code-function">pinMode</span>(BOUTON_PIN, INPUT);

<span class="code-function">digitalWrite</span>(LED_ROUGE, LOW);
<span class="code-function">digitalWrite</span>(LED_VERTE, LOW);
<span class="code-function">digitalWrite</span>(LED_BLEUE, LOW);

<span class="code-comment">// Connexion WiFi</span>
WiFi.<span class="code-function">begin</span>(ssid, password);
Serial.<span class="code-function">print</span>(<span class="code-string">"Connexion au WiFi..."</span>);

<span class="code-keyword">while</span> (WiFi.<span class="code-function">status</span>() != WL_CONNECTED) {
  <span class="code-function">delay</span>(500);
  Serial.<span class="code-function">print</span>(<span class="code-string">"."</span>);
}

Serial.<span class="code-function">println</span>();
Serial.<span class="code-function">print</span>(<span class="code-string">"Connecte! Adresse IP: "</span>);
Serial.<span class="code-function">println</span>(WiFi.<span class="code-function">localIP</span>());

<span class="code-comment">// Configuration des routes HTTP</span>
<span class="code-function">configurerRoutes</span>();

<span class="code-comment">// D√©marrage du serveur</span>
server.<span class="code-function">begin</span>();
Serial.<span class="code-function">println</span>(<span class="code-string">"Serveur HTTP demarre!"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
server.<span class="code-function">handleClient</span>();
<span class="code-function">delay</span>(2);  <span class="code-comment">// Permet au CPU de respirer</span>
}

<span class="code-keyword">void</span> <span class="code-function">configurerRoutes</span>() {
<span class="code-comment">// Page d'accueil</span>
server.<span class="code-function">on</span>(<span class="code-string">"/"</span>, HTTP_GET, []() {
  <span class="code-function">envoyerPageAccueil</span>();
});

<span class="code-comment">// API : √âtat du syst√®me</span>
server.<span class="code-function">on</span>(<span class="code-string">"/api/etat"</span>, HTTP_GET, []() {
  <span class="code-function">envoyerJSONEtat</span>();
});

<span class="code-comment">// API : Contr√¥le LED rouge</span>
server.<span class="code-function">on</span>(<span class="code-string">"/api/led/rouge"</span>, HTTP_POST, []() {
  <span class="code-function">controlerLED</span>(LED_ROUGE, ledRougeEtat);
  server.<span class="code-function">send</span>(200, <span class="code-string">"application/json"</span>, <span class="code-string">"{\"status\":\"OK\",\"led\":\"rouge\",\"etat\":"</span> + <span class="code-type">String</span>(ledRougeEtat) + <span class="code-string">"}"</span>);
});

<span class="code-comment">// API : Contr√¥le LED verte</span>
server.<span class="code-function">on</span>(<span class="code-string">"/api/led/verte"</span>, HTTP_POST, []() {
  <span class="code-function">controlerLED</span>(LED_VERTE, ledVerteEtat);
  server.<span class="code-function">send</span>(200, <span class="code-string">"application/json"</span>, <span class="code-string">"{\"status\":\"OK\",\"led\":\"verte\",\"etat\":"</span> + <span class="code-type">String</span>(ledVerteEtat) + <span class="code-string">"}"</span>);
});

<span class="code-comment">// API : Contr√¥le LED bleue</span>
server.<span class="code-function">on</span>(<span class="code-string">"/api/led/bleue"</span>, HTTP_POST, []() {
  <span class="code-function">controlerLED</span>(LED_BLEUE, ledBleueEtat);
  server.<span class="code-function">send</span>(200, <span class="code-string">"application/json"</span>, <span class="code-string">"{\"status\":\"OK\",\"led\":\"bleue\",\"etat\":"</span> + <span class="code-type">String</span>(ledBleueEtat) + <span class="code-string">"}"</span>);
});

<span class="code-comment">// API : Lecture capteurs</span>
server.<span class="code-function">on</span>(<span class="code-string">"/api/capteurs"</span>, HTTP_GET, []() {
  <span class="code-function">envoyerJSONCapteurs</span>();
});

<span class="code-comment">// API : Contr√¥le toutes les LEDs</span>
server.<span class="code-function">on</span>(<span class="code-string">"/api/leds"</span>, HTTP_POST, []() {
  <span class="code-keyword">if</span> (server.<span class="code-function">hasArg</span>(<span class="code-string">"plain"</span>)) {
    <span class="code-type">String</span> body = server.<span class="code-function">arg</span>(<span class="code-string">"plain"</span>);
    <span class="code-function">traiterControleLEDs</span>(body);
  }
  server.<span class="code-function">send</span>(200, <span class="code-string">"application/json"</span>, <span class="code-string">"{\"status\":\"OK\"}"</span>);
});

<span class="code-comment">// Route 404 (non trouv√©e)</span>
server.<span class="code-function">onNotFound</span>([]() {
  server.<span class="code-function">send</span>(404, <span class="code-string">"text/plain"</span>, <span class="code-string">"404: Page non trouvee"</span>);
});
}

<span class="code-keyword">void</span> <span class="code-function">controlerLED</span>(<span class="code-keyword">int</span> pin, <span class="code-keyword">bool</span> &etat) {
etat = !etat;
<span class="code-function">digitalWrite</span>(pin, etat ? HIGH : LOW);
Serial.<span class="code-function">print</span>(<span class="code-string">"LED "</span>);
Serial.<span class="code-function">print</span>(pin);
Serial.<span class="code-function">print</span>(<span class="code-string">" : "</span>);
Serial.<span class="code-function">println</span>(etat ? <span class="code-string">"ON"</span> : <span class="code-string">"OFF"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">envoyerPageAccueil</span>() {
<span class="code-type">String</span> html = <span class="code-string">"&lt;!DOCTYPE html&gt;\n"</span>;
html += <span class="code-string">"&lt;html lang='fr'&gt;\n"</span>;
html += <span class="code-string">"&lt;head&gt;\n"</span>;
html += <span class="code-string">"  &lt;meta charset='UTF-8'&gt;\n"</span>;
html += <span class="code-string">"  &lt;meta name='viewport' content='width=device-width, initial-scale=1'&gt;\n"</span>;
html += <span class="code-string">"  &lt;title&gt;Controle ESP32&lt;/title&gt;\n"</span>;
html += <span class="code-string">"  &lt;style&gt;\n"</span>;
html += <span class="code-string">"    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }\n"</span>;
html += <span class="code-string">"    h1 { color: #333; }\n"</span>;
html += <span class="code-string">"    .led-control { margin: 20px 0; }\n"</span>;
html += <span class="code-string">"    .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }\n"</span>;
html += <span class="code-string">"    .btn-rouge { background-color: #ff4444; color: white; }\n"</span>;
html += <span class="code-string">"    .btn-vert { background-color: #44ff44; color: black; }\n"</span>;
html += <span class="code-string">"    .btn-bleu { background-color: #4444ff; color: white; }\n"</span>;
html += <span class="code-string">"    .btn-tout { background-color: #333; color: white; }\n"</span>;
html += <span class="code-string">"    .status { padding: 10px; margin: 10px 0; border-radius: 5px; }\n"</span>;
html += <span class="code-string">"    .status-on { background-color: #d4edda; border: 1px solid #c3e6cb; }\n"</span>;
html += <span class="code-string">"    .status-off { background-color: #f8d7da; border: 1px solid #f5c6cb; }\n"</span>;
html += <span class="code-string">"    .sensors { background-color: #e9ecef; padding: 15px; border-radius: 5px; margin: 20px 0; }\n"</span>;
html += <span class="code-string">"  &lt;/style&gt;\n"</span>;
html += <span class="code-string">"  &lt;script&gt;\n"</span>;
html += <span class="code-string">"    function controlerLED(couleur) {\n"</span>;
html += <span class="code-string">"      fetch('/api/led/' + couleur, { method: 'POST' })\n"</span>;
html += <span class="code-string">"        .then(response =&gt; response.json())\n"</span>;
html += <span class="code-string">"        .then(data =&gt; {\n"</span>;
html += <span class="code-string">"          document.getElementById('status-' + couleur).innerHTML = \n"</span>;
html += <span class="code-string">"            'LED ' + couleur.toUpperCase() + ': ' + (data.etat ? 'ALLUMEE' : 'ETEINTE');\n"</span>;
html += <span class="code-string">"          document.getElementById('status-' + couleur).className = \n"</span>;
html += <span class="code-string">"            'status ' + (data.etat ? 'status-on' : 'status-off');\n"</span>;
html += <span class="code-string">"        });\n"</span>;
html += <span class="code-string">"    }\n"</span>;
html += <span class="code-string">"    \n"</span>;
html += <span class="code-string">"    function controlerToutesLEDs(action) {\n"</span>;
html += <span class="code-string">"      fetch('/api/leds', {\n"</span>;
html += <span class="code-string">"        method: 'POST',\n"</span>;
html += <span class="code-string">"        headers: { 'Content-Type': 'application/json' },\n"</span>;
html += <span class="code-string">"        body: JSON.stringify({ action: action })\n"</span>;
html += <span class="code-string">"      }).then(() =&gt; actualiserEtat());\n"</span>;
html += <span class="code-string">"    }\n"</span>;
html += <span class="code-string">"    \n"</span>;
html += <span class="code-string">"    function actualiserCapteurs() {\n"</span>;
html += <span class="code-string">"      fetch('/api/capteurs')\n"</span>;
html += <span class="code-string">"        .then(response =&gt; response.json())\n"</span>;
html += <span class="code-string">"        .then(data =&gt; {\n"</span>;
html += <span class="code-string">"          document.getElementById('bouton').innerHTML = data.bouton ? 'APPUYE' : 'RELAche';\n"</span>;
html += <span class="code-string">"          document.getElementById('potentiometre').innerHTML = data.potentiometre + ' (' + Math.round(data.potentiometre/4095*100) + '%)';\n"</span>;
html += <span class="code-string">"          document.getElementById('temperature').innerHTML = data.temperature + '¬∞C';\n"</span>;
html += <span class="code-string">"        });\n"</span>;
html += <span class="code-string">"    }\n"</span>;
html += <span class="code-string">"    \n"</span>;
html += <span class="code-string">"    function actualiserEtat() {\n"</span>;
html += <span class="code-string">"      fetch('/api/etat')\n"</span>;
html += <span class="code-string">"        .then(response =&gt; response.json())\n"</span>;
html += <span class="code-string">"        .then(data =&gt; {\n"</span>;
html += <span class="code-string">"          ['rouge', 'verte', 'bleue'].forEach(couleur =&gt; {\n"</span>;
html += <span class="code-string">"            document.getElementById('status-' + couleur).innerHTML = \n"</span>;
html += <span class="code-string">"              'LED ' + couleur.toUpperCase() + ': ' + (data['led_' + couleur] ? 'ALLUMEE' : 'ETEINTE');\n"</span>;
html += <span class="code-string">"            document.getElementById('status-' + couleur).className = \n"</span>;
html += <span class="code-string">"              'status ' + (data['led_' + couleur] ? 'status-on' : 'status-off');\n"</span>;
html += <span class="code-string">"          });\n"</span>;
html += <span class="code-string">"        });\n"</span>;
html += <span class="code-string">"    }\n"</span>;
html += <span class="code-string">"    \n"</span>;
html += <span class="code-string">"    // Actualisation automatique toutes les 2 secondes\n"</span>;
html += <span class="code-string">"    setInterval(actualiserCapteurs, 2000);\n"</span>;
html += <span class="code-string">"    setInterval(actualiserEtat, 2000);\n"</span>;
html += <span class="code-string">"    \n"</span>;
html += <span class="code-string">"    // Initialisation\n"</span>;
html += <span class="code-string">"    window.onload = function() {\n"</span>;
html += <span class="code-string">"      actualiserEtat();\n"</span>;
html += <span class="code-string">"      actualiserCapteurs();\n"</span>;
html += <span class="code-string">"    };\n"</span>;
html += <span class="code-string">"  &lt;/script&gt;\n"</span>;
html += <span class="code-string">"&lt;/head&gt;\n"</span>;
html += <span class="code-string">"&lt;body&gt;\n"</span>;
html += <span class="code-string">"  &lt;h1&gt;üåê Controle ESP32 par Web&lt;/h1&gt;\n"</span>;
html += <span class="code-string">"  \n"</span>;
html += <span class="code-string">"  &lt;div class='sensors'&gt;\n"</span>;
html += <span class="code-string">"    &lt;h3&gt;üìä Capteurs&lt;/h3&gt;\n"</span>;
html += <span class="code-string">"    &lt;p&gt;Bouton: &lt;span id='bouton'&gt;--&lt;/span&gt;&lt;/p&gt;\n"</span>;
html += <span class="code-string">"    &lt;p&gt;Potentiometre: &lt;span id='potentiometre'&gt;--&lt;/span&gt;&lt;/p&gt;\n"</span>;
html += <span class="code-string">"    &lt;p&gt;Temperature: &lt;span id='temperature'&gt;--&lt;/span&gt;&lt;/p&gt;\n"</span>;
html += <span class="code-string">"  &lt;/div&gt;\n"</span>;
html += <span class="code-string">"  \n"</span>;
html += <span class="code-string">"  &lt;h3&gt;üí° Controle LEDs&lt;/h3&gt;\n"</span>;
html += <span class="code-string">"  \n"</span>;
html += <span class="code-string">"  &lt;div class='led-control'&gt;\n"</span>;
html += <span class="code-string">"    &lt;button class='btn btn-rouge' onclick='controlerLED(\"rouge\")'&gt;LED Rouge&lt;/button&gt;\n"</span>;
html += <span class="code-string">"    &lt;div id='status-rouge' class='status'&gt;LED ROUGE: --&lt;/div&gt;\n"</span>;
html += <span class="code-string">"  &lt;/div&gt;\n"</span>;
html += <span class="code-string">"  \n"</span>;
html += <span class="code-string">"  &lt;div class='led-control'&gt;\n"</span>;
html += <span class="code-string">"    &lt;button class='btn btn-vert' onclick='controlerLED(\"verte\")'&gt;LED Verte&lt;/button&gt;\n"</span>;
html += <span class="code-string">"    &lt;div id='status-verte' class='status'&gt;LED VERTE: --&lt;/div&gt;\n"</span>;
html += <span class="code-string">"  &lt;/div&gt;\n"</span>;
html += <span class="code-string">"  \n"</span>;
html += <span class="code-string">"  &lt;div class='led-control'&gt;\n"</span>;
html += <span class="code-string">"    &lt;button class='btn btn-bleu' onclick='controlerLED(\"bleue\")'&gt;LED Bleue&lt;/button&gt;\n"</span>;
html += <span class="code-string">"    &lt;div id='status-bleue' class='status'&gt;LED BLEUE: --&lt;/div&gt;\n"</span>;
html += <span class="code-string">"  &lt;/div&gt;\n"</span>;
html += <span class="code-string">"  \n"</span>;
html += <span class="code-string">"  &lt;div class='led-control'&gt;\n"</span>;
html += <span class="code-string">"    &lt;button class='btn btn-tout' onclick='controlerToutesLEDs(\"all\")'&gt;üîÜ Allumer toutes&lt;/button&gt;\n"</span>;
html += <span class="code-string">"    &lt;button class='btn btn-tout' onclick='controlerToutesLEDs(\"none\")'&gt;üåô Eteindre toutes&lt;/button&gt;\n"</span>;
html += <span class="code-string">"  &lt;/div&gt;\n"</span>;
html += <span class="code-string">"  \n"</span>;
html += <span class="code-string">"  &lt;hr&gt;\n"</span>;
html += <span class="code-string">"  &lt;p&gt;Adresse IP: "</span> + WiFi.<span class="code-function">localIP</span>().<span class="code-function">toString</span>() + <span class="code-string">"&lt;/p&gt;\n"</span>;
html += <span class="code-string">"  &lt;p&gt;Uptime: &lt;span id='uptime'&gt;"</span> + <span class="code-type">String</span>(<span class="code-function">millis</span>() / 1000) + <span class="code-string">"s&lt;/span&gt;&lt;/p&gt;\n"</span>;
html += <span class="code-string">"&lt;/body&gt;\n"</span>;
html += <span class="code-string">"&lt;/html&gt;"</span>;

server.<span class="code-function">send</span>(200, <span class="code-string">"text/html"</span>, html);
}

<span class="code-keyword">void</span> <span class="code-function">envoyerJSONEtat</span>() {
<span class="code-type">String</span> json = <span class="code-string">"{"</span>;
json += <span class="code-string">"\"led_rouge\":"</span> + <span class="code-type">String</span>(ledRougeEtat) + <span class="code-string">","</span>;
json += <span class="code-string">"\"led_verte\":"</span> + <span class="code-type">String</span>(ledVerteEtat) + <span class="code-string">","</span>;
json += <span class="code-string">"\"led_bleue\":"</span> + <span class="code-type">String</span>(ledBleueEtat) + <span class="code-string">","</span>;
json += <span class="code-string">"\"uptime\":"</span> + <span class="code-type">String</span>(<span class="code-function">millis</span>() / 1000);
json += <span class="code-string">"}"</span>;

server.<span class="code-function">send</span>(200, <span class="code-string">"application/json"</span>, json);
}

<span class="code-keyword">void</span> <span class="code-function">envoyerJSONCapteurs</span>() {
<span class="code-keyword">int</span> bouton = <span class="code-function">digitalRead</span>(BOUTON_PIN);
<span class="code-keyword">int</span> potentiometre = <span class="code-function">analogRead</span>(POT_PIN);
<span class="code-keyword">float</span> temperature = <span class="code-function">lireTemperatureSimulee</span>();

<span class="code-type">String</span> json = <span class="code-string">"{"</span>;
json += <span class="code-string">"\"bouton\":"</span> + <span class="code-type">String</span>(bouton) + <span class="code-string">","</span>;
json += <span class="code-string">"\"potentiometre\":"</span> + <span class="code-type">String</span>(potentiometre) + <span class="code-string">","</span>;
json += <span class="code-string">"\"temperature\":"</span> + <span class="code-type">String</span>(temperature, 1);
json += <span class="code-string">"}"</span>;

server.<span class="code-function">send</span>(200, <span class="code-string">"application/json"</span>, json);
}

<span class="code-keyword">void</span> <span class="code-function">traiterControleLEDs</span>(<span class="code-type">String</span> json) {
<span class="code-comment">// Analyse simple du JSON (pour un vrai projet, utilisez une biblioth√®que JSON)</span>
<span class="code-keyword">if</span> (json.<span class="code-function">indexOf</span>(<span class="code-string">"\"action\":\"all\""</span>) != -1) {
  <span class="code-comment">// Allumer toutes les LEDs</span>
  ledRougeEtat = <span class="code-keyword">true</span>;
  ledVerteEtat = <span class="code-keyword">true</span>;
  ledBleueEtat = <span class="code-keyword">true</span>;
  <span class="code-function">digitalWrite</span>(LED_ROUGE, HIGH);
  <span class="code-function">digitalWrite</span>(LED_VERTE, HIGH);
  <span class="code-function">digitalWrite</span>(LED_BLEUE, HIGH);
  Serial.<span class="code-function">println</span>(<span class="code-string">"Toutes les LEDs allumees"</span>);
} <span class="code-keyword">else</span> <span class="code-keyword">if</span> (json.<span class="code-function">indexOf</span>(<span class="code-string">"\"action\":\"none\""</span>) != -1) {
  <span class="code-comment">// √âteindre toutes les LEDs</span>
  ledRougeEtat = <span class="code-keyword">false</span>;
  ledVerteEtat = <span class="code-keyword">false</span>;
  ledBleueEtat = <span class="code-keyword">false</span>;
  <span class="code-function">digitalWrite</span>(LED_ROUGE, LOW);
  <span class="code-function">digitalWrite</span>(LED_VERTE, LOW);
  <span class="code-function">digitalWrite</span>(LED_BLEUE, LOW);
  Serial.<span class="code-function">println</span>(<span class="code-string">"Toutes les LEDs eteintes"</span>);
}
}

<span class="code-keyword">float</span> <span class="code-function">lireTemperatureSimulee</span>() {
<span class="code-comment">// Simulation de temp√©rature bas√©e sur la valeur du potentiom√®tre</span>
<span class="code-keyword">int</span> pot = <span class="code-function">analogRead</span>(POT_PIN);
<span class="code-keyword">return</span> 20.0 + (pot / 4095.0) * 30.0;  <span class="code-comment">// 20¬∞C √† 50¬∞C</span>
}</code></pre>
          </div>
        </section>
        <!-- =========================================== -->
<!-- SECTION SYST√àME DE FICHIERS -->
<!-- =========================================== -->
<section id="systeme-fichiers">
  <h2>Syst√®me de fichiers LittleFS/SPIFFS</h2>
  <p>Les syst√®mes de fichiers embarqu√©s permettent de stocker des donn√©es persistantes sur la m√©moire flash.</p>

  <h3 id="littlefs-spiffs">LittleFS vs SPIFFS</h3>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Fonctionnalit√©</th>
          <th>SPIFFS</th>
          <th>LittleFS</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Performance √©criture</td>
          <td>Lente</td>
          <td>Rapide</td>
        </tr>
        <tr>
          <td>Usure m√©moire</td>
          <td>√âlev√©e</td>
          <td>Optimis√©e</td>
        </tr>
        <tr>
          <td>Taille r√©pertoire</td>
          <td>Limit√©e</td>
          <td>Illimit√©e</td>
        </tr>
        <tr>
          <td>Support ESP32</td>
          <td>‚úîÔ∏è (obsol√®te)</td>
          <td>‚úîÔ∏è (recommand√©)</td>
        </tr>
      </tbody>
    </table>
  </div>

  <h4>Initialisation LittleFS sur ESP32</h4>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Initialisation et utilisation de LittleFS
*/</span>
<span class="code-keyword">#include</span> &lt;LittleFS.h&gt;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(115200);
  
  <span class="code-comment">// Initialisation LittleFS</span>
  <span class="code-keyword">if</span> (!LittleFS.<span class="code-function">begin</span>(<span class="code-keyword">true</span>)) {
    Serial.<span class="code-function">println</span>(<span class="code-string">"Erreur montage LittleFS"</span>);
    <span class="code-keyword">return</span>;
  }
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"LittleFS monte avec succes"</span>);
  
  <span class="code-comment">// Lister les fichiers</span>
  File root = LittleFS.<span class="code-function">open</span>(<span class="code-string">"/"</span>);
  File file = root.<span class="code-function">openNextFile</span>();
  
  <span class="code-keyword">while</span>(file) {
    Serial.<span class="code-function">print</span>(<span class="code-string">"Fichier: "</span>);
    Serial.<span class="code-function">print</span>(file.<span class="code-function">name</span>());
    Serial.<span class="code-function">print</span>(<span class="code-string">" | Taille: "</span>);
    Serial.<span class="code-function">println</span>(file.<span class="code-function">size</span>());
    file.<span class="code-function">close</span>();
    file = root.<span class="code-function">openNextFile</span>();
  }
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-comment">// Sauvegarde de donnees</span>
  <span class="code-function">sauvegarderDonnees</span>();
  <span class="code-function">delay</span>(60000); <span class="code-comment">// Toutes les minutes</span>
}

<span class="code-keyword">void</span> <span class="code-function">sauvegarderDonnees</span>() {
  File file = LittleFS.<span class="code-function">open</span>(<span class="code-string">"/data.json"</span>, <span class="code-string">"w"</span>);
  
  <span class="code-keyword">if</span> (!file) {
    Serial.<span class="code-function">println</span>(<span class="code-string">"Erreur ouverture fichier"</span>);
    <span class="code-keyword">return</span>;
  }
  
  <span class="code-type">String</span> jsonData = <span class="code-string">"{\"temperature\":23.5,\"humidite\":65,\"timestamp\":"</span> + 
                    <span class="code-type">String</span>(<span class="code-function">millis</span>()) + <span class="code-string">"}"</span>;
  
  file.<span class="code-function">print</span>(jsonData);
  file.<span class="code-function">close</span>();
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Donnees sauvegardees"</span>);
}</code></pre>
  </div>

  <h3 id="partitionnement">Partitionnement ESP32</h3>
  <div class="code-example">
    <h4>Configuration partitions.csv</h4>
    <pre><code><span class="code-comment"># Fichier partitions.csv dans le dossier data de votre projet</span>
<span class="code-comment"># Nom, Type, SousType, Offset, Taille, Flags</span>
nvs,      data, nvs,     0x9000,  0x6000,
otadata,  data, ota,     0xf000,  0x2000,
app0,     app,  ota_0,   0x10000, 0x140000,
app1,     app,  ota_1,   0x150000,0x140000,
spiffs,   data, spiffs,  0x290000,0x160000,</code></pre>
  </div>
</section>
<!-- =========================================== -->
<!-- SECTION WEBSOCKET -->
<!-- =========================================== -->
<section id="websocket">
  <h2>Communication WebSocket en temps r√©el</h2>
  <p>WebSocket permet une communication bidirectionnelle en temps r√©el entre l'ESP et un navigateur web.</p>

  <h3>Serveur WebSocket sur ESP32</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Serveur WebSocket pour dashboard temps r√©el
*/</span>
<span class="code-keyword">#include</span> &lt;WiFi.h&gt;
<span class="code-keyword">#include</span> &lt;WebSocketsServer.h&gt;

<span class="code-keyword">const</span> <span class="code-type">char</span>* ssid = <span class="code-string">"Votre_SSID"</span>;
<span class="code-keyword">const</span> <span class="code-type">char</span>* password = <span class="code-string">"Votre_Mot_De_Passe"</span>;

<span class="code-comment">// Port WebSocket (g√©n√©ralement 81)</span>
WebSocketsServer webSocket = WebSocketsServer(81);

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(115200);
  
  <span class="code-comment">// Connexion WiFi</span>
  WiFi.<span class="code-function">begin</span>(ssid, password);
  <span class="code-keyword">while</span> (WiFi.<span class="code-function">status</span>() != WL_CONNECTED) {
    <span class="code-function">delay</span>(500);
    Serial.<span class="code-function">print</span>(<span class="code-string">"."</span>);
  }
  
  Serial.<span class="code-function">println</span>();
  Serial.<span class="code-function">print</span>(<span class="code-string">"IP: "</span>);
  Serial.<span class="code-function">println</span>(WiFi.<span class="code-function">localIP</span>());
  
  <span class="code-comment">// D√©marrage serveur WebSocket</span>
  webSocket.<span class="code-function">begin</span>();
  webSocket.<span class="code-function">onEvent</span>(webSocketEvent);
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Serveur WebSocket demarre"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  webSocket.<span class="code-function">loop</span>();
  
  <span class="code-comment">// Envoi p√©riodique de donn√©es</span>
  <span class="code-keyword">static</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> lastSend = 0;
  <span class="code-keyword">if</span> (<span class="code-function">millis</span>() - lastSend > 1000) {
    lastSend = <span class="code-function">millis</span>();
    
    <span class="code-type">String</span> data = <span class="code-string">"{\"temp\":"</span> + <span class="code-type">String</span>(<span class="code-function">random</span>(20, 30)) + 
                   <span class="code-string">",\"hum\":"</span> + <span class="code-type">String</span>(<span class="code-function">random</span>(40, 80)) + 
                   <span class="code-string">",\"time\":"</span> + <span class="code-type">String</span>(<span class="code-function">millis</span>()) + <span class="code-string">"}"</span>;
    
    webSocket.<span class="code-function">broadcastTXT</span>(data);
  }
}

<span class="code-keyword">void</span> <span class="code-function">webSocketEvent</span>(<span class="code-keyword">uint8_t</span> num, WStype_t type, <span class="code-type">uint8_t</span>* payload, <span class="code-keyword">size_t</span> length) {
  <span class="code-keyword">switch</span>(type) {
    <span class="code-keyword">case</span> WStype_DISCONNECTED:
      Serial.<span class="code-function">printf</span>(<span class="code-string">"[%u] Deconnecte\n"</span>, num);
      <span class="code-keyword">break</span>;
      
    <span class="code-keyword">case</span> WStype_CONNECTED: {
      IPAddress ip = webSocket.<span class="code-function">remoteIP</span>(num);
      Serial.<span class="code-function">printf</span>(<span class="code-string">"[%u] Connecte depuis %d.%d.%d.%d\n"</span>, 
                    num, ip[0], ip[1], ip[2], ip[3]);
      webSocket.<span class="code-function">sendTXT</span>(num, <span class="code-string">"{\"message\":\"Bienvenue!\"}"</span>);
      } <span class="code-keyword">break</span>;
      
    <span class="code-keyword">case</span> WStype_TEXT:
      Serial.<span class="code-function">printf</span>(<span class="code-string">"[%u] Message: %s\n"</span>, num, payload);
      <span class="code-function">traiterCommande</span>((<span class="code-type">char</span>*)payload, num);
      <span class="code-keyword">break</span>;
      
    <span class="code-keyword">case</span> WStype_BIN:
      Serial.<span class="code-function">printf</span>(<span class="code-string">"[%u] Donnees binaires\n"</span>, num);
      <span class="code-keyword">break</span>;
  }
}

<span class="code-keyword">void</span> <span class="code-function">traiterCommande</span>(<span class="code-type">char</span>* commande, <span class="code-keyword">uint8_t</span> client) {
  <span class="comment">// Parse JSON simple (en production utiliser ArduinoJson)</span>
  <span class="keyword">if</span> (<span class="function-name">strstr</span>(commande, "\"led\":\"on\"")) {
    <span class="function-name">digitalWrite</span>(LED_BUILTIN, HIGH);
    webSocket.<span class="function-name">sendTXT</span>(client, "{\"status\":\"LED allumee\"}");
  }
  <span class="keyword">else if</span> (<span class="function-name">strstr</span>(commande, "\"led\":\"off\"")) {
    <span class="function-name">digitalWrite</span>(LED_BUILTIN, LOW);
    webSocket.<span class="function-name">sendTXT</span>(client, "{\"status\":\"LED eteinte\"}");
  }
}</code></pre>
  </div>

  <div class="info-box">
    <h4>Avantages de WebSocket</h4>
    <ul>
      <li><strong>Temps r√©el</strong> : Pas besoin de polling</li>
      <li><strong>Bidirectionnel</strong> : Communication full-duplex</li>
      <li><strong>Faible latence</strong> : Parfait pour les dashboards</li>
      <li><strong>√âconomique</strong> : Moins d'overhead que HTTP</li>
    </ul>
  </div>
</section>
<!-- =========================================== -->
<!-- SECTION OTA (MISE √Ä JOUR √Ä DISTANCE) -->
<!-- =========================================== -->
<section id="ota">
  <h2>Mise √† jour OTA (Over-The-Air)</h2>
  <p>Mettez √† jour votre firmware sans brancher de c√¢ble USB.</p>

  <h3>OTA Basic avec Arduino IDE</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Configuration OTA de base
*/</span>
<span class="code-keyword">#include</span> &lt;WiFi.h&gt;
<span class="code-keyword">#include</span> &lt;ESPmDNS.h&gt;
<span class="code-keyword">#include</span> &lt;WiFiUdp.h&gt;
<span class="code-keyword">#include</span> &lt;ArduinoOTA.h&gt;

<span class="code-keyword">const</span> <span class="code-type">char</span>* ssid = <span class="code-string">"Votre_SSID"</span>;
<span class="code-keyword">const</span> <span class="code-type">char</span>* password = <span class="code-string">"Votre_Mot_De_Passe"</span>;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(115200);
  
  <span class="code-comment">// Connexion WiFi</span>
  WiFi.<span class="code-function">begin</span>(ssid, password);
  <span class="code-keyword">while</span> (WiFi.<span class="code-function">status</span>() != WL_CONNECTED) {
    <span class="code-function">delay</span>(1000);
    Serial.<span class="code-function">println</span>(<span class="code-string">"Connexion WiFi..."</span>);
  }
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"WiFi connecte"</span>);
  Serial.<span class="code-function">println</span>(<span class="code-string">"Adresse IP: "</span>);
  Serial.<span class="code-function">println</span>(WiFi.<span class="code-function">localIP</span>());

  <span class="code-comment">// Configuration OTA</span>
  ArduinoOTA.<span class="code-function">setHostname</span>(<span class="code-string">"esp32-ota"</span>);
  ArduinoOTA.<span class="code-function">setPassword</span>(<span class="code-string">"admin123"</span>); <span class="code-comment">// Mot de passe OTA</span>

  ArduinoOTA
    .<span class="code-function">onStart</span>([]() {
      <span class="code-type">String</span> type;
      <span class="code-keyword">if</span> (ArduinoOTA.<span class="code-function">getCommand</span>() == U_FLASH) {
        type = <span class="code-string">"sketch"</span>;
      } <span class="code-keyword">else</span> { <span class="code-comment">// U_SPIFFS</span>
        type = <span class="code-string">"filesystem"</span>;
        LittleFS.<span class="code-function">end</span>(); <span class="code-comment">// D√©montage filesystem</span>
      }
      Serial.<span class="code-function">println</span>(<span class="code-string">"D√©but mise √† jour "</span> + type);
    })
    .<span class="code-function">onEnd</span>([]() {
      Serial.<span class="code-function">println</span>(<span class="code-string">"\nMise √† jour termin√©e"</span>);
    })
    .<span class="code-function">onProgress</span>([](<span class="code-keyword">unsigned</span> <span class="code-keyword">int</span> progress, <span class="code-keyword">unsigned</span> <span class="code-keyword">int</span> total) {
      Serial.<span class="code-function">printf</span>(<span class="code-string">"Progression: %u%%\r"</span>, (progress / (total / 100)));
    })
    .<span class="code-function">onError</span>([](ota_error_t error) {
      Serial.<span class="code-function">printf</span>(<span class="code-string">"Erreur[%u]: "</span>, error);
      <span class="code-keyword">if</span> (error == OTA_AUTH_ERROR) Serial.<span class="code-function">println</span>(<span class="code-string">"Authentification echouee"</span>);
      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (error == OTA_BEGIN_ERROR) Serial.<span class="code-function">println</span>(<span class="code-string">"Erreur debut"</span>);
      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (error == OTA_CONNECT_ERROR) Serial.<span class="code-function">println</span>(<span class="code-string">"Erreur connexion"</span>);
      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (error == OTA_RECEIVE_ERROR) Serial.<span class="code-function">println</span>(<span class="code-string">"Erreur reception"</span>);
      <span class="code-keyword">else</span> <span class="code-keyword">if</span> (error == OTA_END_ERROR) Serial.<span class="code-function">println</span>(<span class="code-string">"Erreur fin"</span>);
    });

  ArduinoOTA.<span class="code-function">begin</span>();
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"OTA pret"</span>);
  Serial.<span class="code-function">println</span>(<span class="code-string">"Pour mettre a jour, allez dans:"</span>);
  Serial.<span class="code-function">print</span>(<span class="code-string">"  Outils ‚Üí Port ‚Üí esp32-ota.local ("</span>);
  Serial.<span class="code-function">print</span>(WiFi.<span class="code-function">localIP</span>());
  Serial.<span class="code-function">println</span>(<span class="code-string">")"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  ArduinoOTA.<span class="code-function">handle</span>();
  <span class="comment">// Votre code normal ici</span>
  <span class="function-name">delay</span>(10);
}</code></pre>
  </div>
</section>
<!-- =========================================== -->
<!-- SECTION BLE MIDI/AUDIO -->
<!-- =========================================== -->
<section id="ble-midi">
  <h2>BLE MIDI et Audio</h2>
  <p>Utilisez l'ESP32 pour des applications audio via Bluetooth.</p>

  <h3>BLE MIDI Controller</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Contr√¥leur MIDI BLE pour applications musicales
*/</span>
<span class="code-keyword">#include</span> &lt;BLEMIDI_Transport.h&gt;
<span class="code-keyword">#include</span> &lt;hardware/BLEMIDI_ESP32.h&gt;

BLEMIDI_CREATE_INSTANCE(<span class="code-string">"ESP32-MIDI"</span>, MIDI)

<span class="code-keyword">const</span> <span class="code-keyword">int</span> boutons[] = {13, 12, 14, 27};
<span class="code-keyword">const</span> <span class="code-keyword">int</span> potards[] = {32, 33, 34, 35};
<span class="code-keyword">bool</span> etatsBoutons[4] = {<span class="code-keyword">false</span>};

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(115200);
  
  <span class="comment">// Configuration broches</span>
  <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < 4; i++) {
    <span class="function-name">pinMode</span>(boutons[i], INPUT_PULLUP);
  }
  
  <span class="comment">// Initialisation BLE MIDI</span>
  MIDI.<span class="function-name">begin</span>();
  BLEMIDI.<span class="function-name">setHandleConnected</span>(onConnected);
  BLEMIDI.<span class="function-name">setHandleDisconnected</span>(onDisconnected);
  
  Serial.<span class="function-name">println</span>("Contr√¥leur MIDI BLE pr√™t");
}

<span class="type">void</span> <span class="function-name">loop</span>() {
  <span class="comment">// Lecture boutons</span>
  <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < 4; i++) {
    <span class="type">bool</span> etat = !<span class="function-name">digitalRead</span>(boutons[i]);
    
    <span class="keyword">if</span> (etat != etatsBoutons[i]) {
      etatsBoutons[i] = etat;
      
      <span class="keyword">if</span> (etat) {
        <span class="comment">// Note On - Note MIDI 60 (Do) + i</span>
        MIDI.<span class="function-name">sendNoteOn</span>(60 + i, 127, 1);
        Serial.<span class="function-name">print</span>("Note On: ");
        Serial.<span class="function-name">println</span>(60 + i);
      } <span class="keyword">else</span> {
        <span class="comment">// Note Off</span>
        MIDI.<span class="function-name">sendNoteOff</span>(60 + i, 0, 1);
      }
    }
  }
  
  <span class="comment">// Lecture potentiom√®tres (Control Change)</span>
  <span class="keyword">static</span> <span class="type">int</span> anciennesValeurs[4] = {-1};
  
  <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < 4; i++) {
    <span class="type">int</span> valeur = <span class="function-name">analogRead</span>(potards[i]) / 8; <span class="comment">// 0-127</span>
    
    <span class="keyword">if</span> (<span class="function-name">abs</span>(valeur - anciennesValeurs[i]) > 2) {
      anciennesValeurs[i] = valeur;
      MIDI.<span class="function-name">sendControlChange</span>(i + 1, valeur, 1); <span class="comment">// CC 1-4</span>
    }
  }
  
  <span class="function-name">delay</span>(10);
}

<span class="type">void</span> <span class="function-name">onConnected</span>() {
  Serial.<span class="function-name">println</span>("MIDI BLE connect√©");
}

<span class="type">void</span> <span class="function-name">onDisconnected</span>() {
  Serial.<span class="function-name">println</span>("MIDI BLE d√©connect√©");
}</code></pre>
  </div>

  <h3>BLE Audio Streaming</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Streaming audio via BLE A2DP
*/</span>
<span class="code-keyword">#include</span> "BluetoothA2DPSource.h"

BluetoothA2DPSource a2dp_source;
<span class="code-keyword">int16_t</span> audio_data[1024];
<span class="code-keyword">int</span> audio_index = 0;

<span class="comment">// Fonction callback pour g√©n√©rer l'audio</span>
<span class="type">int32_t</span> <span class="function-name">get_audio_data</span>(<span class="type">Frame</span> *frame, <span class="type">int32_t</span> frame_count) {
  <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < frame_count; i++) {
    <span class="comment">// G√©n√©ration onde sinuso√Ødale (440Hz)</span>
    <span class="type">int16_t</span> sample = 32767 * <span class="function-name">sin</span>(2 * PI * 440 * audio_index / 44100.0);
    frame[i].channel1 = sample;
    frame[i].channel2 = sample;
    audio_index++;
  }
  <span class="keyword">return</span> frame_count;
}

<span class="type">void</span> <span class="function-name">setup</span>() {
  Serial.<span class="function-name">begin</span>(115200);
  
  <span class="comment">// Configuration A2DP source</span>
  <span class="type">static</span> <span class="type">i2s_config_t</span> i2s_config = {
    .mode = (<span class="type">i2s_mode_t</span>)(I2S_MODE_MASTER | I2S_MODE_TX),
    .sample_rate = 44100,
    .bits_per_sample = I2S_BITS_PER_SAMPLE_16BIT,
    .channel_format = I2S_CHANNEL_FMT_RIGHT_LEFT,
    .communication_format = I2S_COMM_FORMAT_I2S,
    .intr_alloc_flags = 0,
    .dma_buf_count = 8,
    .dma_buf_len = 64
  };
  
  a2dp_source.<span class="function-name">set_i2s_config</span>(i2s_config);
  a2dp_source.<span class="function-name">start</span>("ESP32-Speaker", get_audio_data);
  
  Serial.<span class="function-name">println</span>("Source audio BLE d√©marr√©e");
}

<span class="type">void</span> <span class="function-name">loop</span>() {
  <span class="function-name">delay</span>(1000);
}</code></pre>
  </div>
</section>
<!-- =========================================== -->
<!-- SECTION GESTION M√âMOIRE -->
<!-- =========================================== -->
<section id="gestion-memoire">
  <h2>Gestion m√©moire sur ESP32/Arduino</h2>
  <p>Optimisez l'utilisation m√©moire pour √©viter les plantages.</p>

  <h3>Surveillance m√©moire</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Surveillance et optimisation m√©moire
*/</span>
<span class="code-keyword">#include</span> &lt;esp_heap_trace.h&gt;
<span class="code-keyword">#define</span> NUM_RECORDS 100
<span class="code-keyword">static</span> heap_trace_record_t trace_record[NUM_RECORDS];

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(115200);
  
  <span class="comment">// Initialisation trace m√©moire</span>
  <span class="function-name">heap_trace_init_standalone</span>(trace_record, NUM_RECORDS);
  
  <span class="comment">// Affichage info m√©moire</span>
  <span class="function-name">afficherMemoire</span>();
}

<span class="type">void</span> <span class="function-name">loop</span>() {
  <span class="function-name">afficherMemoire</span>();
  <span class="function-name">delay</span>(5000);
}

<span class="type">void</span> <span class="function-name">afficherMemoire</span>() {
  <span class="comment">// M√©moire RAM</span>
  Serial.<span class="function-name">print</span>("Heap libre: ");
  Serial.<span class="function-name">print</span>(<span class="function-name">ESP.getFreeHeap</span>());
  Serial.<span class="function-name">print</span>(" | Plus petit bloc: ");
  Serial.<span class="function-name">println</span>(<span class="function-name">ESP.getMinFreeHeap</span>());
  
  Serial.<span class="function-name">print</span>("Taille heap max: ");
  Serial.<span class="function-name">println</span>(<span class="function-name">ESP.getMaxAllocHeap</span>());
  
  <span class="comment">// Pile (stack)</span>
  <span class="type">uint32_t</span> stack_start;
  <span class="type">uint32_t</span> stack_end;
  <span class="function-name">esp_get_free_heap_size</span>();
  
  <span class="comment">// Fragmentation</span>
  Serial.<span class="function-name">print</span>("Fragmentation heap: ");
  Serial.<span class="function-name">print</span>(<span class="function-name">ESP.getHeapFragmentation</span>());
  Serial.<span class="function-name">println</span>("%");
  
  <span class="comment">// PSRAM (si disponible)</span>
  <span class="keyword">if</span> (<span class="function-name">psramFound</span>()) {
    Serial.<span class="function-name">print</span>("PSRAM libre: ");
    Serial.<span class="function-name">println</span>(<span class="function-name">ESP.getFreePsram</span>());
  }
}

<span class="comment">// Optimisation : utiliser PROGMEM pour les strings</span>
<span class="keyword">const</span> <span class="type">char</span> texteLong[] PROGMEM = "Ce texte est stock√© en m√©moire flash, pas en RAM";

<span class="comment">// Optimisation : pool m√©moire</span>
<span class="keyword">class</span> <span class="class-name">MemoryPool</span> {
<span class="keyword">private</span>:
  <span class="type">static</span> <span class="keyword">const</span> <span class="type">int</span> POOL_SIZE = 1024;
  <span class="type">uint8_t</span> pool[POOL_SIZE];
  <span class="type">bool</span> allocated[POOL_SIZE];
  
<span class="keyword">public</span>:
  <span class="function-name">MemoryPool</span>() {
    <span class="function-name">memset</span>(allocated, 0, <span class="keyword">sizeof</span>(allocated));
  }
  
  <span class="type">void</span>* <span class="function-name">allocate</span>(<span class="type">size_t</span> size) {
    <span class="comment">// Recherche bloc libre</span>
    <span class="keyword">for</span> (<span class="type">int</span> i = 0; i <= POOL_SIZE - size; i++) {
      <span class="type">bool</span> libre = <span class="keyword">true</span>;
      <span class="keyword">for</span> (<span class="type">int</span> j = 0; j < size; j++) {
        <span class="keyword">if</span> (allocated[i + j]) {
          libre = <span class="keyword">false</span>;
          <span class="keyword">break</span>;
        }
      }
      
      <span class="keyword">if</span> (libre) {
        <span class="keyword">for</span> (<span class="type">int</span> j = 0; j < size; j++) {
          allocated[i + j] = <span class="keyword">true</span>;
        }
        <span class="keyword">return</span> &pool[i];
      }
    }
    <span class="keyword">return</span> <span class="keyword">nullptr</span>;
  }
  
  <span class="type">void</span> <span class="function-name">deallocate</span>(<span class="type">void</span>* ptr, <span class="type">size_t</span> size) {
    <span class="type">int</span> index = (<span class="type">uint8_t</span>*)ptr - pool;
    <span class="keyword">if</span> (index >= 0 && index < POOL_SIZE) {
      <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < size; i++) {
        allocated[index + i] = <span class="keyword">false</span>;
      }
    }
  }
};</code></pre>
  </div>

  <h3>D√©tection fuites m√©moire</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
D√©tection de fuites m√©moire
*/</span>
<span class="keyword">void</span> <span class="function-name">detecterFuiteMemoire</span>() {
  <span class="type">static</span> <span class="type">uint32_t</span> dernierHeap = 0;
  <span class="type">uint32_t</span> heapActuel = <span class="function-name">ESP.getFreeHeap</span>();
  
  <span class="keyword">if</span> (dernierHeap > 0) {
    <span class="type">int32_t</span> difference = dernierHeap - heapActuel;
    
    <span class="keyword">if</span> (difference > 100) { <span class="comment">// Perte de plus de 100 bytes</span>
      Serial.<span class="function-name">print</span>("Fuite m√©moire d√©tect√©e! Perte: ");
      Serial.<span class="function-name">print</span>(difference);
      Serial.<span class="function-name">println</span>(" bytes");
      
      <span class="comment">// D√©marrage trace d√©taill√©e</span>
      <span class="function-name">heap_trace_start</span>(HEAP_TRACE_LEAKS);
    }
  }
  
  dernierHeap = heapActuel;
}</code></pre>
  </div>
</section>
<!-- =========================================== -->
<!-- SECTION MODE BASSE CONSOMMATION -->
<!-- =========================================== -->
<section id="low-power">
  <h2>Optimisation consommation ESP32</h2>
  <p>R√©duisez la consommation pour applications sur batterie.</p>

  <h3>Modes sommeil</h3>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Mode</th>
          <th>Consommation</th>
          <th>Temps r√©veil</th>
          <th>M√©moire conserv√©e</th>
          <th>Utilisation</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Actif</td>
          <td>80-240 mA</td>
          <td>-</td>
          <td>Tout</td>
          <td>Op√©ration normal</td>
        </tr>
        <tr>
          <td>Light Sleep</td>
          <td>0.8 mA</td>
          <td>~1 ms</td>
          <td>RAM</td>
          <td>Pauses courtes</td>
        </tr>
        <tr>
          <td>Deep Sleep</td>
          <td>10 ¬µA</td>
          <td>~200 ms</td>
          <td>RTC</td>
          <td>Longues p√©riodes</td>
        </tr>
        <tr>
          <td>Hibernation</td>
          <td>5 ¬µA</td>
          <td>~1 s</td>
          <td>RTC lent</td>
          <td>Ultra basse consom.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <h3>Deep Sleep avec r√©veil p√©riodique</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Deep Sleep avec RTC et r√©veil externe
*/</span>
<span class="type">RTC_DATA_ATTR</span> <span class="type">int</span> compteurBoot = 0;
<span class="type">RTC_DATA_ATTR</span> <span class="type">float</span> temperatureMin = 100.0;
<span class="type">RTC_DATA_ATTR</span> <span class="type">float</span> temperatureMax = -100.0;

<span class="keyword">void</span> <span class="function-name">setup</span>() {
  Serial.<span class="function-name">begin</span>(115200);
  <span class="function-name">delay</span>(100);
  
  compteurBoot++;
  Serial.<span class="function-name">print</span>("Boot #");
  Serial.<span class="function-name">println</span>(compteurBoot);
  
  <span class="comment">// Raison du r√©veil</span>
  <span class="function-name">printReveilRaison</span>();
  
  <span class="comment">// Mesure temp√©rature (simul√©e)</span>
  <span class="type">float</span> temperature = <span class="function-name">lireTemperature</span>();
  
  <span class="comment">// Mise √† jour min/max</span>
  temperatureMin = <span class="function-name">min</span>(temperatureMin, temperature);
  temperatureMax = <span class="function-name">max</span>(temperatureMax, temperature);
  
  Serial.<span class="function-name">print</span>("Temp√©rature: ");
  Serial.<span class="function-name">println</span>(temperature);
  Serial.<span class="function-name">print</span>("Min: ");
  Serial.<span class="function-name">print</span>(temperatureMin);
  Serial.<span class="function-name">print</span>(" Max: ");
  Serial.<span class="function-name">println</span>(temperatureMax);
  
  <span class="comment">// Configuration prochain r√©veil</span>
  <span class="function-name">configurerProchainReveil</span>();
}

<span class="type">void</span> <span class="function-name">loop</span>() {
  <span class="comment">// Une seule ex√©cution puis deep sleep</span>
  
  <span class="comment">// Envoi donn√©es si n√©cessaire</span>
  <span class="keyword">if</span> (compteurBoot % 10 == 0) { <span class="comment">// Tous les 10 r√©veils</span>
    <span class="function-name">envoyerDonnees</span>();
  }
  
  Serial.<span class="function-name">println</span>("Entr√©e en Deep Sleep...");
  
  <span class="comment">// Deep sleep pour 5 minutes</span>
  <span class="function-name">esp_deep_sleep</span>(5 * 60 * 1000000); <span class="comment">// microsecondes</span>
}

<span class="type">void</span> <span class="function-name">printReveilRaison</span>() {
  <span class="type">esp_sleep_wakeup_cause_t</span> cause = <span class="function-name">esp_sleep_get_wakeup_cause</span>();
  
  <span class="keyword">switch</span>(cause) {
    <span class="keyword">case</span> ESP_SLEEP_WAKEUP_EXT0:
      Serial.<span class="function-name">println</span>("R√©veil par bouton");
      <span class="keyword">break</span>;
    <span class="keyword">case</span> ESP_SLEEP_WAKEUP_TIMER:
      Serial.<span class="function-name">println</span>("R√©veil par timer");
      <span class="keyword">break</span>;
    <span class="keyword">case</span> ESP_SLEEP_WAKEUP_TOUCHPAD:
      Serial.<span class="function-name">println</span>("R√©veil par touchpad");
      <span class="keyword">break</span>;
    <span class="keyword">case</span> ESP_SLEEP_WAKEUP_ULP:
      Serial.<span class="function-name">println</span>("R√©veil par ULP");
      <span class="keyword">break</span>;
    <span class="keyword">default</span>:
      Serial.<span class="function-name">println</span>("Premier d√©marrage");
      <span class="keyword">break</span>;
  }
}

<span class="type">void</span> <span class="function-name">configurerProchainReveil</span>() {
  <span class="comment">// D√©sactive tous les r√©veils pr√©c√©dents</span>
  <span class="function-name">esp_sleep_disable_wakeup_source</span>(ESP_SLEEP_WAKEUP_ALL);
  
  <span class="comment">// Active r√©veil par timer (5 minutes)</span>
  <span class="function-name">esp_sleep_enable_timer_wakeup</span>(5 * 60 * 1000000);
  
  <span class="comment">// Active r√©veil par bouton (GPIO 0)</span>
  <span class="function-name">esp_sleep_enable_ext0_wakeup</span>(GPIO_NUM_0, 0); <span class="comment">// Low level</span>
  
  <span class="comment">// Active r√©veil par touchpad</span>
  <span class="function-name">touchAttachInterrupt</span>(T0, reveilTouchpad, 40);
  <span class="function-name">esp_sleep_enable_touchpad_wakeup</span>();
}

<span class="type">void</span> <span class="function-name">reveilTouchpad</span>() {
  <span class="comment">// Callback touchpad</span>
}</code></pre>
  </div>

  <h3>Optimisation WiFi/BLE</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
R√©duction consommation WiFi/BLE
*/</span>
<span class="type">void</span> <span class="function-name">optimiserConsommation</span>() {
  <span class="comment">// 1. WiFi</span>
  WiFi.<span class="function-name">setSleep</span>(WIFI_PS_MIN_MODEM); <span class="comment">// Mode √©conomie</span>
  
  <span class="comment">// 2. CPU</span>
  <span class="function-name">setCpuFrequencyMhz</span>(80); <span class="comment">// Baisse fr√©quence CPU</span>
  
  <span class="comment">// 3. P√©riph√©riques inutiles</span>
  <span class="function-name">btStop</span>(); <span class="comment">// D√©sactive Bluetooth</span>
  
  <span class="comment">// 4. LED</span>
  <span class="function-name">digitalWrite</span>(LED_BUILTIN, LOW);
  <span class="type">gpio_hold_t</span> hold = GPIO_HOLD_ENABLE;
  <span class="function-name">gpio_hold_en</span>(GPIO_NUM_2);
  
  <span class="comment">// 5. ADC</span>
  <span class="function-name">adc_power_off</span>();
  
  <span class="comment">// 6. R√©duction tension</span>
  <span class="function-name">esp_pm_configure</span>();
}

<span class="comment">// Modem Sleep entre transmissions</span>
<span class="type">void</span> <span class="function-name">transmissionEconome</span>() {
  WiFi.<span class="function-name">begin</span>(SSID, PASS);
  <span class="function-name">delay</span>(100);
  
  <span class="comment">// Transmission rapide</span>
  WiFiClient client;
  client.<span class="function-name">connect</span>(SERVER, PORT);
  client.<span class="function-name">print</span>("Donn√©es");
  client.<span class="function-name">stop</span>();
  
  <span class="comment">// Coupe WiFi rapidement</span>
  WiFi.<span class="function-name">disconnect</span>(<span class="keyword">true</span>);
  WiFi.<span class="function-name">mode</span>(WIFI_OFF);
}</code></pre>
  </div>
</section>
<!-- =========================================== -->
<!-- SECTION TECHNIQUES DE D√âBOGAGE -->
<!-- =========================================== -->
<section id="debogage">
  <h2>Techniques avanc√©es de d√©bogage</h2>
  <p>Outils et m√©thodes pour d√©boguer efficacement.</p>

  <h3>Core Dump et Backtrace</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Configuration core dump pour analyse plantages
*/</span>
<span class="keyword">void</span> <span class="function-name">setup</span>() {
  Serial.<span class="function-name">begin</span>(115200);
  
  <span class="comment">// Configuration core dump vers UART</span>
  <span class="function-name">esp_core_dump_init</span>();
  <span class="function-name">esp_core_dump_to_uart</span>();
  
  <span class="comment">// Handler exceptions</span>
  <span class="function-name">esp_set_breakpoint_if_jtag</span>();
  
  Serial.<span class="function-name">println</span>("D√©bogage activ√©");
  
  <span class="comment">// Test plantage (d√©commentez pour tester)</span>
  <span class="comment">// testPlantage();</span>
}

<span class="type">void</span> <span class="function-name">testPlantage</span>() {
  <span class="comment">// Plantage intentionnel pour test</span>
  <span class="type">int</span>* ptr = <span class="keyword">nullptr</span>;
  *ptr = 42; <span class="comment">// Segfault!</span>
}

<span class="comment">// Fonction pour afficher backtrace</span>
<span class="type">void</span> <span class="function-name">printBacktrace</span>() {
  <span class="type">void</span>* callstack[10];
  <span class="type">int</span> frames = <span class="function-name">backtrace</span>(callstack, 10);
  <span class="type">char</span>** strs = <span class="function-name">backtrace_symbols</span>(callstack, frames);
  
  Serial.<span class="function-name">println</span>("=== Backtrace ===");
  <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < frames; ++i) {
    Serial.<span class="function-name">println</span>(strs[i]);
  }
  <span class="function-name">free</span>(strs);
}

<span class="comment">// Handler panic</span>
<span class="keyword">extern</span> <span class="string">"C"</span> <span class="type">void</span> <span class="function-name">__real_esp_panic_handler</span>(<span class="type">void</span>* info) {
  Serial.<span class="function-name">println</span>("=== PANIC HANDLER ===");
  <span class="function-name">printBacktrace</span>();
  <span class="function-name">__real_esp_panic_handler</span>(info);
}</code></pre>
  </div>

  <h3>Debug avec GDB (PlatformIO)</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
platformio.ini pour d√©bogage
*/</span>
[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

<span class="code-comment"># Configuration d√©bogage</span>
debug_tool = esp-prog
debug_port = /dev/ttyUSB0
debug_speed = 115200

<span class="code-comment"># Build flags pour d√©bogage</span>
build_flags = 
    -ggdb
    -Og
    -DDEBUG_ESP_PORT=Serial
    -DDEBUG_ESP_CORE

<span class="code-comment"># Debugger configuration</span>
[env:esp32dev:debug]
build_type = debug
debug_init_break = tbreak setup
debug_extra_cmds = 
    monitor reset halt
    monitor gdb_sync
    monitor flash protect 0 0 last off</code></pre>
  </div>

  <h3>Logging avanc√© avec Serial</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Syst√®me de logging avanc√©
*/</span>
<span class="keyword">enum</span> <span class="class-name">LogLevel</span> {
  LOG_ERROR,
  LOG_WARN,
  LOG_INFO,
  LOG_DEBUG,
  LOG_VERBOSE
};

<span class="keyword">class</span> <span class="class-name">Logger</span> {
<span class="keyword">private</span>:
  LogLevel niveau = LOG_INFO;
  <span class="type">bool</span> avecTimestamp = <span class="keyword">true</span>;
  
<span class="keyword">public</span>:
  <span class="function-name">Logger</span>(LogLevel niveau) : <span class="class-name">niveau</span>(niveau) {}
  
  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
  <span class="type">void</span> <span class="function-name">log</span>(LogLevel niveauMsg, <span class="type">const</span> T& msg) {
    <span class="keyword">if</span> (niveauMsg <= niveau) {
      <span class="keyword">if</span> (avecTimestamp) {
        Serial.<span class="function-name">print</span>(<span class="function-name">millis</span>());
        Serial.<span class="function-name">print</span>(" ");
      }
      
      Serial.<span class="function-name">print</span>(<span class="function-name">getLevelString</span>(niveauMsg));
      Serial.<span class="function-name">print</span>(": ");
      Serial.<span class="function-name">println</span>(msg);
    }
  }
  
  <span class="type">void</span> <span class="function-name">hexDump</span>(<span class="type">const</span> <span class="type">uint8_t</span>* data, <span class="type">size_t</span> length) {
    <span class="keyword">for</span> (<span class="type">size_t</span> i = 0; i < length; i += 16) {
      Serial.<span class="function-name">printf</span>("%04X: ", i);
      
      <span class="comment">// Hex</span>
      <span class="keyword">for</span> (<span class="type">size_t</span> j = 0; j < 16; j++) {
        <span class="keyword">if</span> (i + j < length) {
          Serial.<span class="function-name">printf</span>("%02X ", data[i + j]);
        } <span class="keyword">else</span> {
          Serial.<span class="function-name">print</span>("   ");
        }
        
        <span class="keyword">if</span> (j == 7) Serial.<span class="function-name">print</span>(" ");
      }
      
      Serial.<span class="function-name">print</span>(" ");
      
      <span class="comment">// ASCII</span>
      <span class="keyword">for</span> (<span class="type">size_t</span> j = 0; j < 16; j++) {
        <span class="keyword">if</span> (i + j < length) {
          <span class="type">char</span> c = data[i + j];
          Serial.<span class="function-name">print</span>((c >= 32 && c < 127) ? c : '.');
        }
      }
      
      Serial.<span class="function-name">println</span>();
    }
  }
  
<span class="keyword">private</span>:
  <span class="type">const</span> <span class="type">char</span>* <span class="function-name">getLevelString</span>(LogLevel niveau) {
    <span class="keyword">switch</span>(niveau) {
      <span class="keyword">case</span> LOG_ERROR: <span class="keyword">return</span> "ERR";
      <span class="keyword">case</span> LOG_WARN: <span class="keyword">return</span> "WRN";
      <span class="keyword">case</span> LOG_INFO: <span class="keyword">return</span> "INF";
      <span class="keyword">case</span> LOG_DEBUG: <span class="keyword">return</span> "DBG";
      <span class="keyword">default</span>: <span class="keyword">return</span> "VRB";
    }
  }
};

<span class="comment">// Utilisation</span>
Logger logger(LOG_DEBUG);

<span class="type">void</span> <span class="function-name">setup</span>() {
  Serial.<span class="function-name">begin</span>(115200);
  logger.<span class="function-name">log</span>(LOG_INFO, "D√©marrage syst√®me");
  
  <span class="comment">// Dump m√©moire</span>
  <span class="type">uint8_t</span> testData[] = {0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77};
  logger.<span class="function-name">hexDump</span>(testData, <span class="keyword">sizeof</span>(testData));
}</code></pre>
  </div>
</section>
<!-- =========================================== -->
<!-- SECTION MULTIT√ÇCHE FREERTOS -->
<!-- =========================================== -->
<section id="multitache">
  <h2>Multit√¢che avec FreeRTOS sur ESP32</h2>
  <p>L'ESP32 utilise FreeRTOS pour ex√©cuter plusieurs t√¢ches simultan√©ment.</p>

  <h3>Cr√©ation de t√¢ches</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Multit√¢che avec FreeRTOS
*/</span>
<span class="code-keyword">#include</span> &lt;Arduino.h&gt;

<span class="code-comment">// Poign√©es de t√¢ches</span>
TaskHandle_t Task1;
TaskHandle_t Task2;

<span class="code-comment">// Broches LED</span>
<span class="code-keyword">const</span> <span class="code-keyword">int</span> led1 = 2;
<span class="code-keyword">const</span> <span class="code-keyword">int</span> led2 = 4;

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(115200);
  
  <span class="code-function">pinMode</span>(led1, OUTPUT);
  <span class="code-function">pinMode</span>(led2, OUTPUT);

  <span class="code-comment">// Cr√©ation des t√¢ches</span>
  <span class="comment">// xTaskCreate(fonction, nom, taille pile, param√®tres, priorit√©, handle)</span>
  xTaskCreate(
    tacheLED1,      <span class="code-comment">// Fonction</span>
    "Tache_LED_1",  <span class="code-comment">// Nom</span>
    10000,          <span class="code-comment">// Taille pile (bytes)</span>
    NULL,           <span class="code-comment">// Param√®tres</span>
    1,              <span class="code-comment">// Priorit√© (1-24)</span>
    &Task1          <span class="code-comment">// Handle</span>
  );

  xTaskCreate(
    tacheLED2,
    "Tache_LED_2",
    10000,
    NULL,
    1,
    &Task2
  );

  Serial.<span class="code-function">println</span>(<span class="code-string">"T√¢ches cr√©√©es"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="comment">// T√¢che principale (core 1)</span>
  <span class="function-name">delay</span>(1000);
  Serial.<span class="function-name">print</span>("Core principal: ");
  Serial.<span class="function-name">println</span>(xPortGetCoreID());
}

<span class="comment">// T√¢che 1 (LED clignotante rapide)</span>
<span class="type">void</span> <span class="function-name">tacheLED1</span>(<span class="type">void</span>* parameter) {
  Serial.<span class="function-name">print</span>("Tache 1 d√©marr√©e sur core: ");
  Serial.<span class="function-name">println</span>(xPortGetCoreID());
  
  <span class="keyword">for</span>(;;) {
    <span class="function-name">digitalWrite</span>(led1, HIGH);
    <span class="function-name">vTaskDelay</span>(100 / portTICK_PERIOD_MS);
    <span class="function-name">digitalWrite</span>(led1, LOW);
    <span class="function-name">vTaskDelay</span>(900 / portTICK_PERIOD_MS);
  }
}

<span class="comment">// T√¢che 2 (LED clignotante lente)</span>
<span class="type">void</span> <span class="function-name">tacheLED2</span>(<span class="type">void</span>* parameter) {
  Serial.<span class="function-name">print</span>("Tache 2 d√©marr√©e sur core: ");
  Serial.<span class="function-name">println</span>(xPortGetCoreID());
  
  <span class="keyword">for</span>(;;) {
    <span class="function-name">digitalWrite</span>(led2, HIGH);
    <span class="function-name">vTaskDelay</span>(500 / portTICK_PERIOD_MS);
    <span class="function-name">digitalWrite</span>(led2, LOW);
    <span class="function-name">vTaskDelay</span>(1500 / portTICK_PERIOD_MS);
    
    <span class="comment">// Communication inter-t√¢che</span>
    <span class="keyword">static</span> <span class="type">int</span> compteur = 0;
    compteur++;
    <span class="keyword">if</span> (compteur % 10 == 0) {
      Serial.<span class="function-name">print</span>("Tache 2 compteur: ");
      Serial.<span class="function-name">println</span>(compteur);
    }
  }
}</code></pre>
  </div>

  <h3>Queues et S√©maphores</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Communication inter-t√¢ches avec queue
*/</span>
<span class="code-keyword">#include</span> &lt;Arduino.h&gt;

<span class="comment">// Queue pour communication</span>
QueueHandle_t queue;

<span class="type">void</span> <span class="function-name">setup</span>() {
  Serial.<span class="function-name">begin</span>(115200);
  
  <span class="comment">// Cr√©ation queue (10 √©l√©ments de 20 bytes)</span>
  queue = xQueueCreate(10, sizeof(<span class="type">int</span>));
  
  <span class="function-name">xTaskCreate</span>(tacheProducteur, "Producteur", 10000, NULL, 1, NULL);
  <span class="function-name">xTaskCreate</span>(tacheConsommateur, "Consommateur", 10000, NULL, 1, NULL);
}

<span class="type">void</span> <span class="function-name">loop</span>() {
  <span class="function-name">vTaskDelete</span>(NULL); <span class="comment">// Supprime la t√¢che loop car inutile</span>
}

<span class="type">void</span> <span class="function-name">tacheProducteur</span>(<span class="type">void</span>* parameter) {
  <span class="type">int</span> valeur = 0;
  
  <span class="keyword">for</span>(;;) {
    valeur++;
    
    <span class="comment">// Envoi dans la queue (attente max 100ms)</span>
    <span class="keyword">if</span> (<span class="function-name">xQueueSend</span>(queue, &valeur, 100 / portTICK_PERIOD_MS) == pdPASS) {
      Serial.<span class="function-name">print</span>("Produit: ");
      Serial.<span class="function-name">println</span>(valeur);
    }
    
    <span class="function-name">vTaskDelay</span>(1000 / portTICK_PERIOD_MS);
  }
}

<span class="type">void</span> <span class="function-name">tacheConsommateur</span>(<span class="type">void</span>* parameter) {
  <span class="type">int</span> valeurRecue;
  
  <span class="keyword">for</span>(;;) {
    <span class="comment">// R√©ception depuis la queue (attente infinie)</span>
    <span class="keyword">if</span> (<span class="function-name">xQueueReceive</span>(queue, &valeurRecue, portMAX_DELAY) == pdPASS) {
      Serial.<span class="function-name">print</span>("Consomm√©: ");
      Serial.<span class="function-name">println</span>(valeurRecue);
    }
  }
}</code></pre>
  </div>
</section>


<!-- =========================================== -->
<!-- SECTION SSL/TLS -->
<!-- =========================================== -->
<section id="ssl-tls">
  <h2>S√©curisation communications avec SSL/TLS</h2>
  <p>Impl√©mentation HTTPS et MQTTS s√©curis√©s.</p>

  <h3>HTTPS avec certificats</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Client HTTPS s√©curis√©
*/</span>
<span class="code-keyword">#include</span> &lt;WiFi.h&gt;
<span class="code-keyword">#include</span> &lt;WiFiClientSecure.h&gt;
<span class="code-keyword">#include</span> &lt;HTTPClient.h&gt;

<span class="comment">// Certificat racine pour api.github.com (extrait)</span>
<span class="keyword">const</span> <span class="type">char</span> github_cert[] PROGMEM = R"CERT(
-----BEGIN CERTIFICATE-----
MIIEkjCCA3qgAwIBAgIQCgFBQgAAAVOFc2oLheynCDANBgkqhkiG9w0BAQsFADA/
MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT
DkRTVCBSb290IENBIFgzMB4XDTE2MDMxNzE2NDA0NloXDTIxMDMxNzE2NDA0Nlow
SjELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUxldCdzIEVuY3J5cHQxIzAhBgNVBAMT
GkxldCdzIEVuY3J5cHQgQXV0aG9yaXR5IFgzMIIBIjANBgkqhkiG9w0BAQEFAAOC
...
-----END CERTIFICATE-----
)CERT";

WiFiClientSecure client;
HTTPClient https;

<span class="type">void</span> <span class="function-name">setup</span>() {
  Serial.<span class="function-name">begin</span>(115200);
  WiFi.<span class="function-name">begin</span>(SSID, PASS);
  
  <span class="keyword">while</span> (WiFi.<span class="function-name">status</span>() != WL_CONNECTED) {
    <span class="function-name">delay</span>(500);
    Serial.<span class="function-name">print</span>(".");
  }
  
  <span class="comment">// Configuration SSL</span>
  client.<span class="function-name">setCACert</span>(github_cert);
  
  <span class="comment">// Options suppl√©mentaires</span>
  client.<span class="function-name">setTimeout</span>(10000);
  client.<span class="function-name">setInsecure</span>(); <span class="comment">// DANGEREUX! seulement pour dev</span>
  
  <span class="comment">// Requ√™te HTTPS</span>
  <span class="function-name">requeteHTTPS</span>();
}

<span class="type">void</span> <span class="function-name">requeteHTTPS</span>() {
  https.<span class="function-name">begin</span>(client, "https://api.github.com/repos/espressif/arduino-esp32");
  
  <span class="comment">// Headers</span>
  https.<span class="function-name">addHeader</span>("User-Agent", "ESP32-HTTPS-Client");
  https.<span class="function-name">addHeader</span>("Accept", "application/json");
  
  <span class="type">int</span> httpCode = https.<span class="function-name">GET</span>();
  
  <span class="keyword">if</span> (httpCode > 0) {
    Serial.<span class="function-name">printf</span>("Code HTTP: %d\n", httpCode);
    
    <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) {
      <span class="type">String</span> payload = https.<span class="function-name">getString</span>();
      Serial.<span class="function-name">println</span>("R√©ponse:");
      Serial.<span class="function-name">println</span>(payload);
    }
  } <span class="keyword">else</span> {
    Serial.<span class="function-name">printf</span>("Erreur: %s\n", https.<span class="function-name">errorToString</span>(httpCode).<span class="function-name">c_str</span>());
  }
  
  https.<span class="function-name">end</span>();
}</code></pre>
  </div>

  <h3>Gestion certificats dans LittleFS</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Chargement certificats depuis LittleFS
*/</span>
<span class="keyword">bool</span> <span class="function-name">chargerCertificat</span>(<span class="type">const</span> <span class="type">char</span>* chemin) {
  File file = LittleFS.<span class="function-name">open</span>(chemin, "r");
  
  <span class="keyword">if</span> (!file) {
    Serial.<span class="function-name">println</span>("Erreur ouverture certificat");
    <span class="keyword">return</span> <span class="keyword">false</span>;
  }
  
  <span class="comment">// Lecture certificat</span>
  <span class="type">String</span> cert = file.<span class="function-name">readString</span>();
  file.<span class="function-name">close</span>();
  
  <span class="comment">// Application</span>
  <span class="keyword">if</span> (!client.<span class="function-name">setCACert</span>(cert.<span class="function-name">c_str</span>())) {
    Serial.<span class="function-name">println</span>("Erreur chargement certificat");
    <span class="keyword">return</span> <span class="keyword">false</span>;
  }
  
  Serial.<span class="function-name">println</span>("Certificat charg√© depuis LittleFS");
  <span class="keyword">return</span> <span class="keyword">true</span>;
}

<span class="type">void</span> <span class="function-name">genererCertificatAutoSigne</span>() {
  <span class="comment">// G√©n√©ration cl√© RSA (d√©mo seulement - en prod utiliser openssl)</span>
  <span class="type">mbedtls_pk_context</span> pk;
  <span class="function-name">mbedtls_pk_init</span>(&pk);
  
  <span class="comment">// G√©n√©ration cl√©</span>
  <span class="function-name">mbedtls_rsa_context</span> rsa;
  <span class="function-name">mbedtls_rsa_init</span>(&rsa, MBEDTLS_RSA_PKCS_V15, 0);
  
  <span class="comment">// G√©n√©ration auto-sign√©e (simplifi√©e)</span>
  <span class="type">mbedtls_x509write_cert</span> crt;
  <span class="function-name">mbedtls_x509write_crt_init</span>(&crt);
  
  <span class="comment">// Configuration certificat</span>
  <span class="function-name">mbedtls_x509write_crt_set_subject_key</span>(&crt, &pk);
  <span class="function-name">mbedtls_x509write_crt_set_issuer_key</span>(&crt, &pk);
  
  <span class="comment">// Sauvegarde dans LittleFS</span>
  File file = LittleFS.<span class="function-name">open</span>("/cert.pem", "w");
  <span class="comment">// √âcriture PEM...</span>
  file.<span class="function-name">close</span>();
  
  <span class="function-name">mbedtls_x509write_crt_free</span>(&crt);
  <span class="function-name">mbedtls_pk_free</span>(&pk);
}</code></pre>
  </div>
</section>


<!-- =========================================== -->
<!-- SECTION AUTHENTIFICATION -->
<!-- =========================================== -->
<section id="authentification">
  <h2>Syst√®mes d'authentification s√©curis√©s</h2>
  <p>JWT, OAuth2, API keys pour s√©curiser vos APIs.</p>

  <h3>JWT (JSON Web Tokens)</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
G√©n√©ration et validation JWT
*/</span>
<span class="code-keyword">#include</span> &lt;ArduinoJson.h&gt;
<span class="code-keyword">#include</span> &lt;mbedtls/md.h&gt;

<span class="keyword">class</span> <span class="class-name">JWT</span> {
<span class="keyword">private</span>:
  <span class="type">String</span> secret = "votre_secret_super_securise";
  
<span class="keyword">public</span>:
  <span class="type">String</span> <span class="function-name">creerToken</span>(<span class="type">const</span> <span class="type">String</span>& userId, <span class="type">int</span> dureeHeures = 24) {
    <span class="comment">// Header</span>
    <span class="type">String</span> header = <span class="function-name">base64UrlEncode</span>("{\"alg\":\"HS256\",\"typ\":\"JWT\"}");
    
    <span class="comment">// Payload</span>
    <span class="type">unsigned</span> <span class="type">long</span> iat = <span class="function-name">time</span>(<span class="keyword">nullptr</span>);
    <span class="type">unsigned</span> <span class="type">long</span> exp = iat + (dureeHeures * 3600);
    
    DynamicJsonDocument payloadDoc(256);
    payloadDoc["sub"] = userId;
    payloadDoc["iat"] = iat;
    payloadDoc["exp"] = exp;
    payloadDoc["role"] = "user";
    
    <span class="type">String</span> payloadStr;
    <span class="function-name">serializeJson</span>(payloadDoc, payloadStr);
    <span class="type">String</span> payload = <span class="function-name">base64UrlEncode</span>(payloadStr);
    
    <span class="comment">// Signature</span>
    <span class="type">String</span> data = header + "." + payload;
    <span class="type">String</span> signature = <span class="function-name">signerHMAC</span>(data, secret);
    
    <span class="keyword">return</span> data + "." + signature;
  }
  
  <span class="keyword">bool</span> <span class="function-name">validerToken</span>(<span class="type">const</span> <span class="type">String</span>& token) {
    <span class="type">int</span> firstDot = token.<span class="function-name">indexOf</span>('.');
    <span class="type">int</span> secondDot = token.<span class="function-name">indexOf</span>('.', firstDot + 1);
    
    <span class="keyword">if</span> (firstDot == -1 || secondDot == -1) {
      <span class="keyword">return</span> <span class="keyword">false</span>;
    }
    
    <span class="type">String</span> header = token.<span class="function-name">substring</span>(0, firstDot);
    <span class="type">String</span> payload = token.<span class="function-name">substring</span>(firstDot + 1, secondDot);
    <span class="type">String</span> signature = token.<span class="function-name">substring</span>(secondDot + 1);
    
    <span class="comment">// V√©rification signature</span>
    <span class="type">String</span> data = header + "." + payload;
    <span class="type">String</span> signatureCalculee = <span class="function-name">signerHMAC</span>(data, secret);
    
    <span class="keyword">if</span> (signature != signatureCalculee) {
      <span class="keyword">return</span> <span class="keyword">false</span>;
    }
    
    <span class="comment">// V√©rification expiration</span>
    <span class="type">String</span> payloadDecode = <span class="function-name">base64UrlDecode</span>(payload);
    DynamicJsonDocument payloadDoc(256);
    <span class="type">DeserializationError</span> error = <span class="function-name">deserializeJson</span>(payloadDoc, payloadDecode);
    
    <span class="keyword">if</span> (error) {
      <span class="keyword">return</span> <span class="keyword">false</span>;
    }
    
    <span class="type">unsigned</span> <span class="type">long</span> exp = payloadDoc["exp"];
    <span class="type">unsigned</span> <span class="type">long</span> now = <span class="function-name">time</span>(<span class="keyword">nullptr</span>);
    
    <span class="keyword">return</span> exp > now;
  }
  
<span class="keyword">private</span>:
  <span class="type">String</span> <span class="function-name">base64UrlEncode</span>(<span class="type">const</span> <span class="type">String</span>& input) {
    <span class="comment">// Impl√©mentation base64 URL safe</span>
    <span class="type">String</span> output = input;
    output.<span class="function-name">replace</span>("+", "-");
    output.<span class="function-name">replace</span>("/", "_");
    output.<span class="function-name">replace</span>("=", "");
    <span class="keyword">return</span> output;
  }
  
  <span class="type">String</span> <span class="function-name">signerHMAC</span>(<span class="type">const</span> <span class="type">String</span>& data, <span class="type">const</span> <span class="type">String</span>& key) {
    <span class="type">unsigned</span> <span class="type">char</span> hmacResult[32];
    
    <span class="function-name">mbedtls_md_context_t</span> ctx;
    <span class="function-name">mbedtls_md_init</span>(&ctx);
    <span class="function-name">mbedtls_md_setup</span>(&ctx, <span class="function-name">mbedtls_md_info_from_type</span>(MBEDTLS_MD_SHA256), 1);
    <span class="function-name">mbedtls_md_hmac_starts</span>(&ctx, (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*)key.<span class="function-name">c_str</span>(), key.<span class="function-name">length</span>());
    <span class="function-name">mbedtls_md_hmac_update</span>(&ctx, (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*)data.<span class="function-name">c_str</span>(), data.<span class="function-name">length</span>());
    <span class="function-name">mbedtls_md_hmac_finish</span>(&ctx, hmacResult);
    <span class="function-name">mbedtls_md_free</span>(&ctx);
    
    <span class="comment">// Conversion en base64 URL</span>
    <span class="type">String</span> result;
    <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < 32; i++) {
      <span class="type">char</span> buf[3];
      <span class="function-name">sprintf</span>(buf, "%02x", hmacResult[i]);
      result += buf;
    }
    
    <span class="keyword">return</span> <span class="function-name">base64UrlEncode</span>(result);
  }
};

<span class="comment">// Utilisation</span>
JWT jwt;

<span class="type">void</span> <span class="function-name">setup</span>() {
  <span class="comment">// Cr√©ation token</span>
  <span class="type">String</span> token = jwt.<span class="function-name">creerToken</span>("user123", 24);
  Serial.<span class="function-name">print</span>("Token: ");
  Serial.<span class="function-name">println</span>(token);
  
  <span class="comment">// Validation</span>
  <span class="keyword">if</span> (jwt.<span class="function-name">validerToken</span>(token)) {
    Serial.<span class="function-name">println</span>("Token valide");
  } <span class="keyword">else</span> {
    Serial.<span class="function-name">println</span>("Token invalide");
  }
}</code></pre>
  </div>
</section>


<!-- =========================================== -->
<!-- SECTION CHIFFREMENT -->
<!-- =========================================== -->
<section id="chiffrement">
  <h2>Chiffrement des donn√©es sensibles</h2>
  <p>AES, RSA et techniques de s√©curisation.</p>

  <h3>AES-256 sur ESP32</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Chiffrement/d√©chiffrement AES-256
*/</span>
<span class="code-keyword">#include</span> &lt;mbedtls/aes.h&gt;

<span class="keyword">class</span> <span class="class-name">AES256</span> {
<span class="keyword">private</span>:
  <span class="type">unsigned</span> <span class="type">char</span> key[32]; <span class="comment">// 256 bits</span>
  <span class="type">unsigned</span> <span class="type">char</span> iv[16];  <span class="comment">// 128 bits</span>
  
<span class="keyword">public</span>:
  <span class="function-name">AES256</span>(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* keyData, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* ivData) {
    <span class="function-name">memcpy</span>(key, keyData, 32);
    <span class="function-name">memcpy</span>(iv, ivData, 16);
  }
  
  <span class="type">size_t</span> <span class="function-name">chiffrer</span>(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* input, <span class="type">size_t</span> inputLen, 
                   <span class="type">unsigned</span> <span class="type">char</span>* output) {
    mbedtls_aes_context aes;
    <span class="function-name">mbedtls_aes_init</span>(&aes);
    
    <span class="comment">// Chiffrement CBC</span>
    <span class="function-name">mbedtls_aes_setkey_enc</span>(&aes, key, 256);
    
    <span class="comment">// Padding PKCS7</span>
    <span class="type">size_t</span> paddedLen = ((inputLen / 16) + 1) * 16;
    <span class="type">unsigned</span> <span class="type">char</span>* paddedInput = <span class="keyword">new</span> <span class="type">unsigned</span> <span class="type">char</span>[paddedLen];
    <span class="function-name">memcpy</span>(paddedInput, input, inputLen);
    
    <span class="comment">// Ajout padding</span>
    <span class="type">unsigned</span> <span class="type">char</span> padValue = paddedLen - inputLen;
    <span class="keyword">for</span> (<span class="type">size_t</span> i = inputLen; i < paddedLen; i++) {
      paddedInput[i] = padValue;
    }
    
    <span class="comment">// Chiffrement</span>
    <span class="function-name">mbedtls_aes_crypt_cbc</span>(&aes, MBEDTLS_AES_ENCRYPT, paddedLen, 
                          iv, paddedInput, output);
    
    <span class="function-name">mbedtls_aes_free</span>(&aes);
    <span class="keyword">delete</span>[] paddedInput;
    
    <span class="keyword">return</span> paddedLen;
  }
  
  <span class="type">size_t</span> <span class="function-name">dechiffrer</span>(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* input, <span class="type">size_t</span> inputLen,
                     <span class="type">unsigned</span> <span class="type">char</span>* output) {
    <span class="keyword">if</span> (inputLen % 16 != 0) {
      <span class="keyword">return</span> 0; <span class="comment">// Taille invalide</span>
    }
    
    mbedtls_aes_context aes;
    <span class="function-name">mbedtls_aes_init</span>(&aes);
    
    <span class="comment">// D√©chiffrement CBC</span>
    <span class="function-name">mbedtls_aes_setkey_dec</span>(&aes, key, 256);
    <span class="function-name">mbedtls_aes_crypt_cbc</span>(&aes, MBEDTLS_AES_DECRYPT, inputLen,
                          iv, input, output);
    
    <span class="comment">// Suppression padding PKCS7</span>
    <span class="type">unsigned</span> <span class="type">char</span> padValue = output[inputLen - 1];
    <span class="keyword">if</span> (padValue > 16) {
      <span class="function-name">mbedtls_aes_free</span>(&aes);
      <span class="keyword">return</span> 0; <span class="comment">// Padding invalide</span>
    }
    
    <span class="comment">// V√©rification padding</span>
    <span class="keyword">for</span> (<span class="type">size_t</span> i = inputLen - padValue; i < inputLen; i++) {
      <span class="keyword">if</span> (output[i] != padValue) {
        <span class="function-name">mbedtls_aes_free</span>(&aes);
        <span class="keyword">return</span> 0;
      }
    }
    
    <span class="function-name">mbedtls_aes_free</span>(&aes);
    <span class="keyword">return</span> inputLen - padValue;
  }
};

<span class="comment">// Exemple utilisation</span>
<span class="type">void</span> <span class="function-name">setup</span>() {
  Serial.<span class="function-name">begin</span>(115200);
  
  <span class="comment">// Cl√© et IV (en production, g√©n√©rer al√©atoirement)</span>
  <span class="type">unsigned</span> <span class="type">char</span> key[32] = {
    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
    0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,
    0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
    0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E, 0x1F
  };
  
  <span class="type">unsigned</span> <span class="type">char</span> iv[16] = {
    0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
    0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F
  };
  
  AES256 aes(key, iv);
  
  <span class="comment">// Donn√©es √† chiffrer</span>
  <span class="type">const</span> <span class="type">char</span>* texteClair = "Donn√©es sensibles √† prot√©ger";
  <span class="type">size_t</span> longueur = <span class="function-name">strlen</span>(texteClair);
  
  <span class="comment">// Chiffrement</span>
  <span class="type">unsigned</span> <span class="type">char</span> texteChiffre[128];
  <span class="type">size_t</span> longueurChiffre = aes.<span class="function-name">chiffrer</span>(
    (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*)texteClair, 
    longueur, 
    texteChiffre
  );
  
  Serial.<span class="function-name">print</span>("Texte chiffr√© (hex): ");
  <span class="keyword">for</span> (<span class="type">size_t</span> i = 0; i < longueurChiffre; i++) {
    <span class="keyword">if</span> (texteChiffre[i] < 16) Serial.<span class="function-name">print</span>("0");
    Serial.<span class="function-name">print</span>(texteChiffre[i], HEX);
  }
  Serial.<span class="function-name">println</span>();
  
  <span class="comment">// D√©chiffrement</span>
  <span class="type">unsigned</span> <span class="type">char</span> texteDechiffre[128];
  <span class="type">size_t</span> longueurDechiffre = aes.<span class="function-name">dechiffrer</span>(
    texteChiffre, 
    longueurChiffre, 
    texteDechiffre
  );
  
  texteDechiffre[longueurDechiffre] = '\0';
  Serial.<span class="function-name">print</span>("Texte d√©chiffr√©: ");
  Serial.<span class="function-name">println</span>((<span class="type">char</span>*)texteDechiffre);
}</code></pre>
  </div>

  <h3>G√©n√©rateur de nombres al√©atoires s√©curis√©</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
G√©n√©ration s√©curis√©e de cl√©s
*/</span>
<span class="keyword">void</span> <span class="function-name">genererCleSecurisee</span>() {
  <span class="comment">// Utilisation du TRNG hardware ESP32</span>
  <span class="function-name">esp_fill_random</span>(key, 32);
  
  <span class="comment">// V√©rification qualit√© entropie</span>
  <span class="keyword">if</span> (<span class="function-name">esp_random</span>() != 0) {
    Serial.<span class="function-name">println</span>("TRNG actif");
  }
  
  <span class="comment">// Ajout entropie suppl√©mentaire</span>
  <span class="type">unsigned</span> <span class="type">long</span> seed = <span class="function-name">micros</span>() ^ <span class="function-name">esp_random</span>();
  <span class="function-name">srand</span>(seed);
  
  <span class="comment">// M√©lange suppl√©mentaire</span>
  <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < 32; i++) {
    key[i] ^= <span class="function-name">esp_random</span>() & 0xFF;
  }
}</code></pre>
  </div>
</section>


<!-- =========================================== -->
<!-- SECTION HOME ASSISTANT -->
<!-- =========================================== -->
<section id="home-assistant">
  <h2>Int√©gration avec Home Assistant</h2>
  <p>Connectez votre ESP32 √† Home Assistant pour la domotique.</p>

  <h3>Configuration MQTT Discovery</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
ESP32 + Home Assistant via MQTT Discovery
*/</span>
<span class="code-keyword">#include</span> &lt;WiFi.h&gt;
<span class="code-keyword">#include</span> &lt;PubSubClient.h&gt;

<span class="code-comment">// Configuration</span>
<span class="code-keyword">const</span> <span class="code-type">char</span>* mqtt_server = <span class="code-string">"homeassistant.local"</span>;
<span class="code-keyword">const</span> <span class="code-type">char</span>* mqtt_user = <span class="code-string">"mqtt"</span>;
<span class="code-keyword">const</span> <span class="code-type">char</span>* mqtt_password = <span class="code-string">"votre_mot_de_passe"</span>;

<span class="code-keyword">const</span> <span class="code-keyword">int</span> ledPin = 2;
<span class="code-keyword">bool</span> ledState = <span class="code-keyword">false</span>;

WiFiClient espClient;
PubSubClient client(espClient);

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(115200);
  <span class="code-function">pinMode</span>(ledPin, OUTPUT);
  
  <span class="code-function">setup_wifi</span>();
  client.<span class="code-function">setServer</span>(mqtt_server, 1883);
  client.<span class="code-function">setCallback</span>(callback);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-keyword">if</span> (!client.<span class="code-function">connected</span>()) {
    <span class="code-function">reconnect</span>();
  }
  client.<span class="code-function">loop</span>();
}

<span class="code-keyword">void</span> <span class="code-function">reconnect</span>() {
  <span class="keyword">while</span> (!client.<span class="function-name">connected</span>()) {
    Serial.<span class="function-name">print</span>("Connexion MQTT...");
    
    <span class="type">String</span> clientId = "ESP32Client-";
    clientId += <span class="function-name">String</span>(<span class="function-name">random</span>(0xffff), HEX);
    
    <span class="keyword">if</span> (client.<span class="function-name">connect</span>(clientId.<span class="function-name">c_str</span>(), mqtt_user, mqtt_password)) {
      Serial.<span class="function-name">println</span>("connect√©");
      
      <span class="comment">// Publication configuration auto-discovery</span>
      <span class="function-name">publishDiscoveryConfig</span>();
      
      <span class="comment">// Abonnement aux topics de commande</span>
      client.<span class="function-name">subscribe</span>("home/bureau/led/command");
    } <span class="keyword">else</span> {
      Serial.<span class="function-name">print</span>("√©chec, rc=");
      Serial.<span class="function-name">print</span>(client.<span class="function-name">state</span>());
      Serial.<span class="function-name">println</span>(" r√©essai dans 5s");
      <span class="function-name">delay</span>(5000);
    }
  }
}

<span class="type">void</span> <span class="function-name">publishDiscoveryConfig</span>() {
  <span class="comment">// Configuration auto-discovery pour Home Assistant</span>
  <span class="type">String</span> discoveryTopic = "homeassistant/light/bureau_led/config";
  
  <span class="type">String</span> config = "{";
  config += "\"name\":\"Lampe Bureau\",";
  config += "\"unique_id\":\"esp32_bureau_led\",";
  config += "\"command_topic\":\"home/bureau/led/command\",";
  config += "\"state_topic\":\"home/bureau/led/state\",";
  config += "\"brightness\":false,";
  config += "\"retain\":true,";
  config += "\"device\":{";
  config += "\"identifiers\":[\"esp32_bureau\"],";
  config += "\"name\":\"ESP32 Bureau\",";
  config += "\"manufacturer\":\"DIY\",";
  config += "\"model\":\"ESP32\"";
  config += "}}";
  
  client.<span class="function-name">publish</span>(discoveryTopic.<span class="function-name">c_str</span>(), config.<span class="function-name">c_str</span>(), <span class="keyword">true</span>);
  Serial.<span class="function-name">println</span>("Configuration discovery publi√©e");
}

<span class="type">void</span> <span class="function-name">callback</span>(<span class="type">char</span>* topic, <span class="type">byte</span>* payload, <span class="type">unsigned</span> <span class="type">int</span> length) {
  <span class="type">String</span> message;
  <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < length; i++) {
    message += (<span class="type">char</span>)payload[i];
  }
  
  Serial.<span class="function-name">print</span>("Message re√ßu: ");
  Serial.<span class="function-name">println</span>(message);
  
  <span class="keyword">if</span> (message == "ON") {
    <span class="function-name">digitalWrite</span>(ledPin, HIGH);
    ledState = <span class="keyword">true</span>;
  } <span class="keyword">else if</span> (message == "OFF") {
    <span class="function-name">digitalWrite</span>(ledPin, LOW);
    ledState = <span class="keyword">false</span>;
  }
  
  <span class="comment">// Publication √©tat</span>
  client.<span class="function-name">publish</span>("home/bureau/led/state", ledState ? "ON" : "OFF", <span class="keyword">true</span>);
}</code></pre>
  </div>
</section>
<!-- =========================================== -->
<!-- SECTION NODE-RED -->
<!-- =========================================== -->
<section id="node-red">
  <h2>Int√©gration avec Node-RED</h2>
  <p>Cr√©ez des flux IoT visuels avec Node-RED.</p>

  <h3>ESP32 comme n≈ìud MQTT pour Node-RED</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Communication ESP32 avec Node-RED via MQTT
*/</span>
<span class="code-keyword">#include</span> &lt;WiFi.h&gt;
<span class="code-keyword">#include</span> &lt;PubSubClient.h&gt;

<span class="comment">// Topics Node-RED</span>
<span class="keyword">const</span> <span class="type">char</span>* TOPIC_TEMP = "sensors/bureau/temperature";
<span class="keyword">const</span> <span class="type">char</span>* TOPIC_HUMIDITY = "sensors/bureau/humidity";
<span class="keyword">const</span> <span class="type">char</span>* TOPIC_LED_CMD = "actuators/bureau/led/cmd";
<span class="keyword">const</span> <span class="type">char</span>* TOPIC_LED_STATE = "actuators/bureau/led/state";

WiFiClient espClient;
PubSubClient client(espClient);

<span class="type">float</span> temperature = 0;
<span class="type">float</span> humidity = 0;
<span class="type">bool</span> ledState = <span class="keyword">false</span>;

<span class="type">void</span> <span class="function-name">setup</span>() {
  Serial.<span class="function-name">begin</span>(115200);
  <span class="function-name">setupWiFi</span>();
  
  client.<span class="function-name">setServer</span>("192.168.1.100", 1883); <span class="comment">// IP Node-RED</span>
  client.<span class="function-name">setCallback</span>(mqttCallback);
  
  <span class="comment">// Configuration p√©riodique</span>
  <span class="function-name">xTaskCreate</span>(
    tacheCapteurs,
    "Capteurs",
    4096,
    <span class="keyword">nullptr</span>,
    1,
    <span class="keyword">nullptr</span>
  );
}

<span class="type">void</span> <span class="function-name">loop</span>() {
  <span class="keyword">if</span> (!client.<span class="function-name">connected</span>()) {
    <span class="function-name">reconnectMQTT</span>();
  }
  client.<span class="function-name">loop</span>();
}

<span class="type">void</span> <span class="function-name">tacheCapteurs</span>(<span class="type">void</span>* parameter) {
  <span class="keyword">for</span>(;;) {
    <span class="comment">// Lecture capteurs (simul√©e)</span>
    temperature = 20.0 + (<span class="function-name">random</span>(-100, 100) / 100.0);
    humidity = 50.0 + (<span class="function-name">random</span>(-200, 200) / 100.0);
    
    <span class="comment">// Publication vers Node-RED</span>
    <span class="function-name">publierDonnees</span>();
    
    <span class="function-name">vTaskDelay</span>(5000 / portTICK_PERIOD_MS);
  }
}

<span class="type">void</span> <span class="function-name">publierDonnees</span>() {
  <span class="comment">// Format JSON pour Node-RED</span>
  <span class="type">char</span> payload[128];
  <span class="function-name">sprintf</span>(payload, 
           "{\"temperature\":%.1f,\"humidity\":%.1f,\"location\":\"bureau\"}",
           temperature, humidity);
  
  client.<span class="function-name">publish</span>(TOPIC_TEMP, payload);
  
  <span class="comment">// Publication s√©par√©e pour dashboard</span>
  <span class="type">char</span> tempStr[10];
  <span class="function-name">dtostrf</span>(temperature, 1, 1, tempStr);
  client.<span class="function-name">publish</span>("dashboard/temperature", tempStr);
}

<span class="type">void</span> <span class="function-name">mqttCallback</span>(<span class="type">char</span>* topic, <span class="type">byte</span>* payload, <span class="type">unsigned</span> <span class="type">int</span> length) {
  <span class="type">String</span> message;
  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">int</span> i = 0; i < length; i++) {
    message += (<span class="type">char</span>)payload[i];
  }
  
  Serial.<span class="function-name">print</span>("Message Node-RED: ");
  Serial.<span class="function-name">println</span>(message);
  
  <span class="keyword">if</span> (<span class="function-name">strcmp</span>(topic, TOPIC_LED_CMD) == 0) {
    <span class="keyword">if</span> (message == "ON") {
      ledState = <span class="keyword">true</span>;
      <span class="function-name">digitalWrite</span>(LED_BUILTIN, HIGH);
    } <span class="keyword">else</span> <span class="keyword">if</span> (message == "OFF") {
      ledState = <span class="keyword">false</span>;
      <span class="function-name">digitalWrite</span>(LED_BUILTIN, LOW);
    }
    
    <span class="comment">// Retour √©tat</span>
    client.<span class="function-name">publish</span>(TOPIC_LED_STATE, ledState ? "ON" : "OFF");
  }
  
  <span class="comment">// Traitement commandes JSON</span>
  <span class="keyword">if</span> (message.<span class="function-name">indexOf</span>("{\"command\"") >= 0) {
    <span class="function-name">traiterCommandeJSON</span>(message);
  }
}</code></pre>
  </div>

  <h3>Flux Node-RED correspondant</h3>
  <div class="code-example">
    <h4>dashboard.json</h4>
    <pre><code><span class="code-comment">// Export flux Node-RED</span>
[
  {
    "id": "mqtt-in-temperature",
    "type": "mqtt in",
    "topic": "sensors/bureau/temperature",
    "broker": "mosquitto",
    "outputs": 1
  },
  {
    "id": "function-parse-json",
    "type": "function",
    "func": "msg.payload = JSON.parse(msg.payload);\nreturn msg;"
  },
  {
    "id": "gauge-temperature",
    "type": "ui_gauge",
    "group": "dashboard",
    "order": 1,
    "title": "Temp√©rature Bureau"
  },
  {
    "id": "button-led-control",
    "type": "ui_button",
    "group": "dashboard",
    "order": 2,
    "label": "LED Bureau",
    "payload": "TOGGLE",
    "topic": "actuators/bureau/led/cmd"
  },
  {
    "id": "mqtt-out-led",
    "type": "mqtt out",
    "topic": "actuators/bureau/led/cmd",
    "broker": "mosquitto"
  },
  {
    "id": "mqtt-in-led-state",
    "type": "mqtt in",
    "topic": "actuators/bureau/led/state",
    "broker": "mosquitto"
  },
  {
    "id": "switch-led-state",
    "type": "switch",
    "property": "payload",
    "rules": [
      {"t": "eq", "v": "ON", "dt": "1"},
      {"t": "eq", "v": "OFF", "dt": "2"}
    ]
  },
  {
    "id": "change-led-on",
    "type": "change",
    "rules": [
      {"t": "set", "p": "payload", "pt": "msg", "to": "LED ON"}
    ]
  },
  {
    "id": "text-led-status",
    "type": "ui_text",
    "group": "dashboard",
    "order": 3,
    "label": "Statut LED"
  }
]</code></pre>
  </div>
</section>
<!-- =========================================== -->
<!-- SECTION AWS IOT / AZURE -->
<!-- =========================================== -->
<section id="aws-iot">
  <h2>Int√©gration Cloud AWS IoT / Azure IoT</h2>
  <p>Connectez votre ESP32 aux plateformes cloud IoT professionnelles.</p>

  <h3>AWS IoT Core avec ESP32</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Connection ESP32 √† AWS IoT Core
*/</span>
<span class="code-keyword">#include</span> &lt;WiFiClientSecure.h&gt;
<span class="code-keyword">#include</span> &lt;PubSubClient.h&gt;
<span class="code-keyword">#include</span> &lt;ArduinoJson.h&gt;

<span class="comment">// Certificats AWS (stock√©s dans LittleFS)</span>
<span class="keyword">extern</span> <span class="type">const</span> <span class="type">uint8_t</span> aws_cert_ca[] PROGMEM;
<span class="keyword">extern</span> <span class="type">const</span> <span class="type">uint8_t</span> aws_cert_crt[] PROGMEM;
<span class="keyword">extern</span> <span class="type">const</span> <span class="type">uint8_t</span> aws_cert_private[] PROGMEM;

<span class="comment">// Configuration AWS</span>
<span class="keyword">const</span> <span class="type">char</span>* awsEndpoint = "<span class="code-string">votre-compte-ats.iot.region.amazonaws.com</span>";
<span class="keyword">const</span> <span class="type">char</span>* clientId = "ESP32-Thing";
<span class="keyword">const</span> <span class="type">int</span> awsPort = 8883;

WiFiClientSecure net;
PubSubClient client(net);

<span class="type">void</span> <span class="function-name">setup</span>() {
  Serial.<span class="function-name">begin</span>(115200);
  
  <span class="comment">// Connexion WiFi</span>
  <span class="function-name">connexionWiFi</span>();
  
  <span class="comment">// Configuration TLS</span>
  net.<span class="function-name">setCACert</span>(aws_cert_ca);
  net.<span class="function-name">setCertificate</span>(aws_cert_crt);
  net.<span class="function-name">setPrivateKey</span>(aws_cert_private);
  
  <span class="comment">// Configuration MQTT</span>
  client.<span class="function-name">setServer</span>(awsEndpoint, awsPort);
  client.<span class="function-name">setCallback</span>(awsCallback);
  
  <span class="comment">// Connexion AWS</span>
  <span class="function-name">connexionAWS</span>();
}

<span class="type">void</span> <span class="function-name">loop</span>() {
  <span class="keyword">if</span> (!client.<span class="function-name">connected</span>()) {
    <span class="function-name">reconnectAWS</span>();
  }
  client.<span class="function-name">loop</span>();
  
  <span class="comment">// Publication p√©riodique</span>
  <span class="keyword">static</span> <span class="type">unsigned</span> <span class="type">long</span> lastPublish = 0;
  <span class="keyword">if</span> (<span class="function-name">millis</span>() - lastPublish > 30000) {
    lastPublish = <span class="function-name">millis</span>();
    <span class="function-name">publierDonneesAWS</span>();
  }
}

<span class="type">void</span> <span class="function-name">connexionAWS</span>() {
  <span class="keyword">while</span> (!client.<span class="function-name">connected</span>()) {
    Serial.<span class="function-name">print</span>("Connexion AWS IoT...");
    
    <span class="keyword">if</span> (client.<span class="function-name">connect</span>(clientId)) {
      Serial.<span class="function-name">println</span>("connect√©");
      
      <span class="comment">// Abonnement topics</span>
      client.<span class="function-name">subscribe</span>("$aws/things/ESP32-Thing/shadow/update/accepted");
      client.<span class="function-name">subscribe</span>("$aws/things/ESP32-Thing/shadow/update/rejected");
      client.<span class="function-name">subscribe</span>("cmd/esp32");
    } <span class="keyword">else</span> {
      Serial.<span class="function-name">print</span>("√©chec, rc=");
      Serial.<span class="function-name">print</span>(client.<span class="function-name">state</span>());
      Serial.<span class="function-name">println</span>(" r√©essai dans 5s");
      <span class="function-name">delay</span>(5000);
    }
  }
}

<span class="type">void</span> <span class="function-name">publierDonneesAWS</span>() {
  <span class="comment">// Cr√©ation message Shadow</span>
  DynamicJsonDocument shadow(512);
  JsonObject state = shadow.<span class="function-name">createNestedObject</span>("state");
  JsonObject reported = state.<span class="function-name">createNestedObject</span>("reported");
  
  reported["temperature"] = <span class="function-name">lireTemperature</span>();
  reported["humidity"] = <span class="function-name">lireHumidite</span>();
  reported["battery"] = <span class="function-name">lireBatterie</span>();
  reported["timestamp"] = <span class="function-name">millis</span>();
  
  <span class="type">char</span> jsonBuffer[512];
  <span class="function-name">serializeJson</span>(shadow, jsonBuffer);
  
  <span class="comment">// Publication Shadow Update</span>
  <span class="type">bool</span> published = client.<span class="function-name">publish</span>(
    "$aws/things/ESP32-Thing/shadow/update",
    jsonBuffer
  );
  
  <span class="keyword">if</span> (published) {
    Serial.<span class="function-name">println</span>("Shadow mis √† jour");
  } <span class="keyword">else</span> {
    Serial.<span class="function-name">println</span>("√âchec publication Shadow");
  }
}

<span class="type">void</span> <span class="function-name">awsCallback</span>(<span class="type">char</span>* topic, <span class="type">byte</span>* payload, <span class="type">unsigned</span> <span class="type">int</span> length) {
  Serial.<span class="function-name">print</span>("Message AWS: ");
  Serial.<span class="function-name">println</span>(topic);
  
  <span class="type">String</span> message;
  <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">int</span> i = 0; i < length; i++) {
    message += (<span class="type">char</span>)payload[i];
  }
  
  <span class="comment">// Traitement commande Shadow</span>
  <span class="keyword">if</span> (<span class="function-name">strstr</span>(topic, "shadow/update/accepted")) {
    DynamicJsonDocument doc(512);
    <span class="type">DeserializationError</span> error = <span class="function-name">deserializeJson</span>(doc, message);
    
    <span class="keyword">if</span> (!error) {
      <span class="keyword">if</span> (doc.<span class="function-name">containsKey</span>("state")) {
        JsonObject state = doc["state"];
        <span class="keyword">if</span> (state.<span class="function-name">containsKey</span>("desired")) {
          JsonObject desired = state["desired"];
          
          <span class="comment">// Ex√©cution commandes d√©sir√©es</span>
          <span class="keyword">if</span> (desired.<span class="function-name">containsKey</span>("led")) {
            <span class="type">bool</span> ledState = desired["led"];
            <span class="function-name">digitalWrite</span>(LED_BUILTIN, ledState);
          }
          
          <span class="comment">// Mise √† jour reported</span>
          <span class="function-name">publierDonneesAWS</span>();
        }
      }
    }
  }
}</code></pre>
  </div>

  <h3>Azure IoT Hub</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Connection √† Azure IoT Hub
*/</span>
<span class="code-keyword">#include</span> &lt;AzureIoTHub.h&gt;
<span class="code-keyword">#include</span> &lt;AzureIoTProtocol_MQTT.h&gt;

<span class="comment">// Cha√Æne de connexion Azure</span>
<span class="keyword">static</span> <span class="type">const</span> <span class="type">char</span>* connectionString = 
  "HostName=votre-hub.azure-devices.net;"
  "DeviceId=esp32-device;"
  "SharedAccessKey=votre-cle";

IOTHUB_DEVICE_CLIENT_LL_HANDLE deviceHandle;

<span class="type">void</span> <span class="function-name">setup</span>() {
  Serial.<span class="function-name">begin</span>(115200);
  
  <span class="comment">// Initialisation Azure IoT</span>
  <span class="function-name">esp_log_level_set</span>("*", ESP_LOG_ERROR);
  
  <span class="keyword">if</span> (<span class="function-name">serializer_init</span>(<span class="keyword">NULL</span>) != SERIALIZER_OK) {
    Serial.<span class="function-name">println</span>("Erreur initialisation serializer");
    <span class="keyword">return</span>;
  }
  
  <span class="comment">// Cr√©ation client</span>
  deviceHandle = <span class="function-name">IoTHubDeviceClient_LL_CreateFromConnectionString</span>(
    connectionString, MQTT_Protocol
  );
  
  <span class="keyword">if</span> (deviceHandle == <span class="keyword">NULL</span>) {
    Serial.<span class="function-name">println</span>("Erreur cr√©ation client Azure");
    <span class="keyword">return</span>;
  }
  
  <span class="comment">// Configuration callbacks</span>
  <span class="function-name">IoTHubDeviceClient_LL_SetMessageCallback</span>(
    deviceHandle, messageCallback, <span class="keyword">NULL</span>
  );
  
  Serial.<span class="function-name">println</span>("Connect√© √† Azure IoT Hub");
}

<span class="type">void</span> <span class="function-name">loop</span>() {
  <span class="comment">// DoWork Azure</span>
  <span class="function-name">IoTHubDeviceClient_LL_DoWork</span>(deviceHandle);
  <span class="function-name">delay</span>(10);
  
  <span class="comment">// Envoi t√©l√©m√©trie</span>
  <span class="keyword">static</span> <span class="type">unsigned</span> <span class="type">long</span> lastSend = 0;
  <span class="keyword">if</span> (<span class="function-name">millis</span>() - lastSend > 10000) {
    lastSend = <span class="function-name">millis</span>();
    <span class="function-name">envoyerTelemetrie</span>();
  }
}

<span class="type">void</span> <span class="function-name">envoyerTelemetrie</span>() {
  <span class="type">char</span> messageBuffer[256];
  
  <span class="type">float</span> temperature = <span class="function-name">lireTemperature</span>();
  <span class="type">float</span> humidity = <span class="function-name">lireHumidite</span>();
  
  <span class="function-name">snprintf</span>(messageBuffer, <span class="keyword">sizeof</span>(messageBuffer),
           "{\"temperature\":%.1f,\"humidity\":%.1f,\"deviceId\":\"esp32\"}",
           temperature, humidity);
  
  IOTHUB_MESSAGE_HANDLE messageHandle = 
    <span class="function-name">IoTHubMessage_CreateFromByteArray</span>(
      (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*)messageBuffer, 
      <span class="function-name">strlen</span>(messageBuffer)
    );
  
  <span class="keyword">if</span> (messageHandle == <span class="keyword">NULL</span>) {
    Serial.<span class="function-name">println</span>("Erreur cr√©ation message");
    <span class="keyword">return</span>;
  }
  
  <span class="function-name">IoTHubDeviceClient_LL_SendEventAsync</span>(
    deviceHandle, 
    messageHandle, 
    sendCallback, 
    <span class="keyword">NULL</span>
  );
  
  <span class="function-name">IoTHubMessage_Destroy</span>(messageHandle);
}

<span class="type">void</span> <span class="function-name">sendCallback</span>(IOTHUB_CLIENT_CONFIRMATION_RESULT result, <span class="type">void</span>* context) {
  <span class="keyword">if</span> (result == IOTHUB_CLIENT_CONFIRMATION_OK) {
    Serial.<span class="function-name">println</span>("Message envoy√© √† Azure");
  } <span class="keyword">else</span> {
    Serial.<span class="function-name">println</span>("√âchec envoi Azure");
  }
}

<span class="type">static</span> IOTHUBMESSAGE_DISPOSITION_RESULT <span class="function-name">messageCallback</span>(
  IOTHUB_MESSAGE_HANDLE message, <span class="type">void</span>* context) {
  
  <span class="type">const</span> <span class="type">char</span>* buffer;
  <span class="type">size_t</span> size;
  
  <span class="keyword">if</span> (<span class="function-name">IoTHubMessage_GetByteArray</span>(message, (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>**)&buffer, &size) != IOTHUB_MESSAGE_OK) {
    <span class="keyword">return</span> IOTHUBMESSAGE_ABANDONED;
  }
  
  Serial.<span class="function-name">print</span>("Message Azure: ");
  Serial.<span class="function-name">println</span>(buffer);
  
  <span class="comment">// Traitement commande Cloud-to-Device</span>
  <span class="keyword">if</span> (<span class="function-name">strstr</span>(buffer, "\"command\":\"led_on\"")) {
    <span class="function-name">digitalWrite</span>(LED_BUILTIN, HIGH);
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="function-name">strstr</span>(buffer, "\"command\":\"led_off\"")) {
    <span class="function-name">digitalWrite</span>(LED_BUILTIN, LOW);
  }
  
  <span class="keyword">return</span> IOTHUBMESSAGE_ACCEPTED;
}</code></pre>
  </div>
</section>
<!-- =========================================== -->
<!-- SECTION API REST AVANC√âE -->
<!-- =========================================== -->
<section id="api-rest">
  <h2>API REST avanc√©e avec ESP32</h2>
  <p>Cr√©ez des APIs professionnelles avec authentification, versioning et documentation.</p>

  <h3>Framework API avec routing</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Framework API REST complet
*/</span>
<span class="code-keyword">#include</span> &lt;WebServer.h&gt;
<span class="code-keyword">#include</span> &lt;ArduinoJson.h&gt;

WebServer server(80);

<span class="comment">// Structure pour les routes</span>
<span class="keyword">struct</span> <span class="class-name">Route</span> {
  <span class="type">String</span> method;
  <span class="type">String</span> path;
  <span class="type">void</span> (*handler)();
};

<span class="type">Route</span> routes[] = {
  {"GET", "/api/v1/status", handleStatus},
  {"GET", "/api/v1/sensors", handleGetSensors},
  {"POST", "/api/v1/sensors", handlePostSensor},
  {"GET", "/api/v1/sensors/{id}", handleGetSensor},
  {"PUT", "/api/v1/sensors/{id}", handleUpdateSensor},
  {"DELETE", "/api/v1/sensors/{id}", handleDeleteSensor}
};

<span class="type">void</span> <span class="function-name">setup</span>() {
  Serial.<span class="function-name">begin</span>(115200);
  
  <span class="comment">// Configuration routes</span>
  <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>& route : routes) {
    <span class="keyword">if</span> (route.method == "GET") {
      server.<span class="function-name">on</span>(route.path, HTTP_GET, route.handler);
    } <span class="keyword">else</span> <span class="keyword">if</span> (route.method == "POST") {
      server.<span class="function-name">on</span>(route.path, HTTP_POST, route.handler);
    } <span class="keyword">else</span> <span class="keyword">if</span> (route.method == "PUT") {
      server.<span class="function-name">on</span>(route.path, HTTP_PUT, route.handler);
    } <span class="keyword">else</span> <span class="keyword">if</span> (route.method == "DELETE") {
      server.<span class="function-name">on</span>(route.path, HTTP_DELETE, route.handler);
    }
  }
  
  <span class="comment">// Middleware CORS</span>
  server.<span class="function-name">onNotFound</span>([]() {
    <span class="keyword">if</span> (server.<span class="function-name">method</span>() == HTTP_OPTIONS) {
      server.<span class="function-name">sendHeader</span>("Access-Control-Allow-Origin", "*");
      server.<span class="function-name">sendHeader</span>("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS");
      server.<span class="function-name">sendHeader</span>("Access-Control-Allow-Headers", "Content-Type, Authorization");
      server.<span class="function-name">send</span>(204);
    } <span class="keyword">else</span> {
      server.<span class="function-name">send</span>(404, "application/json", "{\"error\":\"Not Found\"}");
    }
  });
  
  server.<span class="function-name">begin</span>();
  Serial.<span class="function-name">println</span>("API d√©marr√©e");
}

<span class="type">void</span> <span class="function-name">loop</span>() {
  server.<span class="function-name">handleClient</span>();
}

<span class="type">void</span> <span class="function-name">handleStatus</span>() {
  <span class="comment">// V√©rification authentification</span>
  <span class="keyword">if</span> (!<span class="function-name">verifierAuth</span>()) {
    server.<span class="function-name">send</span>(401, "application/json", "{\"error\":\"Unauthorized\"}");
    <span class="keyword">return</span>;
  }
  
  DynamicJsonDocument doc(512);
  doc["status"] = "online";
  doc["version"] = "1.0.0";
  doc["uptime"] = <span class="function-name">millis</span>() / 1000;
  doc["memory"] = <span class="function-name">ESP.getFreeHeap</span>();
  
  <span class="type">String</span> response;
  <span class="function-name">serializeJson</span>(doc, response);
  
  server.<span class="function-name">send</span>(200, "application/json", response);
}

<span class="type">void</span> <span class="function-name">handleGetSensors</span>() {
  <span class="keyword">if</span> (!<span class="function-name">verifierAuth</span>()) {
    server.<span class="function-name">send</span>(401, "application/json", "{\"error\":\"Unauthorized\"}");
    <span class="keyword">return</span>;
  }
  
  <span class="comment">// Pagination</span>
  <span class="type">int</span> page = server.<span class="function-name">arg</span>("page").<span class="function-name">toInt</span>();
  <span class="type">int</span> limit = server.<span class="function-name">arg</span>("limit").<span class="function-name">toInt</span>();
  <span class="keyword">if</span> (page == 0) page = 1;
  <span class="keyword">if</span> (limit == 0) limit = 10;
  
  DynamicJsonDocument doc(1024);
  JsonArray sensors = doc.<span class="function-name">createNestedArray</span>("sensors");
  
  <span class="comment">// Simulation donn√©es</span>
  <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < 3; i++) {
    JsonObject sensor = sensors.<span class="function-name">createNestedObject</span>();
    sensor["id"] = i + 1;
    sensor["name"] = "Sensor " + <span class="function-name">String</span>(i + 1);
    sensor["type"] = "temperature";
    sensor["value"] = 20.0 + i;
    sensor["unit"] = "¬∞C";
  }
  
  doc["page"] = page;
  doc["limit"] = limit;
  doc["total"] = 3;
  
  <span class="type">String</span> response;
  <span class="function-name">serializeJson</span>(doc, response);
  
  server.<span class="function-name">send</span>(200, "application/json", response);
}

<span class="type">void</span> <span class="function-name">handlePostSensor</span>() {
  <span class="keyword">if</span> (!<span class="function-name">verifierAuth</span>()) {
    server.<span class="function-name">send</span>(401, "application/json", "{\"error\":\"Unauthorized\"}");
    <span class="keyword">return</span>;
  }
  
  <span class="comment">// Validation Content-Type</span>
  <span class="keyword">if</span> (server.<span class="function-name">header</span>("Content-Type") != "application/json") {
    server.<span class="function-name">send</span>(415, "application/json", "{\"error\":\"Unsupported Media Type\"}");
    <span class="keyword">return</span>;
  }
  
  <span class="comment">// Parse JSON</span>
  DynamicJsonDocument doc(256);
  <span class="type">DeserializationError</span> error = <span class="function-name">deserializeJson</span>(doc, server.<span class="function-name">arg</span>("plain"));
  
  <span class="keyword">if</span> (error) {
    server.<span class="function-name">send</span>(400, "application/json", "{\"error\":\"Invalid JSON\"}");
    <span class="keyword">return</span>;
  }
  
  <span class="comment">// Validation donn√©es</span>
  <span class="keyword">if</span> (!doc.<span class="function-name">containsKey</span>("name") || !doc.<span class="function-name">containsKey</span>("value")) {
    server.<span class="function-name">send</span>(400, "application/json", "{\"error\":\"Missing required fields\"}");
    <span class="keyword">return</span>;
  }
  
  <span class="comment">// Traitement (simulation)</span>
  <span class="type">int</span> newId = <span class="function-name">random</span>(1000, 9999);
  
  DynamicJsonDocument responseDoc(256);
  responseDoc["id"] = newId;
  responseDoc["name"] = doc["name"];
  responseDoc["value"] = doc["value"];
  responseDoc["created"] = <span class="function-name">millis</span>();
  
  <span class="type">String</span> response;
  <span class="function-name">serializeJson</span>(responseDoc, response);
  
  server.<span class="function-name">send</span>(201, "application/json", response);
}

<span class="type">bool</span> <span class="function-name">verifierAuth</span>() {
  <span class="type">String</span> authHeader = server.<span class="function-name">header</span>("Authorization");
  
  <span class="keyword">if</span> (authHeader.<span class="function-name">startsWith</span>("Bearer ")) {
    <span class="type">String</span> token = authHeader.<span class="function-name">substring</span>(7);
    <span class="comment">// V√©rification JWT ici</span>
    <span class="keyword">return</span> <span class="function-name">verifierJWT</span>(token);
  }
  
  <span class="keyword">return</span> <span class="keyword">false</span>;
}</code></pre>
  </div>

  <h3>Documentation OpenAPI/Swagger</h3>
  <div class="code-example">
    <h4>openapi.yaml</h4>
    <pre><code>openapi: 3.0.0
info:
  title: ESP32 IoT API
  version: 1.0.0
  description: API pour contr√¥ler l'ESP32

servers:
  - url: http://esp32.local/api/v1

paths:
  /status:
    get:
      summary: Statut du syst√®me
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Status'
  
  /sensors:
    get:
      summary: Liste des capteurs
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Liste des capteurs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SensorList'
    
    post:
      summary: Ajouter un capteur
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewSensor'
      responses:
        '201':
          description: Capteur cr√©√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sensor'

components:
  schemas:
    Status:
      type: object
      properties:
        status:
          type: string
        version:
          type: string
        uptime:
          type: integer
        memory:
          type: integer
    
    Sensor:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        value:
          type: number
        unit:
          type: string
    
    SensorList:
      type: object
      properties:
        sensors:
          type: array
          items:
            $ref: '#/components/schemas/Sensor'
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer</code></pre>
  </div>
</section>
      </section>

      <!-- =========================================== -->
      <!-- SECTION PROJETS PRATIQUES -->
      <!-- =========================================== -->
       <!-- =========================================== -->
<!-- SECTION BONNES PRATIQUES -->
<!-- =========================================== -->

      <section id="projets">
        <h2>Projets pratiques Arduino/ESP</h2>
        <p>Appliquez vos connaissances avec ces projets concrets, du d√©butant au confirm√©.</p>
<section id="best-practices">
  <h2>Bonnes pratiques de d√©veloppement IoT</h2>
  <p>Guide complet pour des projets robustes et maintenables.</p>

  <div class="info-box">
    <h4>Architecture recommand√©e</h4>
    <ol>
      <li><strong>S√©paration des responsabilit√©s</strong> : Classes distinctes pour communication, logique m√©tier, configuration</li>
      <li><strong>Configuration externe</strong> : Stocker param√®tres dans LittleFS, pas en dur dans le code</li>
      <li><strong>Gestion d'erreurs</strong> : Retry logic avec backoff exponentiel</li>
      <li><strong>Monitoring</strong> : Logs structur√©s et m√©triques de sant√©</li>
    </ol>
  </div>

  <h3>Configuration manag√©e</h3>
  <div class="code-example">
    <pre><code><span class="code-comment">/*
Syst√®me de configuration robuste
*/</span>
<span class="keyword">class</span> <span class="class-name">Configuration</span> {
<span class="keyword">private</span>:
  <span class="type">String</span> fichierConfig = "/config.json";
  DynamicJsonDocument configDoc;
  
<span class="keyword">public</span>:
  <span class="function-name">Configuration</span>() : configDoc(1024) {}
  
  <span class="type">bool</span> <span class="function-name">charger</span>() {
    File file = LittleFS.<span class="function-name">open</span>(fichierConfig, "r");
    <span class="keyword">if</span> (!file) {
      Serial.<span class="function-name">println</span>("Cr√©ation configuration par d√©faut");
      <span class="function-name">configurerDefaut</span>();
      <span class="keyword">return</span> <span class="function-name">sauvegarder</span>();
    }
    
    <span class="type">DeserializationError</span> error = <span class="function-name">deserializeJson</span>(configDoc, file);
    file.<span class="function-name">close</span>();
    
    <span class="keyword">if</span> (error) {
      Serial.<span class="function-name">println</span>("Erreur chargement config");
      <span class="keyword">return</span> <span class="keyword">false</span>;
    }
    
    <span class="keyword">return</span> <span class="keyword">true</span>;
  }
  
  <span class="type">bool</span> <span class="function-name">sauvegarder</span>() {
    File file = LittleFS.<span class="function-name">open</span>(fichierConfig, "w");
    <span class="keyword">if</span> (!file) {
      <span class="keyword">return</span> <span class="keyword">false</span>;
    }
    
    <span class="function-name">serializeJson</span>(configDoc, file);
    file.<span class="function-name">close</span>();
    
    <span class="keyword">return</span> <span class="keyword">true</span>;
  }
  
  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
  T <span class="function-name">get</span>(<span class="type">const</span> <span class="type">char</span>* key, T defaultValue) {
    <span class="keyword">return</span> configDoc[key] | defaultValue;
  }
  
  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
  <span class="type">void</span> <span class="function-name">set</span>(<span class="type">const</span> <span class="type">char</span>* key, T value) {
    configDoc[key] = value;
  }
  
<span class="keyword">private</span>:
  <span class="type">void</span> <span class="function-name">configurerDefaut</span>() {
    configDoc["wifi"]["ssid"] = "";
    configDoc["wifi"]["password"] = "";
    configDoc["mqtt"]["server"] = "";
    configDoc["mqtt"]["port"] = 1883;
    configDoc["device"]["name"] = "ESP32-Device";
    configDoc["device"]["location"] = "unknown";
    configDoc["sensors"]["interval"] = 30000;
  }
};</code></pre>
  </div>

  <h3>Guide de s√©curit√© IoT</h3>
  <div class="warning-box">
    <h4>‚ö†Ô∏è R√®gles de s√©curit√© essentielles</h4>
    <ol>
      <li><strong>Mots de passe forts</strong> : Pas de valeurs par d√©faut, rotation r√©guli√®re</li>
      <li><strong>Mises √† jour</strong> : OTA s√©curis√© avec signature firmware</li>
      <li><strong>Communication chiffr√©e</strong> : TLS 1.2+ obligatoire</li>
      <li><strong>Principle of least privilege</strong> : Limiter acc√®s r√©seau et fichiers</li>
      <li><strong>Audit logs</strong> : Journaliser toutes les actions critiques</li>
      <li><strong>Validation input</strong> : Sanitizer toutes les entr√©es utilisateur</li>
      <li><strong>Securit√© physique</strong> : Protection acc√®s UART/JTAG</li>
    </ol>
  </div>
</section>
        <div class="project-gallery">
          <!-- Projet 1 -->
          <div class="project-card">
            <div class="project-image">
              <i class="fas fa-thermometer-half"></i>
            </div>
            <div class="project-content">
              <span class="difficulty beginner">D√©butant</span>
              <h4 id="projet1">Station m√©t√©o avec affichage LCD</h4>
              <p>Mesure la temp√©rature et l'humidit√© avec un capteur DHT11 et affiche les donn√©es sur un √©cran LCD 16x2.
              </p>
              <p><strong>Composants :</strong> Arduino Uno, DHT11, LCD 16x2, potentiom√®tre</p>
            </div>
          </div>

          <!-- Projet 2 -->
          <div class="project-card">
            <div class="project-image">
              <i class="fas fa-home"></i>
            </div>
            <div class="project-content">
              <span class="difficulty intermediate">Interm√©diaire</span>
              <h4 id="projet2">Syst√®me domotique avec ESP32</h4>
              <p>Contr√¥le l'√©clairage et les appareils via WiFi avec une interface web. Inclut capteurs de mouvement et
                relais.</p>
              <p><strong>Composants :</strong> ESP32, relais 5V, capteur PIR, LED</p>
            </div>
          </div>

          <!-- Projet 3 -->
          <div class="project-card">
            <div class="project-image">
              <i class="fas fa-robot"></i>
            </div>
            <div class="project-content">
              <span class="difficulty intermediate">Interm√©diaire</span>
              <h4 id="projet3">Robot suiveur de ligne</h4>
              <p>Robot autonome qui suit une ligne noire au sol. Utilise des capteurs infrarouges et contr√¥le des
                moteurs DC.</p>
              <p><strong>Composants :</strong> Arduino Nano, capteurs IR, moteurs DC, pont H L298N</p>
            </div>
          </div>

          <!-- Projet 4 -->
          <div class="project-card">
            <div class="project-image">
              <i class="fas fa-tint"></i>
            </div>
            <div class="project-content">
              <span class="difficulty advanced">Avanc√©</span>
              <h4 id="projet4">Syst√®me d'arrosage automatique intelligent</h4>
              <p>Arrose les plantes automatiquement en fonction de l'humidit√© du sol. Notification via MQTT et
                historique des donn√©es.</p>
              <p><strong>Composants :</strong> ESP32, capteur d'humidit√© sol, √©lectrovanne, module RTC</p>
            </div>
          </div>
        </div>

        <h3>Projet d√©taill√© : Station m√©t√©o</h3>
        <div class="code-example">
          <pre><code><span class="code-comment">/*
  Station m√©t√©o avec DHT11 et LCD
  Affiche temp√©rature et humidit√©
*/</span>

<span class="code-keyword">#include</span> &lt;LiquidCrystal.h&gt;
<span class="code-keyword">#include</span> &lt;DHT.h&gt;

<span class="code-comment">// D√©finition des broches</span>
<span class="code-keyword">#define</span> DHTPIN 2          <span class="code-comment">// Broche du capteur DHT</span>
<span class="code-keyword">#define</span> DHTTYPE DHT11     <span class="code-comment">// Type de capteur</span>

<span class="code-comment">// Broches LCD (RS, EN, D4, D5, D6, D7)</span>
LiquidCrystal lcd(12, 11, 5, 4, 3, 2);

<span class="code-comment">// Initialisation du capteur DHT</span>
DHT dht(DHTPIN, DHTTYPE);

<span class="code-comment">// Variables</span>
<span class="code-keyword">float</span> temperature;
<span class="code-keyword">float</span> humidite;
<span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> dernierRefresh = 0;
<span class="code-keyword">const</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> intervalRefresh = 2000;  <span class="code-comment">// 2 secondes</span>

<span class="code-keyword">void</span> <span class="code-function">setup</span>() {
  Serial.<span class="code-function">begin</span>(9600);
  
  <span class="code-comment">// Initialisation LCD (16 colonnes, 2 lignes)</span>
  lcd.<span class="code-function">begin</span>(16, 2);
  
  <span class="code-comment">// Initialisation DHT</span>
  dht.<span class="code-function">begin</span>();
  
  <span class="code-comment">// Message d'accueil</span>
  lcd.<span class="code-function">print</span>(<span class="code-string">"Station Meteo"</span>);
  <span class="code-function">delay</span>(2000);
  lcd.<span class="code-function">clear</span>();
  
  Serial.<span class="code-function">println</span>(<span class="code-string">"Station meteo initialisee"</span>);
}

<span class="code-keyword">void</span> <span class="code-function">loop</span>() {
  <span class="code-keyword">unsigned</span> <span class="code-keyword">long</span> maintenant = <span class="code-function">millis</span>();
  
  <span class="code-keyword">if</span> (maintenant - dernierRefresh >= intervalRefresh) {
    dernierRefresh = maintenant;
    
    <span class="code-comment">// Lecture des donn√©es</span>
    humidite = dht.<span class="code-function">readHumidity</span>();
    temperature = dht.<span class="code-function">readTemperature</span>();
    
    <span class="code-comment">// V√©rification de la lecture</span>
    <span class="code-keyword">if</span> (<span class="code-function">isnan</span>(humidite) || <span class="code-function">isnan</span>(temperature)) {
      Serial.<span class="code-function">println</span>(<span class="code-string">"Erreur lecture DHT!"</span>);
      lcd.<span class="code-function">clear</span>();
      lcd.<span class="code-function">print</span>(<span class="code-string">"Erreur capteur"</span>);
      <span class="code-keyword">return</span>;
    }
    
    <span class="code-comment">// Affichage sur LCD</span>
    lcd.<span class="code-function">clear</span>();
    
    <span class="code-comment">// Ligne 1: Temp√©rature</span>
    lcd.<span class="code-function">setCursor</span>(0, 0);
    lcd.<span class="code-function">print</span>(<span class="code-string">"Temp: "</span>);
    lcd.<span class="code-function">print</span>(temperature, 1);
    lcd.<span class="code-function">print</span>((<span class="code-type">char</span>)223);  <span class="code-comment">// Degr√©</span>
    lcd.<span class="code-function">print</span>(<span class="code-string">"C"</span>);
    
    <span class="code-comment">// Ligne 2: Humidit√©</span>
    lcd.<span class="code-function">setCursor</span>(0, 1);
    lcd.<span class="code-function">print</span>(<span class="code-string">"Hum:  "</span>);
    lcd.<span class="code-function">print</span>(humidite, 0);
    lcd.<span class="code-function">print</span>(<span class="code-string">"%"</span>);
    
    <span class="code-comment">// Affichage sur moniteur s√©rie</span>
    Serial.<span class="code-function">print</span>(<span class="code-string">"Temperature: "</span>);
    Serial.<span class="code-function">print</span>(temperature);
    Serial.<span class="code-function">print</span>(<span class="code-string">"¬∞C | Humidite: "</span>);
    Serial.<span class="code-function">print</span>(humidite);
    Serial.<span class="code-function">println</span>(<span class="code-string">"%"</span>);
    
    <span class="code-comment">// Avertissement si temp√©rature trop √©lev√©e</span>
    <span class="code-keyword">if</span> (temperature > 30) {
      lcd.<span class="code-function">setCursor</span>(12, 0);
      lcd.<span class="code-function">print</span>(<span class="code-string">"HOT"</span>);
    } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (temperature < 10) {
      lcd.<span class="code-function">setCursor</span>(12, 0);
      lcd.<span class="code-function">print</span>(<span class="code-string">"COLD"</span>);
    }
  }
}</code></pre>
        </div>
      </section>

      <!-- Navigation buttons -->
      <div class="nav-buttons">
        <a href="#premier-programme" class="nav-button prev"><i class="fas fa-arrow-left"></i> Premier programme</a>
        <a href="#exercices" class="nav-button next">Exercices pratiques <i class="fas fa-arrow-right"></i></a>
      </div>
    </main>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>ArduinoLearn</h3>
          <p>Votre ressource compl√®te pour apprendre la programmation Arduino et ESP. Des tutoriels pour d√©butants aux
            projets avanc√©s.</p>
        </div>
        <div class="footer-section">
          <h3>Sections principales</h3>
          <ul>
            <li><a href="#structure">Structure avanc√©e</a></li>
            <li><a href="#variables">Variables et types</a></li>
            <li><a href="#fonctions">Fonctions de base</a></li>
            <li><a href="#entrees-sorties">Entr√©es/Sorties</a></li>
            <li><a href="#allumer-led">Allumer une LED</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Contenu avanc√©</h3>
          <ul>
            <li><a href="#bibliotheques">Biblioth√®ques</a></li>
            <li><a href="#structures-controle">Structures de contr√¥le</a></li>
            <li><a href="#communication">Communication ESP</a></li>
            <li><a href="#projets">Projets pratiques</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>√Ä propos</h3>
          <p>Ce site est con√ßu pour les d√©butants souhaitant apprendre la programmation Arduino et ESP avec des exemples
            clairs et pratiques.</p>
        </div>
      </div>
      <div class="copyright">
        <p>&copy; 2023 ArduinoLearn. Tous droits r√©serv√©s. | Con√ßu pour l'apprentissage</p>
      </div>
    </div>
  </footer>

  <script>
    // Gestion de la navigation et des ancres
    document.addEventListener('DOMContentLoaded', function () {
      // Navigation par ancres
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          const targetId = this.getAttribute('href');
          if (targetId === '#' || targetId === '#tutoriels') return;

          // Si c'est un lien interne (commence par #)
          if (targetId.startsWith('#')) {
            e.preventDefault();
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
              // Scroll vers l'√©l√©ment
              window.scrollTo({
                top: targetElement.offsetTop - 100,
                behavior: 'smooth'
              });

              // Met √† jour l'URL sans recharger la page
              history.pushState(null, null, targetId);

              // Met √† jour le lien actif dans la sidebar
              updateActiveSidebarLink(targetId);
            }
          }
        });
      });

      // Fonction pour mettre √† jour le lien actif dans la sidebar
      function updateActiveSidebarLink(targetId) {
        // Retire la classe active de tous les liens
        document.querySelectorAll('.sidebar a').forEach(link => {
          link.classList.remove('active');
        });

        // Ajoute la classe active au lien correspondant
        const activeLink = document.querySelector(`.sidebar a[href="${targetId}"]`);
        if (activeLink) {
          activeLink.classList.add('active');

          // Si c'est un sous-menu, active aussi le parent
          const parentLi = activeLink.closest('.sub-menu');
          if (parentLi) {
            const parentLink = parentLi.previousElementSibling;
            if (parentLink && parentLink.tagName === 'A') {
              parentLink.classList.add('active');
            }
          }
        }
      }

      // Gestion de l'√©tat actif au chargement de la page
      if (window.location.hash) {
        const targetElement = document.querySelector(window.location.hash);
        if (targetElement) {
          setTimeout(() => {
            window.scrollTo({
              top: targetElement.offsetTop - 100,
              behavior: 'smooth'
            });
            updateActiveSidebarLink(window.location.hash);
          }, 100);
        }
      }

      // Met √† jour l'URL lors du d√©filement
      let sections = document.querySelectorAll('section[id]');
      window.addEventListener('scroll', function () {
        let current = '';
        let scrollPosition = window.scrollY + 150;

        sections.forEach(section => {
          const sectionTop = section.offsetTop;
          const sectionHeight = section.clientHeight;

          if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
            current = '#' + section.getAttribute('id');
          }
        });

        if (current) {
          history.replaceState(null, null, current);
          updateActiveSidebarLink(current);
        }
      });

      // Sidebar sticky behavior
      const sidebar = document.querySelector('.sidebar');
      const sidebarTop = sidebar.offsetTop;

      window.addEventListener('scroll', function () {
        if (window.innerWidth > 768) { // Desktop seulement
          if (window.scrollY >= sidebarTop - 100) {
            sidebar.style.position = 'sticky';
            sidebar.style.top = '100px';
          } else {
            sidebar.style.position = 'static';
          }
        }
      });
    });
    // ===========================================
// BOUTON TOGGLE HAUT/BAS
// ===========================================
// ===========================================
// MENU HAMBURGER POUR MOBILE
// ===========================================
document.addEventListener('DOMContentLoaded', function() {
  const hamburgerBtn = document.querySelector('.hamburger-btn');
  const nav = document.querySelector('nav');
  const navLinks = document.querySelectorAll('.nav-menu a');
  let mobileOverlay = document.querySelector('.mobile-overlay');

  // Cr√©e l'overlay s'il n'existe pas
  if (!mobileOverlay) {
    mobileOverlay = document.createElement('div');
    mobileOverlay.className = 'mobile-overlay';
    document.body.appendChild(mobileOverlay);
  }

  // Fonction pour ouvrir/fermer le menu
  function toggleMenu() {
    hamburgerBtn.classList.toggle('active');
    nav.classList.toggle('active');
    mobileOverlay.classList.toggle('active');
    document.body.style.overflow = nav.classList.contains('active') ? 'hidden' : '';
  }

  // √âv√©nement sur le bouton hamburger
  hamburgerBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    toggleMenu();
  });

  // Ferme le menu en cliquant sur l'overlay
  mobileOverlay.addEventListener('click', function() {
    if (nav.classList.contains('active')) {
      toggleMenu();
    }
  });

  // Ferme le menu en cliquant sur un lien
  navLinks.forEach(link => {
    link.addEventListener('click', function() {
      if (window.innerWidth <= 768) {
        toggleMenu();
      }
    });
  });

  // Ferme le menu en appuyant sur √âchap
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && nav.classList.contains('active')) {
      toggleMenu();
    }
  });

  // Ajuste le menu lors du redimensionnement
  window.addEventListener('resize', function() {
    if (window.innerWidth > 768) {
      // Sur desktop, s'assure que le menu est visible
      hamburgerBtn.classList.remove('active');
      nav.classList.remove('active');
      mobileOverlay.classList.remove('active');
      document.body.style.overflow = '';
    }
  });
});
document.addEventListener('DOMContentLoaded', function() {
  // Cr√©e le bouton s'il n'existe pas
  if (!document.querySelector('.scroll-toggle-btn')) {
    const toggleBtn = document.createElement('button');
    toggleBtn.className = 'scroll-toggle-btn';
    toggleBtn.title = 'Aller en bas';
    toggleBtn.innerHTML = '<i class="fas fa-arrow-down"></i><i class="fas fa-arrow-up"></i>';
    document.body.appendChild(toggleBtn);
  }

  const toggleBtn = document.querySelector('.scroll-toggle-btn');
  let isScrollingToBottom = true;
  let isScrolling = false;
  let scrollTimeout;

  // Fonction pour afficher/cacher le bouton
  function toggleButtonVisibility() {
    const scrollPosition = window.scrollY;
    const windowHeight = window.innerHeight;
    const documentHeight = document.documentElement.scrollHeight;
    
    // Affiche le bouton seulement si on peut scroller
    if (documentHeight > windowHeight + 100) {
      // Affiche apr√®s un certain d√©filement vers le bas
      if (scrollPosition > 300) {
        toggleBtn.classList.add('visible');
        
        // Ajoute une pulsation la premi√®re fois
        if (!toggleBtn.classList.contains('pulsed')) {
          toggleBtn.classList.add('pulse');
          setTimeout(() => {
            toggleBtn.classList.remove('pulse');
            toggleBtn.classList.add('pulsed');
          }, 4000);
        }
      } else {
        toggleBtn.classList.remove('visible');
      }
      
      // Change l'ic√¥ne et le titre selon la position
      if (scrollPosition > documentHeight - windowHeight - 100) {
        // Pr√®s du bas ‚Üí montre fl√®che vers le haut
        isScrollingToBottom = false;
        toggleBtn.classList.add('scroll-to-top');
        toggleBtn.title = 'Retour en haut';
      } else {
        // Autre part ‚Üí montre fl√®che vers le bas
        isScrollingToBottom = true;
        toggleBtn.classList.remove('scroll-to-top');
        toggleBtn.title = 'Aller en bas';
      }
    } else {
      toggleBtn.classList.remove('visible');
    }
  }

  // Fonction pour scroller
  function scrollToDestination() {
    if (isScrolling) return;
    
    isScrolling = true;
    
    if (isScrollingToBottom) {
      // Va en bas
      window.scrollTo({
        top: document.documentElement.scrollHeight,
        behavior: 'smooth'
      });
    } else {
      // Va en haut
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }
    
    // Animation de clic
    toggleBtn.style.transform = 'scale(0.9)';
    setTimeout(() => {
      toggleBtn.style.transform = '';
    }, 200);
    
    // D√©lai avant de pouvoir recliquer
    setTimeout(() => {
      isScrolling = false;
    }, 1000);
  }

  // √âv√©nements
  toggleBtn.addEventListener('click', scrollToDestination);
  
  // Cache le bouton pendant le d√©filement
  window.addEventListener('scroll', function() {
    toggleBtn.classList.remove('visible');
    
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(() => {
      toggleButtonVisibility();
    }, 150);
  });
  
  // Initialisation
  setTimeout(toggleButtonVisibility, 500);
  
  // R√©initialise lors du redimensionnement
  window.addEventListener('resize', function() {
    toggleButtonVisibility();
  });
  
  // Pour le mode mobile tactile
  toggleBtn.addEventListener('touchstart', function(e) {
    e.preventDefault();
    this.style.transform = 'scale(0.95)';
  });
  
  toggleBtn.addEventListener('touchend', function(e) {
    e.preventDefault();
    this.style.transform = '';
    scrollToDestination();
  });
  
  // Ajoute les styles pour les ic√¥nes si n√©cessaire
  const style = document.createElement('style');
  style.textContent = `
    .scroll-toggle-btn i {
      transition: transform 0.3s ease;
    }
    .scroll-toggle-btn:hover i {
      transform: scale(1.2);
    }
  `;
  document.head.appendChild(style);
});
const header = document.querySelector(".hero");

const images = [
    "./image/closeup-electronic-circuit-board-with-cpu-microchip-electronic-components-background.jpg",
    "./image/top-view-wires-tech-background.jpg",
    "./image/using-pliers-circuit-board.jpg",
    "./image/father-son-making-robot.jpg",
    "./image/robot-style-car-with-joystick.jpg"
];

let index = 0;

function changeHeaderBackground() {
    header.style.backgroundImage = `url('${images[index]}')`;
    index = (index + 1) % images.length;
}

// image au chargement
changeHeaderBackground();

// changer toutes les 3 secondes
setInterval(changeHeaderBackground, 3000);
  </script>
</body>

</html>